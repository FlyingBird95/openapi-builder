
<!DOCTYPE html>

<html xmlns="http://www.w3.org/1999/xhtml">
  <head>
    <meta charset="utf-8" />
    <title>marshmallow.fields &#8212; openapi_builder 0.2.4 documentation</title>
    
  <link href="../../_static/css/theme.css" rel="stylesheet">
  <link href="../../_static/css/index.ff1ffe594081f20da1ef19478df9384b.css" rel="stylesheet">

    
  <link rel="stylesheet"
    href="../../_static/vendor/fontawesome/5.13.0/css/all.min.css">
  <link rel="preload" as="font" type="font/woff2" crossorigin
    href="../../_static/vendor/fontawesome/5.13.0/webfonts/fa-solid-900.woff2">
  <link rel="preload" as="font" type="font/woff2" crossorigin
    href="../../_static/vendor/fontawesome/5.13.0/webfonts/fa-brands-400.woff2">

    
      

    
    <link rel="stylesheet" href="../../_static/sphinx-book-theme.css?digest=c3fdc42140077d1ad13ad2f1588a4309" type="text/css" />
    <link rel="stylesheet" href="../../_static/pygments.css" type="text/css" />
    <link rel="stylesheet" type="text/css" href="../../_static/css/rtd_sphinx_search.min.css" />
    
  <link rel="preload" as="script" href="../../_static/js/index.be7d3bbb2ef33a8344ce.js">

    <script id="documentation_options" data-url_root="../../" src="../../_static/documentation_options.js"></script>
    <script src="../../_static/jquery.js"></script>
    <script src="../../_static/underscore.js"></script>
    <script src="../../_static/doctools.js"></script>
    <script src="../../_static/language_data.js"></script>
    <script src="../../_static/js/rtd_sphinx_search.min.js"></script>
    <script src="../../_static/sphinx-book-theme.d59cb220de22ca1c485ebbdc042f0030.js"></script>
    <link rel="index" title="Index" href="../../genindex.html" />
    <link rel="search" title="Search" href="../../search.html" />
    <meta name="viewport" content="width=device-width, initial-scale=1" />
    <meta name="docsearch:language" content="None">
    

    <!-- Google Analytics -->
    
  </head>
  <body data-spy="scroll" data-target="#bd-toc-nav" data-offset="80">
    
    <div class="container-fluid" id="banner"></div>

    

    <div class="container-xl">
      <div class="row">
          
<div class="col-12 col-md-3 bd-sidebar site-navigation show" id="site-navigation">
    
        <div class="navbar-brand-box">
    <a class="navbar-brand text-wrap" href="../../index.html">
      
      
      
      <h1 class="site-logo" id="site-title">openapi_builder 0.2.4 documentation</h1>
      
    </a>
</div><form class="bd-search d-flex align-items-center" action="../../search.html" method="get">
  <i class="icon fas fa-search"></i>
  <input type="search" class="form-control" name="q" id="search-input" placeholder="Search the docs ..." aria-label="Search the docs ..." autocomplete="off" >
</form><nav class="bd-links" id="bd-docs-nav" aria-label="Main">
    <div class="bd-toc-item active">
        <p class="caption">
 <span class="caption-text">
  Contents:
 </span>
</p>
<ul class="nav bd-sidenav">
 <li class="toctree-l1">
  <a class="reference internal" href="../../configuration.html">
   Configuration
  </a>
 </li>
 <li class="toctree-l1">
  <a class="reference internal" href="../../exceptions.html">
   Exceptions
  </a>
 </li>
 <li class="toctree-l1 has-children">
  <a class="reference internal" href="../../source/packages/modules.html">
   API Reference
  </a>
  <input class="toctree-checkbox" id="toctree-checkbox-1" name="toctree-checkbox-1" type="checkbox"/>
  <label for="toctree-checkbox-1">
   <i class="fas fa-chevron-down">
   </i>
  </label>
  <ul>
   <li class="toctree-l2 has-children">
    <a class="reference internal" href="../../source/packages/openapi_builder.html">
     openapi_builder package
    </a>
    <input class="toctree-checkbox" id="toctree-checkbox-2" name="toctree-checkbox-2" type="checkbox"/>
    <label for="toctree-checkbox-2">
     <i class="fas fa-chevron-down">
     </i>
    </label>
    <ul>
     <li class="toctree-l3 has-children">
      <a class="reference internal" href="../../source/packages/openapi_builder.blueprint.html">
       openapi_builder.blueprint package
      </a>
      <input class="toctree-checkbox" id="toctree-checkbox-3" name="toctree-checkbox-3" type="checkbox"/>
      <label for="toctree-checkbox-3">
       <i class="fas fa-chevron-down">
       </i>
      </label>
      <ul>
       <li class="toctree-l4">
        <a class="reference internal" href="../../source/packages/openapi_builder.blueprint.blueprint.html">
         openapi_builder.blueprint.blueprint module
        </a>
       </li>
       <li class="toctree-l4">
        <a class="reference internal" href="../../source/packages/openapi_builder.blueprint.configuration.html">
         openapi_builder.blueprint.configuration module
        </a>
       </li>
       <li class="toctree-l4">
        <a class="reference internal" href="../../source/packages/openapi_builder.blueprint.get.html">
         openapi_builder.blueprint.get module
        </a>
       </li>
      </ul>
     </li>
     <li class="toctree-l3 has-children">
      <a class="reference internal" href="../../source/packages/openapi_builder.converters.html">
       openapi_builder.converters package
      </a>
      <input class="toctree-checkbox" id="toctree-checkbox-4" name="toctree-checkbox-4" type="checkbox"/>
      <label for="toctree-checkbox-4">
       <i class="fas fa-chevron-down">
       </i>
      </label>
      <ul>
       <li class="toctree-l4">
        <a class="reference internal" href="../../source/packages/openapi_builder.converters.parameter.html">
         openapi_builder.converters.parameter package
        </a>
       </li>
       <li class="toctree-l4">
        <a class="reference internal" href="../../source/packages/openapi_builder.converters.base.html">
         openapi_builder.converters.base module
        </a>
       </li>
       <li class="toctree-l4">
        <a class="reference internal" href="../../source/packages/openapi_builder.converters.halogen.html">
         openapi_builder.converters.halogen module
        </a>
       </li>
       <li class="toctree-l4">
        <a class="reference internal" href="../../source/packages/openapi_builder.converters.marshmallow.html">
         openapi_builder.converters.marshmallow module
        </a>
       </li>
      </ul>
     </li>
     <li class="toctree-l3">
      <a class="reference internal" href="../../source/packages/openapi_builder.builder.html">
       openapi_builder.builder module
      </a>
     </li>
     <li class="toctree-l3">
      <a class="reference internal" href="../../source/packages/openapi_builder.constants.html">
       openapi_builder.constants module
      </a>
     </li>
     <li class="toctree-l3">
      <a class="reference internal" href="../../source/packages/openapi_builder.decorators.html">
       openapi_builder.decorators module
      </a>
     </li>
     <li class="toctree-l3">
      <a class="reference internal" href="../../source/packages/openapi_builder.documentation.html">
       openapi_builder.documentation module
      </a>
     </li>
     <li class="toctree-l3">
      <a class="reference internal" href="../../source/packages/openapi_builder.exceptions.html">
       openapi_builder.exceptions module
      </a>
     </li>
     <li class="toctree-l3">
      <a class="reference internal" href="../../source/packages/openapi_builder.specification.html">
       openapi_builder.specification module
      </a>
     </li>
     <li class="toctree-l3">
      <a class="reference internal" href="../../source/packages/openapi_builder.util.html">
       openapi_builder.util module
      </a>
     </li>
    </ul>
   </li>
  </ul>
 </li>
 <li class="toctree-l1">
  <a class="reference internal" href="../../source/changelog.html">
   Changelog
  </a>
 </li>
 <li class="toctree-l1">
  <a class="reference internal" href="../../py-modindex.html">
   Module Index
  </a>
 </li>
 <li class="toctree-l1">
  <a class="reference internal" href="../../genindex.html">
   Index
  </a>
 </li>
</ul>

    </div>
</nav> <!-- To handle the deprecated key -->

<div class="navbar_extra_footer">
  Theme by the <a href="https://ebp.jupyterbook.org">Executable Book Project</a>
</div>

</div>


          


          
<main class="col py-md-3 pl-md-4 bd-content overflow-auto" role="main">
    
    <div class="topbar container-xl fixed-top">
    <div class="topbar-contents row">
        <div class="col-12 col-md-3 bd-topbar-whitespace site-navigation show"></div>
        <div class="col pl-md-4 topbar-main">
            
            <button id="navbar-toggler" class="navbar-toggler ml-0" type="button" data-toggle="collapse"
                data-toggle="tooltip" data-placement="bottom" data-target=".site-navigation" aria-controls="navbar-menu"
                aria-expanded="true" aria-label="Toggle navigation" aria-controls="site-navigation"
                title="Toggle navigation" data-toggle="tooltip" data-placement="left">
                <i class="fas fa-bars"></i>
                <i class="fas fa-arrow-left"></i>
                <i class="fas fa-arrow-up"></i>
            </button>
            
            
            <!-- Source interaction buttons -->

            <!-- Full screen (wrap in <a> to have style consistency -->

<a class="full-screen-button"><button type="button" class="btn btn-secondary topbarbtn" data-toggle="tooltip"
        data-placement="bottom" onclick="toggleFullScreen()" aria-label="Fullscreen mode"
        title="Fullscreen mode"><i
            class="fas fa-expand"></i></button></a>

            <!-- Launch buttons -->

        </div>

        <!-- Table of contents -->
        <div class="d-none d-md-block col-md-2 bd-toc show noprint">
            
        </div>
    </div>
</div>
    <div id="main-content" class="row">
        <div class="col-12 col-md-9 pl-md-3 pr-md-0">
            <!-- Table of contents that is only displayed when printing the page -->
            <div id="jb-print-docs-body" class="onlyprint">
                <h1></h1>
                <!-- Table of contents -->
                <div id="print-main-content">
                    <div id="jb-print-toc">
                        
                    </div>
                </div>
            </div>
            
              <div>
                
  <h1>Source code for marshmallow.fields</h1><div class="highlight"><pre>
<span></span><span class="sd">&quot;&quot;&quot;Field classes for various types of data.&quot;&quot;&quot;</span>

<span class="kn">import</span> <span class="nn">collections</span>
<span class="kn">import</span> <span class="nn">copy</span>
<span class="kn">import</span> <span class="nn">datetime</span> <span class="k">as</span> <span class="nn">dt</span>
<span class="kn">import</span> <span class="nn">numbers</span>
<span class="kn">import</span> <span class="nn">uuid</span>
<span class="kn">import</span> <span class="nn">ipaddress</span>
<span class="kn">import</span> <span class="nn">decimal</span>
<span class="kn">import</span> <span class="nn">math</span>
<span class="kn">import</span> <span class="nn">typing</span>
<span class="kn">import</span> <span class="nn">warnings</span>
<span class="kn">from</span> <span class="nn">collections.abc</span> <span class="kn">import</span> <span class="n">Mapping</span> <span class="k">as</span> <span class="n">_Mapping</span>

<span class="kn">from</span> <span class="nn">marshmallow</span> <span class="kn">import</span> <span class="n">validate</span><span class="p">,</span> <span class="n">utils</span><span class="p">,</span> <span class="n">class_registry</span><span class="p">,</span> <span class="n">types</span>
<span class="kn">from</span> <span class="nn">marshmallow.base</span> <span class="kn">import</span> <span class="n">FieldABC</span><span class="p">,</span> <span class="n">SchemaABC</span>
<span class="kn">from</span> <span class="nn">marshmallow.utils</span> <span class="kn">import</span> <span class="p">(</span>
    <span class="n">is_collection</span><span class="p">,</span>
    <span class="n">missing</span> <span class="k">as</span> <span class="n">missing_</span><span class="p">,</span>
    <span class="n">resolve_field_instance</span><span class="p">,</span>
    <span class="n">is_aware</span><span class="p">,</span>
<span class="p">)</span>
<span class="kn">from</span> <span class="nn">marshmallow.exceptions</span> <span class="kn">import</span> <span class="p">(</span>
    <span class="n">ValidationError</span><span class="p">,</span>
    <span class="n">StringNotCollectionError</span><span class="p">,</span>
    <span class="n">FieldInstanceResolutionError</span><span class="p">,</span>
<span class="p">)</span>
<span class="kn">from</span> <span class="nn">marshmallow.validate</span> <span class="kn">import</span> <span class="n">And</span><span class="p">,</span> <span class="n">Length</span>
<span class="kn">from</span> <span class="nn">marshmallow.warnings</span> <span class="kn">import</span> <span class="n">RemovedInMarshmallow4Warning</span>

<span class="n">__all__</span> <span class="o">=</span> <span class="p">[</span>
    <span class="s2">&quot;Field&quot;</span><span class="p">,</span>
    <span class="s2">&quot;Raw&quot;</span><span class="p">,</span>
    <span class="s2">&quot;Nested&quot;</span><span class="p">,</span>
    <span class="s2">&quot;Mapping&quot;</span><span class="p">,</span>
    <span class="s2">&quot;Dict&quot;</span><span class="p">,</span>
    <span class="s2">&quot;List&quot;</span><span class="p">,</span>
    <span class="s2">&quot;Tuple&quot;</span><span class="p">,</span>
    <span class="s2">&quot;String&quot;</span><span class="p">,</span>
    <span class="s2">&quot;UUID&quot;</span><span class="p">,</span>
    <span class="s2">&quot;Number&quot;</span><span class="p">,</span>
    <span class="s2">&quot;Integer&quot;</span><span class="p">,</span>
    <span class="s2">&quot;Decimal&quot;</span><span class="p">,</span>
    <span class="s2">&quot;Boolean&quot;</span><span class="p">,</span>
    <span class="s2">&quot;Float&quot;</span><span class="p">,</span>
    <span class="s2">&quot;DateTime&quot;</span><span class="p">,</span>
    <span class="s2">&quot;NaiveDateTime&quot;</span><span class="p">,</span>
    <span class="s2">&quot;AwareDateTime&quot;</span><span class="p">,</span>
    <span class="s2">&quot;Time&quot;</span><span class="p">,</span>
    <span class="s2">&quot;Date&quot;</span><span class="p">,</span>
    <span class="s2">&quot;TimeDelta&quot;</span><span class="p">,</span>
    <span class="s2">&quot;Url&quot;</span><span class="p">,</span>
    <span class="s2">&quot;URL&quot;</span><span class="p">,</span>
    <span class="s2">&quot;Email&quot;</span><span class="p">,</span>
    <span class="s2">&quot;IP&quot;</span><span class="p">,</span>
    <span class="s2">&quot;IPv4&quot;</span><span class="p">,</span>
    <span class="s2">&quot;IPv6&quot;</span><span class="p">,</span>
    <span class="s2">&quot;IPInterface&quot;</span><span class="p">,</span>
    <span class="s2">&quot;IPv4Interface&quot;</span><span class="p">,</span>
    <span class="s2">&quot;IPv6Interface&quot;</span><span class="p">,</span>
    <span class="s2">&quot;Method&quot;</span><span class="p">,</span>
    <span class="s2">&quot;Function&quot;</span><span class="p">,</span>
    <span class="s2">&quot;Str&quot;</span><span class="p">,</span>
    <span class="s2">&quot;Bool&quot;</span><span class="p">,</span>
    <span class="s2">&quot;Int&quot;</span><span class="p">,</span>
    <span class="s2">&quot;Constant&quot;</span><span class="p">,</span>
    <span class="s2">&quot;Pluck&quot;</span><span class="p">,</span>
<span class="p">]</span>

<span class="n">_T</span> <span class="o">=</span> <span class="n">typing</span><span class="o">.</span><span class="n">TypeVar</span><span class="p">(</span><span class="s2">&quot;_T&quot;</span><span class="p">)</span>


<span class="k">class</span> <span class="nc">Field</span><span class="p">(</span><span class="n">FieldABC</span><span class="p">):</span>
    <span class="sd">&quot;&quot;&quot;Basic field from which other fields should extend. It applies no</span>
<span class="sd">    formatting by default, and should only be used in cases where</span>
<span class="sd">    data does not need to be formatted before being serialized or deserialized.</span>
<span class="sd">    On error, the name of the field will be returned.</span>

<span class="sd">    :param dump_default: If set, this value will be used during serialization if the</span>
<span class="sd">        input value is missing. If not set, the field will be excluded from the</span>
<span class="sd">        serialized output if the input value is missing. May be a value or a callable.</span>
<span class="sd">    :param load_default: Default deserialization value for the field if the field is not</span>
<span class="sd">        found in the input data. May be a value or a callable.</span>
<span class="sd">    :param data_key: The name of the dict key in the external representation, i.e.</span>
<span class="sd">        the input of `load` and the output of `dump`.</span>
<span class="sd">        If `None`, the key will match the name of the field.</span>
<span class="sd">    :param attribute: The name of the attribute to get the value from when serializing.</span>
<span class="sd">        If `None`, assumes the attribute has the same name as the field.</span>
<span class="sd">        Note: This should only be used for very specific use cases such as</span>
<span class="sd">        outputting multiple fields for a single attribute. In most cases,</span>
<span class="sd">        you should use ``data_key`` instead.</span>
<span class="sd">    :param validate: Validator or collection of validators that are called</span>
<span class="sd">        during deserialization. Validator takes a field&#39;s input value as</span>
<span class="sd">        its only parameter and returns a boolean.</span>
<span class="sd">        If it returns `False`, an :exc:`ValidationError` is raised.</span>
<span class="sd">    :param required: Raise a :exc:`ValidationError` if the field value</span>
<span class="sd">        is not supplied during deserialization.</span>
<span class="sd">    :param allow_none: Set this to `True` if `None` should be considered a valid value during</span>
<span class="sd">        validation/deserialization. If ``missing=None`` and ``allow_none`` is unset,</span>
<span class="sd">        will default to ``True``. Otherwise, the default is ``False``.</span>
<span class="sd">    :param load_only: If `True` skip this field during serialization, otherwise</span>
<span class="sd">        its value will be present in the serialized data.</span>
<span class="sd">    :param dump_only: If `True` skip this field during deserialization, otherwise</span>
<span class="sd">        its value will be present in the deserialized object. In the context of an</span>
<span class="sd">        HTTP API, this effectively marks the field as &quot;read-only&quot;.</span>
<span class="sd">    :param dict error_messages: Overrides for `Field.default_error_messages`.</span>
<span class="sd">    :param metadata: Extra information to be stored as field metadata.</span>

<span class="sd">    .. versionchanged:: 2.0.0</span>
<span class="sd">        Removed `error` parameter. Use ``error_messages`` instead.</span>

<span class="sd">    .. versionchanged:: 2.0.0</span>
<span class="sd">        Added `allow_none` parameter, which makes validation/deserialization of `None`</span>
<span class="sd">        consistent across fields.</span>

<span class="sd">    .. versionchanged:: 2.0.0</span>
<span class="sd">        Added `load_only` and `dump_only` parameters, which allow field skipping</span>
<span class="sd">        during the (de)serialization process.</span>

<span class="sd">    .. versionchanged:: 2.0.0</span>
<span class="sd">        Added `missing` parameter, which indicates the value for a field if the field</span>
<span class="sd">        is not found during deserialization.</span>

<span class="sd">    .. versionchanged:: 2.0.0</span>
<span class="sd">        ``default`` value is only used if explicitly set. Otherwise, missing values</span>
<span class="sd">        inputs are excluded from serialized output.</span>

<span class="sd">    .. versionchanged:: 3.0.0b8</span>
<span class="sd">        Add ``data_key`` parameter for the specifying the key in the input and</span>
<span class="sd">        output data. This parameter replaced both ``load_from`` and ``dump_to``.</span>
<span class="sd">    &quot;&quot;&quot;</span>

    <span class="c1"># Some fields, such as Method fields and Function fields, are not expected</span>
    <span class="c1">#  to exist as attributes on the objects to serialize. Set this to False</span>
    <span class="c1">#  for those fields</span>
    <span class="n">_CHECK_ATTRIBUTE</span> <span class="o">=</span> <span class="kc">True</span>
    <span class="n">_creation_index</span> <span class="o">=</span> <span class="mi">0</span>  <span class="c1"># Used for sorting</span>

    <span class="c1">#: Default error messages for various kinds of errors. The keys in this dictionary</span>
    <span class="c1">#: are passed to `Field.make_error`. The values are error messages passed to</span>
    <span class="c1">#: :exc:`marshmallow.exceptions.ValidationError`.</span>
    <span class="n">default_error_messages</span> <span class="o">=</span> <span class="p">{</span>
        <span class="s2">&quot;required&quot;</span><span class="p">:</span> <span class="s2">&quot;Missing data for required field.&quot;</span><span class="p">,</span>
        <span class="s2">&quot;null&quot;</span><span class="p">:</span> <span class="s2">&quot;Field may not be null.&quot;</span><span class="p">,</span>
        <span class="s2">&quot;validator_failed&quot;</span><span class="p">:</span> <span class="s2">&quot;Invalid value.&quot;</span><span class="p">,</span>
    <span class="p">}</span>

    <span class="k">def</span> <span class="fm">__init__</span><span class="p">(</span>
        <span class="bp">self</span><span class="p">,</span>
        <span class="o">*</span><span class="p">,</span>
        <span class="n">load_default</span><span class="p">:</span> <span class="n">typing</span><span class="o">.</span><span class="n">Any</span> <span class="o">=</span> <span class="n">missing_</span><span class="p">,</span>
        <span class="n">missing</span><span class="p">:</span> <span class="n">typing</span><span class="o">.</span><span class="n">Any</span> <span class="o">=</span> <span class="n">missing_</span><span class="p">,</span>
        <span class="n">dump_default</span><span class="p">:</span> <span class="n">typing</span><span class="o">.</span><span class="n">Any</span> <span class="o">=</span> <span class="n">missing_</span><span class="p">,</span>
        <span class="n">default</span><span class="p">:</span> <span class="n">typing</span><span class="o">.</span><span class="n">Any</span> <span class="o">=</span> <span class="n">missing_</span><span class="p">,</span>
        <span class="n">data_key</span><span class="p">:</span> <span class="n">typing</span><span class="o">.</span><span class="n">Optional</span><span class="p">[</span><span class="nb">str</span><span class="p">]</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span>
        <span class="n">attribute</span><span class="p">:</span> <span class="n">typing</span><span class="o">.</span><span class="n">Optional</span><span class="p">[</span><span class="nb">str</span><span class="p">]</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span>
        <span class="n">validate</span><span class="p">:</span> <span class="n">typing</span><span class="o">.</span><span class="n">Optional</span><span class="p">[</span>
            <span class="n">typing</span><span class="o">.</span><span class="n">Union</span><span class="p">[</span>
                <span class="n">typing</span><span class="o">.</span><span class="n">Callable</span><span class="p">[[</span><span class="n">typing</span><span class="o">.</span><span class="n">Any</span><span class="p">],</span> <span class="n">typing</span><span class="o">.</span><span class="n">Any</span><span class="p">],</span>
                <span class="n">typing</span><span class="o">.</span><span class="n">Iterable</span><span class="p">[</span><span class="n">typing</span><span class="o">.</span><span class="n">Callable</span><span class="p">[[</span><span class="n">typing</span><span class="o">.</span><span class="n">Any</span><span class="p">],</span> <span class="n">typing</span><span class="o">.</span><span class="n">Any</span><span class="p">]],</span>
            <span class="p">]</span>
        <span class="p">]</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span>
        <span class="n">required</span><span class="p">:</span> <span class="nb">bool</span> <span class="o">=</span> <span class="kc">False</span><span class="p">,</span>
        <span class="n">allow_none</span><span class="p">:</span> <span class="n">typing</span><span class="o">.</span><span class="n">Optional</span><span class="p">[</span><span class="nb">bool</span><span class="p">]</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span>
        <span class="n">load_only</span><span class="p">:</span> <span class="nb">bool</span> <span class="o">=</span> <span class="kc">False</span><span class="p">,</span>
        <span class="n">dump_only</span><span class="p">:</span> <span class="nb">bool</span> <span class="o">=</span> <span class="kc">False</span><span class="p">,</span>
        <span class="n">error_messages</span><span class="p">:</span> <span class="n">typing</span><span class="o">.</span><span class="n">Optional</span><span class="p">[</span><span class="n">typing</span><span class="o">.</span><span class="n">Dict</span><span class="p">[</span><span class="nb">str</span><span class="p">,</span> <span class="nb">str</span><span class="p">]]</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span>
        <span class="n">metadata</span><span class="p">:</span> <span class="n">typing</span><span class="o">.</span><span class="n">Optional</span><span class="p">[</span><span class="n">typing</span><span class="o">.</span><span class="n">Mapping</span><span class="p">[</span><span class="nb">str</span><span class="p">,</span> <span class="n">typing</span><span class="o">.</span><span class="n">Any</span><span class="p">]]</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span>
        <span class="o">**</span><span class="n">additional_metadata</span><span class="p">,</span>
    <span class="p">)</span> <span class="o">-&gt;</span> <span class="kc">None</span><span class="p">:</span>
        <span class="c1"># handle deprecated `default` and `missing` parameters</span>
        <span class="k">if</span> <span class="n">default</span> <span class="ow">is</span> <span class="ow">not</span> <span class="n">missing_</span><span class="p">:</span>
            <span class="n">warnings</span><span class="o">.</span><span class="n">warn</span><span class="p">(</span>
                <span class="s2">&quot;The &#39;default&#39; argument to fields is deprecated. &quot;</span>
                <span class="s2">&quot;Use &#39;dump_default&#39; instead.&quot;</span><span class="p">,</span>
                <span class="n">RemovedInMarshmallow4Warning</span><span class="p">,</span>
            <span class="p">)</span>
            <span class="k">if</span> <span class="n">dump_default</span> <span class="ow">is</span> <span class="n">missing_</span><span class="p">:</span>
                <span class="n">dump_default</span> <span class="o">=</span> <span class="n">default</span>
        <span class="k">if</span> <span class="n">missing</span> <span class="ow">is</span> <span class="ow">not</span> <span class="n">missing_</span><span class="p">:</span>
            <span class="n">warnings</span><span class="o">.</span><span class="n">warn</span><span class="p">(</span>
                <span class="s2">&quot;The &#39;missing&#39; argument to fields is deprecated. &quot;</span>
                <span class="s2">&quot;Use &#39;load_default&#39; instead.&quot;</span><span class="p">,</span>
                <span class="n">RemovedInMarshmallow4Warning</span><span class="p">,</span>
            <span class="p">)</span>
            <span class="k">if</span> <span class="n">load_default</span> <span class="ow">is</span> <span class="n">missing_</span><span class="p">:</span>
                <span class="n">load_default</span> <span class="o">=</span> <span class="n">missing</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">dump_default</span> <span class="o">=</span> <span class="n">dump_default</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">load_default</span> <span class="o">=</span> <span class="n">load_default</span>

        <span class="bp">self</span><span class="o">.</span><span class="n">attribute</span> <span class="o">=</span> <span class="n">attribute</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">data_key</span> <span class="o">=</span> <span class="n">data_key</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">validate</span> <span class="o">=</span> <span class="n">validate</span>
        <span class="k">if</span> <span class="n">validate</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">validators</span> <span class="o">=</span> <span class="p">[]</span>
        <span class="k">elif</span> <span class="n">callable</span><span class="p">(</span><span class="n">validate</span><span class="p">):</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">validators</span> <span class="o">=</span> <span class="p">[</span><span class="n">validate</span><span class="p">]</span>
        <span class="k">elif</span> <span class="n">utils</span><span class="o">.</span><span class="n">is_iterable_but_not_string</span><span class="p">(</span><span class="n">validate</span><span class="p">):</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">validators</span> <span class="o">=</span> <span class="nb">list</span><span class="p">(</span><span class="n">validate</span><span class="p">)</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="k">raise</span> <span class="ne">ValueError</span><span class="p">(</span>
                <span class="s2">&quot;The &#39;validate&#39; parameter must be a callable &quot;</span>
                <span class="s2">&quot;or a collection of callables.&quot;</span>
            <span class="p">)</span>

        <span class="c1"># If allow_none is None and load_default is None</span>
        <span class="c1"># None should be considered valid by default</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">allow_none</span> <span class="o">=</span> <span class="n">load_default</span> <span class="ow">is</span> <span class="kc">None</span> <span class="k">if</span> <span class="n">allow_none</span> <span class="ow">is</span> <span class="kc">None</span> <span class="k">else</span> <span class="n">allow_none</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">load_only</span> <span class="o">=</span> <span class="n">load_only</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">dump_only</span> <span class="o">=</span> <span class="n">dump_only</span>
        <span class="k">if</span> <span class="n">required</span> <span class="ow">is</span> <span class="kc">True</span> <span class="ow">and</span> <span class="n">load_default</span> <span class="ow">is</span> <span class="ow">not</span> <span class="n">missing_</span><span class="p">:</span>
            <span class="k">raise</span> <span class="ne">ValueError</span><span class="p">(</span><span class="s2">&quot;&#39;load_default&#39; must not be set for required fields.&quot;</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">required</span> <span class="o">=</span> <span class="n">required</span>

        <span class="n">metadata</span> <span class="o">=</span> <span class="n">metadata</span> <span class="ow">or</span> <span class="p">{}</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">metadata</span> <span class="o">=</span> <span class="p">{</span><span class="o">**</span><span class="n">metadata</span><span class="p">,</span> <span class="o">**</span><span class="n">additional_metadata</span><span class="p">}</span>
        <span class="k">if</span> <span class="n">additional_metadata</span><span class="p">:</span>
            <span class="n">warnings</span><span class="o">.</span><span class="n">warn</span><span class="p">(</span>
                <span class="s2">&quot;Passing field metadata as keyword arguments is deprecated. Use the &quot;</span>
                <span class="s2">&quot;explicit `metadata=...` argument instead. &quot;</span>
                <span class="sa">f</span><span class="s2">&quot;Additional metadata: </span><span class="si">{additional_metadata}</span><span class="s2">&quot;</span><span class="p">,</span>
                <span class="n">RemovedInMarshmallow4Warning</span><span class="p">,</span>
            <span class="p">)</span>

        <span class="bp">self</span><span class="o">.</span><span class="n">_creation_index</span> <span class="o">=</span> <span class="n">Field</span><span class="o">.</span><span class="n">_creation_index</span>
        <span class="n">Field</span><span class="o">.</span><span class="n">_creation_index</span> <span class="o">+=</span> <span class="mi">1</span>

        <span class="c1"># Collect default error message from self and parent classes</span>
        <span class="n">messages</span> <span class="o">=</span> <span class="p">{}</span>  <span class="c1"># type: typing.Dict[str, str]</span>
        <span class="k">for</span> <span class="bp">cls</span> <span class="ow">in</span> <span class="nb">reversed</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="vm">__class__</span><span class="o">.</span><span class="vm">__mro__</span><span class="p">):</span>
            <span class="n">messages</span><span class="o">.</span><span class="n">update</span><span class="p">(</span><span class="nb">getattr</span><span class="p">(</span><span class="bp">cls</span><span class="p">,</span> <span class="s2">&quot;default_error_messages&quot;</span><span class="p">,</span> <span class="p">{}))</span>
        <span class="n">messages</span><span class="o">.</span><span class="n">update</span><span class="p">(</span><span class="n">error_messages</span> <span class="ow">or</span> <span class="p">{})</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">error_messages</span> <span class="o">=</span> <span class="n">messages</span>

    <span class="k">def</span> <span class="fm">__repr__</span><span class="p">(</span><span class="bp">self</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="nb">str</span><span class="p">:</span>
        <span class="k">return</span> <span class="p">(</span>
            <span class="s2">&quot;&lt;fields.</span><span class="si">{ClassName}</span><span class="s2">(dump_default=</span><span class="si">{self.dump_default!r}</span><span class="s2">, &quot;</span>
            <span class="s2">&quot;attribute=</span><span class="si">{self.attribute!r}</span><span class="s2">, &quot;</span>
            <span class="s2">&quot;validate=</span><span class="si">{self.validate}</span><span class="s2">, required=</span><span class="si">{self.required}</span><span class="s2">, &quot;</span>
            <span class="s2">&quot;load_only=</span><span class="si">{self.load_only}</span><span class="s2">, dump_only=</span><span class="si">{self.dump_only}</span><span class="s2">, &quot;</span>
            <span class="s2">&quot;load_default=</span><span class="si">{self.load_default}</span><span class="s2">, allow_none=</span><span class="si">{self.allow_none}</span><span class="s2">, &quot;</span>
            <span class="s2">&quot;error_messages=</span><span class="si">{self.error_messages}</span><span class="s2">)&gt;&quot;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span>
                <span class="n">ClassName</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="vm">__class__</span><span class="o">.</span><span class="vm">__name__</span><span class="p">,</span> <span class="bp">self</span><span class="o">=</span><span class="bp">self</span>
            <span class="p">)</span>
        <span class="p">)</span>

    <span class="k">def</span> <span class="nf">__deepcopy__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">memo</span><span class="p">):</span>
        <span class="k">return</span> <span class="n">copy</span><span class="o">.</span><span class="n">copy</span><span class="p">(</span><span class="bp">self</span><span class="p">)</span>

    <span class="k">def</span> <span class="nf">get_value</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">obj</span><span class="p">,</span> <span class="n">attr</span><span class="p">,</span> <span class="n">accessor</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span> <span class="n">default</span><span class="o">=</span><span class="n">missing_</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;Return the value for a given key from an object.</span>

<span class="sd">        :param object obj: The object to get the value from.</span>
<span class="sd">        :param str attr: The attribute/key in `obj` to get the value from.</span>
<span class="sd">        :param callable accessor: A callable used to retrieve the value of `attr` from</span>
<span class="sd">            the object `obj`. Defaults to `marshmallow.utils.get_value`.</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="n">accessor_func</span> <span class="o">=</span> <span class="n">accessor</span> <span class="ow">or</span> <span class="n">utils</span><span class="o">.</span><span class="n">get_value</span>
        <span class="n">check_key</span> <span class="o">=</span> <span class="n">attr</span> <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">attribute</span> <span class="ow">is</span> <span class="kc">None</span> <span class="k">else</span> <span class="bp">self</span><span class="o">.</span><span class="n">attribute</span>
        <span class="k">return</span> <span class="n">accessor_func</span><span class="p">(</span><span class="n">obj</span><span class="p">,</span> <span class="n">check_key</span><span class="p">,</span> <span class="n">default</span><span class="p">)</span>

    <span class="k">def</span> <span class="nf">_validate</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">value</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;Perform validation on ``value``. Raise a :exc:`ValidationError` if validation</span>
<span class="sd">        does not succeed.</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_validate_all</span><span class="p">(</span><span class="n">value</span><span class="p">)</span>

    <span class="nd">@property</span>
    <span class="k">def</span> <span class="nf">_validate_all</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="k">return</span> <span class="n">And</span><span class="p">(</span><span class="o">*</span><span class="bp">self</span><span class="o">.</span><span class="n">validators</span><span class="p">,</span> <span class="n">error</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">error_messages</span><span class="p">[</span><span class="s2">&quot;validator_failed&quot;</span><span class="p">])</span>

    <span class="k">def</span> <span class="nf">make_error</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">key</span><span class="p">:</span> <span class="nb">str</span><span class="p">,</span> <span class="o">**</span><span class="n">kwargs</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="n">ValidationError</span><span class="p">:</span>
        <span class="sd">&quot;&quot;&quot;Helper method to make a `ValidationError` with an error message</span>
<span class="sd">        from ``self.error_messages``.</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="k">try</span><span class="p">:</span>
            <span class="n">msg</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">error_messages</span><span class="p">[</span><span class="n">key</span><span class="p">]</span>
        <span class="k">except</span> <span class="ne">KeyError</span> <span class="k">as</span> <span class="n">error</span><span class="p">:</span>
            <span class="n">class_name</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="vm">__class__</span><span class="o">.</span><span class="vm">__name__</span>
            <span class="n">message</span> <span class="o">=</span> <span class="p">(</span>
                <span class="s2">&quot;ValidationError raised by `</span><span class="si">{class_name}</span><span class="s2">`, but error key `</span><span class="si">{key}</span><span class="s2">` does &quot;</span>
                <span class="s2">&quot;not exist in the `error_messages` dictionary.&quot;</span>
            <span class="p">)</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">class_name</span><span class="o">=</span><span class="n">class_name</span><span class="p">,</span> <span class="n">key</span><span class="o">=</span><span class="n">key</span><span class="p">)</span>
            <span class="k">raise</span> <span class="ne">AssertionError</span><span class="p">(</span><span class="n">message</span><span class="p">)</span> <span class="kn">from</span> <span class="nn">error</span>
        <span class="k">if</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">msg</span><span class="p">,</span> <span class="p">(</span><span class="nb">str</span><span class="p">,</span> <span class="nb">bytes</span><span class="p">)):</span>
            <span class="n">msg</span> <span class="o">=</span> <span class="n">msg</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="o">**</span><span class="n">kwargs</span><span class="p">)</span>
        <span class="k">return</span> <span class="n">ValidationError</span><span class="p">(</span><span class="n">msg</span><span class="p">)</span>

    <span class="k">def</span> <span class="nf">fail</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">key</span><span class="p">:</span> <span class="nb">str</span><span class="p">,</span> <span class="o">**</span><span class="n">kwargs</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;Helper method that raises a `ValidationError` with an error message</span>
<span class="sd">        from ``self.error_messages``.</span>

<span class="sd">        .. deprecated:: 3.0.0</span>
<span class="sd">            Use `make_error &lt;marshmallow.fields.Field.make_error&gt;` instead.</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="n">warnings</span><span class="o">.</span><span class="n">warn</span><span class="p">(</span>
            <span class="s1">&#39;`Field.fail` is deprecated. Use `raise self.make_error(&quot;</span><span class="si">{}</span><span class="s1">&quot;, ...)` instead.&#39;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span>
                <span class="n">key</span>
            <span class="p">),</span>
            <span class="n">RemovedInMarshmallow4Warning</span><span class="p">,</span>
        <span class="p">)</span>
        <span class="k">raise</span> <span class="bp">self</span><span class="o">.</span><span class="n">make_error</span><span class="p">(</span><span class="n">key</span><span class="o">=</span><span class="n">key</span><span class="p">,</span> <span class="o">**</span><span class="n">kwargs</span><span class="p">)</span>

    <span class="k">def</span> <span class="nf">_validate_missing</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">value</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;Validate missing values. Raise a :exc:`ValidationError` if</span>
<span class="sd">        `value` should be considered missing.</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="k">if</span> <span class="n">value</span> <span class="ow">is</span> <span class="n">missing_</span> <span class="ow">and</span> <span class="bp">self</span><span class="o">.</span><span class="n">required</span><span class="p">:</span>
            <span class="k">raise</span> <span class="bp">self</span><span class="o">.</span><span class="n">make_error</span><span class="p">(</span><span class="s2">&quot;required&quot;</span><span class="p">)</span>
        <span class="k">if</span> <span class="n">value</span> <span class="ow">is</span> <span class="kc">None</span> <span class="ow">and</span> <span class="ow">not</span> <span class="bp">self</span><span class="o">.</span><span class="n">allow_none</span><span class="p">:</span>
            <span class="k">raise</span> <span class="bp">self</span><span class="o">.</span><span class="n">make_error</span><span class="p">(</span><span class="s2">&quot;null&quot;</span><span class="p">)</span>

    <span class="k">def</span> <span class="nf">serialize</span><span class="p">(</span>
        <span class="bp">self</span><span class="p">,</span>
        <span class="n">attr</span><span class="p">:</span> <span class="nb">str</span><span class="p">,</span>
        <span class="n">obj</span><span class="p">:</span> <span class="n">typing</span><span class="o">.</span><span class="n">Any</span><span class="p">,</span>
        <span class="n">accessor</span><span class="p">:</span> <span class="n">typing</span><span class="o">.</span><span class="n">Optional</span><span class="p">[</span>
            <span class="n">typing</span><span class="o">.</span><span class="n">Callable</span><span class="p">[[</span><span class="n">typing</span><span class="o">.</span><span class="n">Any</span><span class="p">,</span> <span class="nb">str</span><span class="p">,</span> <span class="n">typing</span><span class="o">.</span><span class="n">Any</span><span class="p">],</span> <span class="n">typing</span><span class="o">.</span><span class="n">Any</span><span class="p">]</span>
        <span class="p">]</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span>
        <span class="o">**</span><span class="n">kwargs</span><span class="p">,</span>
    <span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;Pulls the value for the given key from the object, applies the</span>
<span class="sd">        field&#39;s formatting and returns the result.</span>

<span class="sd">        :param attr: The attribute/key to get from the object.</span>
<span class="sd">        :param obj: The object to access the attribute/key from.</span>
<span class="sd">        :param accessor: Function used to access values from ``obj``.</span>
<span class="sd">        :param kwargs: Field-specific keyword arguments.</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">_CHECK_ATTRIBUTE</span><span class="p">:</span>
            <span class="n">value</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">get_value</span><span class="p">(</span><span class="n">obj</span><span class="p">,</span> <span class="n">attr</span><span class="p">,</span> <span class="n">accessor</span><span class="o">=</span><span class="n">accessor</span><span class="p">)</span>
            <span class="k">if</span> <span class="n">value</span> <span class="ow">is</span> <span class="n">missing_</span><span class="p">:</span>
                <span class="n">default</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">dump_default</span>
                <span class="n">value</span> <span class="o">=</span> <span class="n">default</span><span class="p">()</span> <span class="k">if</span> <span class="n">callable</span><span class="p">(</span><span class="n">default</span><span class="p">)</span> <span class="k">else</span> <span class="n">default</span>
            <span class="k">if</span> <span class="n">value</span> <span class="ow">is</span> <span class="n">missing_</span><span class="p">:</span>
                <span class="k">return</span> <span class="n">value</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="n">value</span> <span class="o">=</span> <span class="kc">None</span>
        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">_serialize</span><span class="p">(</span><span class="n">value</span><span class="p">,</span> <span class="n">attr</span><span class="p">,</span> <span class="n">obj</span><span class="p">,</span> <span class="o">**</span><span class="n">kwargs</span><span class="p">)</span>

    <span class="k">def</span> <span class="nf">deserialize</span><span class="p">(</span>
        <span class="bp">self</span><span class="p">,</span>
        <span class="n">value</span><span class="p">:</span> <span class="n">typing</span><span class="o">.</span><span class="n">Any</span><span class="p">,</span>
        <span class="n">attr</span><span class="p">:</span> <span class="n">typing</span><span class="o">.</span><span class="n">Optional</span><span class="p">[</span><span class="nb">str</span><span class="p">]</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span>
        <span class="n">data</span><span class="p">:</span> <span class="n">typing</span><span class="o">.</span><span class="n">Optional</span><span class="p">[</span><span class="n">typing</span><span class="o">.</span><span class="n">Mapping</span><span class="p">[</span><span class="nb">str</span><span class="p">,</span> <span class="n">typing</span><span class="o">.</span><span class="n">Any</span><span class="p">]]</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span>
        <span class="o">**</span><span class="n">kwargs</span><span class="p">,</span>
    <span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;Deserialize ``value``.</span>

<span class="sd">        :param value: The value to deserialize.</span>
<span class="sd">        :param attr: The attribute/key in `data` to deserialize.</span>
<span class="sd">        :param data: The raw input data passed to `Schema.load`.</span>
<span class="sd">        :param kwargs: Field-specific keyword arguments.</span>
<span class="sd">        :raise ValidationError: If an invalid value is passed or if a required value</span>
<span class="sd">            is missing.</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="c1"># Validate required fields, deserialize, then validate</span>
        <span class="c1"># deserialized value</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_validate_missing</span><span class="p">(</span><span class="n">value</span><span class="p">)</span>
        <span class="k">if</span> <span class="n">value</span> <span class="ow">is</span> <span class="n">missing_</span><span class="p">:</span>
            <span class="n">_miss</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">load_default</span>
            <span class="k">return</span> <span class="n">_miss</span><span class="p">()</span> <span class="k">if</span> <span class="n">callable</span><span class="p">(</span><span class="n">_miss</span><span class="p">)</span> <span class="k">else</span> <span class="n">_miss</span>
        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">allow_none</span> <span class="ow">and</span> <span class="n">value</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
            <span class="k">return</span> <span class="kc">None</span>
        <span class="n">output</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_deserialize</span><span class="p">(</span><span class="n">value</span><span class="p">,</span> <span class="n">attr</span><span class="p">,</span> <span class="n">data</span><span class="p">,</span> <span class="o">**</span><span class="n">kwargs</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_validate</span><span class="p">(</span><span class="n">output</span><span class="p">)</span>
        <span class="k">return</span> <span class="n">output</span>

    <span class="c1"># Methods for concrete classes to override.</span>

    <span class="k">def</span> <span class="nf">_bind_to_schema</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">field_name</span><span class="p">,</span> <span class="n">schema</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;Update field with values from its parent schema. Called by</span>
<span class="sd">        :meth:`Schema._bind_field &lt;marshmallow.Schema._bind_field&gt;`.</span>

<span class="sd">        :param str field_name: Field name set in schema.</span>
<span class="sd">        :param Schema|Field schema: Parent object.</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">parent</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">parent</span> <span class="ow">or</span> <span class="n">schema</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">name</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">name</span> <span class="ow">or</span> <span class="n">field_name</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">root</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">root</span> <span class="ow">or</span> <span class="p">(</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">parent</span><span class="o">.</span><span class="n">root</span> <span class="k">if</span> <span class="nb">isinstance</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">parent</span><span class="p">,</span> <span class="n">FieldABC</span><span class="p">)</span> <span class="k">else</span> <span class="bp">self</span><span class="o">.</span><span class="n">parent</span>
        <span class="p">)</span>

    <span class="k">def</span> <span class="nf">_serialize</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">value</span><span class="p">:</span> <span class="n">typing</span><span class="o">.</span><span class="n">Any</span><span class="p">,</span> <span class="n">attr</span><span class="p">:</span> <span class="nb">str</span><span class="p">,</span> <span class="n">obj</span><span class="p">:</span> <span class="n">typing</span><span class="o">.</span><span class="n">Any</span><span class="p">,</span> <span class="o">**</span><span class="n">kwargs</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;Serializes ``value`` to a basic Python datatype. Noop by default.</span>
<span class="sd">        Concrete :class:`Field` classes should implement this method.</span>

<span class="sd">        Example: ::</span>

<span class="sd">            class TitleCase(Field):</span>
<span class="sd">                def _serialize(self, value, attr, obj, **kwargs):</span>
<span class="sd">                    if not value:</span>
<span class="sd">                        return &#39;&#39;</span>
<span class="sd">                    return str(value).title()</span>

<span class="sd">        :param value: The value to be serialized.</span>
<span class="sd">        :param str attr: The attribute or key on the object to be serialized.</span>
<span class="sd">        :param object obj: The object the value was pulled from.</span>
<span class="sd">        :param dict kwargs: Field-specific keyword arguments.</span>
<span class="sd">        :return: The serialized value</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="k">return</span> <span class="n">value</span>

    <span class="k">def</span> <span class="nf">_deserialize</span><span class="p">(</span>
        <span class="bp">self</span><span class="p">,</span>
        <span class="n">value</span><span class="p">:</span> <span class="n">typing</span><span class="o">.</span><span class="n">Any</span><span class="p">,</span>
        <span class="n">attr</span><span class="p">:</span> <span class="n">typing</span><span class="o">.</span><span class="n">Optional</span><span class="p">[</span><span class="nb">str</span><span class="p">],</span>
        <span class="n">data</span><span class="p">:</span> <span class="n">typing</span><span class="o">.</span><span class="n">Optional</span><span class="p">[</span><span class="n">typing</span><span class="o">.</span><span class="n">Mapping</span><span class="p">[</span><span class="nb">str</span><span class="p">,</span> <span class="n">typing</span><span class="o">.</span><span class="n">Any</span><span class="p">]],</span>
        <span class="o">**</span><span class="n">kwargs</span><span class="p">,</span>
    <span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;Deserialize value. Concrete :class:`Field` classes should implement this method.</span>

<span class="sd">        :param value: The value to be deserialized.</span>
<span class="sd">        :param attr: The attribute/key in `data` to be deserialized.</span>
<span class="sd">        :param data: The raw input data passed to the `Schema.load`.</span>
<span class="sd">        :param kwargs: Field-specific keyword arguments.</span>
<span class="sd">        :raise ValidationError: In case of formatting or validation failure.</span>
<span class="sd">        :return: The deserialized value.</span>

<span class="sd">        .. versionchanged:: 2.0.0</span>
<span class="sd">            Added ``attr`` and ``data`` parameters.</span>

<span class="sd">        .. versionchanged:: 3.0.0</span>
<span class="sd">            Added ``**kwargs`` to signature.</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="k">return</span> <span class="n">value</span>

    <span class="c1"># Properties</span>

    <span class="nd">@property</span>
    <span class="k">def</span> <span class="nf">context</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;The context dictionary for the parent :class:`Schema`.&quot;&quot;&quot;</span>
        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">parent</span><span class="o">.</span><span class="n">context</span>

    <span class="c1"># the default and missing properties are provided for compatibility and</span>
    <span class="c1"># emit warnings when they are accessed and set</span>
    <span class="nd">@property</span>
    <span class="k">def</span> <span class="nf">default</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="n">warnings</span><span class="o">.</span><span class="n">warn</span><span class="p">(</span>
            <span class="s2">&quot;The &#39;default&#39; attribute of fields is deprecated. &quot;</span>
            <span class="s2">&quot;Use &#39;dump_default&#39; instead.&quot;</span><span class="p">,</span>
            <span class="n">RemovedInMarshmallow4Warning</span><span class="p">,</span>
        <span class="p">)</span>
        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">dump_default</span>

    <span class="nd">@default</span><span class="o">.</span><span class="n">setter</span>
    <span class="k">def</span> <span class="nf">default</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">value</span><span class="p">):</span>
        <span class="n">warnings</span><span class="o">.</span><span class="n">warn</span><span class="p">(</span>
            <span class="s2">&quot;The &#39;default&#39; attribute of fields is deprecated. &quot;</span>
            <span class="s2">&quot;Use &#39;dump_default&#39; instead.&quot;</span><span class="p">,</span>
            <span class="n">RemovedInMarshmallow4Warning</span><span class="p">,</span>
        <span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">dump_default</span> <span class="o">=</span> <span class="n">value</span>

    <span class="nd">@property</span>
    <span class="k">def</span> <span class="nf">missing</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="n">warnings</span><span class="o">.</span><span class="n">warn</span><span class="p">(</span>
            <span class="s2">&quot;The &#39;missing&#39; attribute of fields is deprecated. &quot;</span>
            <span class="s2">&quot;Use &#39;load_default&#39; instead.&quot;</span><span class="p">,</span>
            <span class="n">RemovedInMarshmallow4Warning</span><span class="p">,</span>
        <span class="p">)</span>
        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">load_default</span>

    <span class="nd">@missing</span><span class="o">.</span><span class="n">setter</span>
    <span class="k">def</span> <span class="nf">missing</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">value</span><span class="p">):</span>
        <span class="n">warnings</span><span class="o">.</span><span class="n">warn</span><span class="p">(</span>
            <span class="s2">&quot;The &#39;missing&#39; attribute of fields is deprecated. &quot;</span>
            <span class="s2">&quot;Use &#39;load_default&#39; instead.&quot;</span><span class="p">,</span>
            <span class="n">RemovedInMarshmallow4Warning</span><span class="p">,</span>
        <span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">load_default</span> <span class="o">=</span> <span class="n">value</span>


<span class="k">class</span> <span class="nc">Raw</span><span class="p">(</span><span class="n">Field</span><span class="p">):</span>
    <span class="sd">&quot;&quot;&quot;Field that applies no formatting.&quot;&quot;&quot;</span>


<span class="k">class</span> <span class="nc">Nested</span><span class="p">(</span><span class="n">Field</span><span class="p">):</span>
    <span class="sd">&quot;&quot;&quot;Allows you to nest a :class:`Schema &lt;marshmallow.Schema&gt;`</span>
<span class="sd">    inside a field.</span>

<span class="sd">    Examples: ::</span>

<span class="sd">        class ChildSchema(Schema):</span>
<span class="sd">            id = fields.Str()</span>
<span class="sd">            name = fields.Str()</span>
<span class="sd">            # Use lambda functions when you need two-way nesting or self-nesting</span>
<span class="sd">            parent = fields.Nested(lambda: ParentSchema(only=(&quot;id&quot;,)), dump_only=True)</span>
<span class="sd">            siblings = fields.List(fields.Nested(lambda: ChildSchema(only=(&quot;id&quot;, &quot;name&quot;))))</span>

<span class="sd">        class ParentSchema(Schema):</span>
<span class="sd">            id = fields.Str()</span>
<span class="sd">            children = fields.List(</span>
<span class="sd">                fields.Nested(ChildSchema(only=(&quot;id&quot;, &quot;parent&quot;, &quot;siblings&quot;)))</span>
<span class="sd">            )</span>
<span class="sd">            spouse = fields.Nested(lambda: ParentSchema(only=(&quot;id&quot;,)))</span>

<span class="sd">    When passing a `Schema &lt;marshmallow.Schema&gt;` instance as the first argument,</span>
<span class="sd">    the instance&#39;s ``exclude``, ``only``, and ``many`` attributes will be respected.</span>

<span class="sd">    Therefore, when passing the ``exclude``, ``only``, or ``many`` arguments to `fields.Nested`,</span>
<span class="sd">    you should pass a `Schema &lt;marshmallow.Schema&gt;` class (not an instance) as the first argument.</span>

<span class="sd">    ::</span>

<span class="sd">        # Yes</span>
<span class="sd">        author = fields.Nested(UserSchema, only=(&#39;id&#39;, &#39;name&#39;))</span>

<span class="sd">        # No</span>
<span class="sd">        author = fields.Nested(UserSchema(), only=(&#39;id&#39;, &#39;name&#39;))</span>

<span class="sd">    :param nested: `Schema` instance, class, class name (string), or callable that returns a `Schema` instance.</span>
<span class="sd">    :param exclude: A list or tuple of fields to exclude.</span>
<span class="sd">    :param only: A list or tuple of fields to marshal. If `None`, all fields are marshalled.</span>
<span class="sd">        This parameter takes precedence over ``exclude``.</span>
<span class="sd">    :param many: Whether the field is a collection of objects.</span>
<span class="sd">    :param unknown: Whether to exclude, include, or raise an error for unknown</span>
<span class="sd">        fields in the data. Use `EXCLUDE`, `INCLUDE` or `RAISE`.</span>
<span class="sd">    :param kwargs: The same keyword arguments that :class:`Field` receives.</span>
<span class="sd">    &quot;&quot;&quot;</span>

    <span class="c1">#: Default error messages.</span>
    <span class="n">default_error_messages</span> <span class="o">=</span> <span class="p">{</span><span class="s2">&quot;type&quot;</span><span class="p">:</span> <span class="s2">&quot;Invalid type.&quot;</span><span class="p">}</span>

    <span class="k">def</span> <span class="fm">__init__</span><span class="p">(</span>
        <span class="bp">self</span><span class="p">,</span>
        <span class="n">nested</span><span class="p">:</span> <span class="n">typing</span><span class="o">.</span><span class="n">Union</span><span class="p">[</span><span class="n">SchemaABC</span><span class="p">,</span> <span class="nb">type</span><span class="p">,</span> <span class="nb">str</span><span class="p">,</span> <span class="n">typing</span><span class="o">.</span><span class="n">Callable</span><span class="p">[[],</span> <span class="n">SchemaABC</span><span class="p">]],</span>
        <span class="o">*</span><span class="p">,</span>
        <span class="n">dump_default</span><span class="p">:</span> <span class="n">typing</span><span class="o">.</span><span class="n">Any</span> <span class="o">=</span> <span class="n">missing_</span><span class="p">,</span>
        <span class="n">default</span><span class="p">:</span> <span class="n">typing</span><span class="o">.</span><span class="n">Any</span> <span class="o">=</span> <span class="n">missing_</span><span class="p">,</span>
        <span class="n">only</span><span class="p">:</span> <span class="n">typing</span><span class="o">.</span><span class="n">Optional</span><span class="p">[</span><span class="n">types</span><span class="o">.</span><span class="n">StrSequenceOrSet</span><span class="p">]</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span>
        <span class="n">exclude</span><span class="p">:</span> <span class="n">types</span><span class="o">.</span><span class="n">StrSequenceOrSet</span> <span class="o">=</span> <span class="p">(),</span>
        <span class="n">many</span><span class="p">:</span> <span class="nb">bool</span> <span class="o">=</span> <span class="kc">False</span><span class="p">,</span>
        <span class="n">unknown</span><span class="p">:</span> <span class="n">typing</span><span class="o">.</span><span class="n">Optional</span><span class="p">[</span><span class="nb">str</span><span class="p">]</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span>
        <span class="o">**</span><span class="n">kwargs</span><span class="p">,</span>
    <span class="p">):</span>
        <span class="c1"># Raise error if only or exclude is passed as string, not list of strings</span>
        <span class="k">if</span> <span class="n">only</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span> <span class="ow">and</span> <span class="ow">not</span> <span class="n">is_collection</span><span class="p">(</span><span class="n">only</span><span class="p">):</span>
            <span class="k">raise</span> <span class="n">StringNotCollectionError</span><span class="p">(</span><span class="s1">&#39;&quot;only&quot; should be a collection of strings.&#39;</span><span class="p">)</span>
        <span class="k">if</span> <span class="ow">not</span> <span class="n">is_collection</span><span class="p">(</span><span class="n">exclude</span><span class="p">):</span>
            <span class="k">raise</span> <span class="n">StringNotCollectionError</span><span class="p">(</span>
                <span class="s1">&#39;&quot;exclude&quot; should be a collection of strings.&#39;</span>
            <span class="p">)</span>
        <span class="k">if</span> <span class="n">nested</span> <span class="o">==</span> <span class="s2">&quot;self&quot;</span><span class="p">:</span>
            <span class="n">warnings</span><span class="o">.</span><span class="n">warn</span><span class="p">(</span>
                <span class="s2">&quot;Passing &#39;self&#39; to `Nested` is deprecated. &quot;</span>
                <span class="s2">&quot;Use `Nested(lambda: MySchema(...))` instead.&quot;</span><span class="p">,</span>
                <span class="n">RemovedInMarshmallow4Warning</span><span class="p">,</span>
            <span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">nested</span> <span class="o">=</span> <span class="n">nested</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">only</span> <span class="o">=</span> <span class="n">only</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">exclude</span> <span class="o">=</span> <span class="n">exclude</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">many</span> <span class="o">=</span> <span class="n">many</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">unknown</span> <span class="o">=</span> <span class="n">unknown</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_schema</span> <span class="o">=</span> <span class="kc">None</span>  <span class="c1"># Cached Schema instance</span>
        <span class="nb">super</span><span class="p">()</span><span class="o">.</span><span class="fm">__init__</span><span class="p">(</span><span class="n">default</span><span class="o">=</span><span class="n">default</span><span class="p">,</span> <span class="n">dump_default</span><span class="o">=</span><span class="n">dump_default</span><span class="p">,</span> <span class="o">**</span><span class="n">kwargs</span><span class="p">)</span>

    <span class="nd">@property</span>
    <span class="k">def</span> <span class="nf">schema</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;The nested Schema object.</span>

<span class="sd">        .. versionchanged:: 1.0.0</span>
<span class="sd">            Renamed from `serializer` to `schema`.</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="k">if</span> <span class="ow">not</span> <span class="bp">self</span><span class="o">.</span><span class="n">_schema</span><span class="p">:</span>
            <span class="c1"># Inherit context from parent.</span>
            <span class="n">context</span> <span class="o">=</span> <span class="nb">getattr</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">parent</span><span class="p">,</span> <span class="s2">&quot;context&quot;</span><span class="p">,</span> <span class="p">{})</span>
            <span class="k">if</span> <span class="n">callable</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">nested</span><span class="p">)</span> <span class="ow">and</span> <span class="ow">not</span> <span class="nb">isinstance</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">nested</span><span class="p">,</span> <span class="nb">type</span><span class="p">):</span>
                <span class="n">nested</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">nested</span><span class="p">()</span>
            <span class="k">else</span><span class="p">:</span>
                <span class="n">nested</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">nested</span>

            <span class="k">if</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">nested</span><span class="p">,</span> <span class="n">SchemaABC</span><span class="p">):</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">_schema</span> <span class="o">=</span> <span class="n">copy</span><span class="o">.</span><span class="n">copy</span><span class="p">(</span><span class="n">nested</span><span class="p">)</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">_schema</span><span class="o">.</span><span class="n">context</span><span class="o">.</span><span class="n">update</span><span class="p">(</span><span class="n">context</span><span class="p">)</span>
                <span class="c1"># Respect only and exclude passed from parent and re-initialize fields</span>
                <span class="n">set_class</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_schema</span><span class="o">.</span><span class="n">set_class</span>
                <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">only</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">:</span>
                    <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">_schema</span><span class="o">.</span><span class="n">only</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">:</span>
                        <span class="n">original</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_schema</span><span class="o">.</span><span class="n">only</span>
                    <span class="k">else</span><span class="p">:</span>  <span class="c1"># only=None -&gt; all fields</span>
                        <span class="n">original</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_schema</span><span class="o">.</span><span class="n">fields</span><span class="o">.</span><span class="n">keys</span><span class="p">()</span>
                    <span class="bp">self</span><span class="o">.</span><span class="n">_schema</span><span class="o">.</span><span class="n">only</span> <span class="o">=</span> <span class="n">set_class</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">only</span><span class="p">)</span> <span class="o">&amp;</span> <span class="n">set_class</span><span class="p">(</span><span class="n">original</span><span class="p">)</span>
                <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">exclude</span><span class="p">:</span>
                    <span class="n">original</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_schema</span><span class="o">.</span><span class="n">exclude</span>
                    <span class="bp">self</span><span class="o">.</span><span class="n">_schema</span><span class="o">.</span><span class="n">exclude</span> <span class="o">=</span> <span class="n">set_class</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">exclude</span><span class="p">)</span> <span class="o">|</span> <span class="n">set_class</span><span class="p">(</span><span class="n">original</span><span class="p">)</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">_schema</span><span class="o">.</span><span class="n">_init_fields</span><span class="p">()</span>
            <span class="k">else</span><span class="p">:</span>
                <span class="k">if</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">nested</span><span class="p">,</span> <span class="nb">type</span><span class="p">)</span> <span class="ow">and</span> <span class="nb">issubclass</span><span class="p">(</span><span class="n">nested</span><span class="p">,</span> <span class="n">SchemaABC</span><span class="p">):</span>
                    <span class="n">schema_class</span> <span class="o">=</span> <span class="n">nested</span>
                <span class="k">elif</span> <span class="ow">not</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">nested</span><span class="p">,</span> <span class="p">(</span><span class="nb">str</span><span class="p">,</span> <span class="nb">bytes</span><span class="p">)):</span>
                    <span class="k">raise</span> <span class="ne">ValueError</span><span class="p">(</span>
                        <span class="s2">&quot;`Nested` fields must be passed a &quot;</span>
                        <span class="s2">&quot;`Schema`, not </span><span class="si">{}</span><span class="s2">.&quot;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">nested</span><span class="o">.</span><span class="vm">__class__</span><span class="p">)</span>
                    <span class="p">)</span>
                <span class="k">elif</span> <span class="n">nested</span> <span class="o">==</span> <span class="s2">&quot;self&quot;</span><span class="p">:</span>
                    <span class="n">schema_class</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">root</span><span class="o">.</span><span class="vm">__class__</span>
                <span class="k">else</span><span class="p">:</span>
                    <span class="n">schema_class</span> <span class="o">=</span> <span class="n">class_registry</span><span class="o">.</span><span class="n">get_class</span><span class="p">(</span><span class="n">nested</span><span class="p">)</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">_schema</span> <span class="o">=</span> <span class="n">schema_class</span><span class="p">(</span>
                    <span class="n">many</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">many</span><span class="p">,</span>
                    <span class="n">only</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">only</span><span class="p">,</span>
                    <span class="n">exclude</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">exclude</span><span class="p">,</span>
                    <span class="n">context</span><span class="o">=</span><span class="n">context</span><span class="p">,</span>
                    <span class="n">load_only</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">_nested_normalized_option</span><span class="p">(</span><span class="s2">&quot;load_only&quot;</span><span class="p">),</span>
                    <span class="n">dump_only</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">_nested_normalized_option</span><span class="p">(</span><span class="s2">&quot;dump_only&quot;</span><span class="p">),</span>
                <span class="p">)</span>
        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">_schema</span>

    <span class="k">def</span> <span class="nf">_nested_normalized_option</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">option_name</span><span class="p">:</span> <span class="nb">str</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="n">typing</span><span class="o">.</span><span class="n">List</span><span class="p">[</span><span class="nb">str</span><span class="p">]:</span>
        <span class="n">nested_field</span> <span class="o">=</span> <span class="s2">&quot;</span><span class="si">%s</span><span class="s2">.&quot;</span> <span class="o">%</span> <span class="bp">self</span><span class="o">.</span><span class="n">name</span>
        <span class="k">return</span> <span class="p">[</span>
            <span class="n">field</span><span class="o">.</span><span class="n">split</span><span class="p">(</span><span class="n">nested_field</span><span class="p">,</span> <span class="mi">1</span><span class="p">)[</span><span class="mi">1</span><span class="p">]</span>
            <span class="k">for</span> <span class="n">field</span> <span class="ow">in</span> <span class="nb">getattr</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">root</span><span class="p">,</span> <span class="n">option_name</span><span class="p">,</span> <span class="nb">set</span><span class="p">())</span>
            <span class="k">if</span> <span class="n">field</span><span class="o">.</span><span class="n">startswith</span><span class="p">(</span><span class="n">nested_field</span><span class="p">)</span>
        <span class="p">]</span>

    <span class="k">def</span> <span class="nf">_serialize</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">nested_obj</span><span class="p">,</span> <span class="n">attr</span><span class="p">,</span> <span class="n">obj</span><span class="p">,</span> <span class="o">**</span><span class="n">kwargs</span><span class="p">):</span>
        <span class="c1"># Load up the schema first. This allows a RegistryError to be raised</span>
        <span class="c1"># if an invalid schema name was passed</span>
        <span class="n">schema</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">schema</span>
        <span class="k">if</span> <span class="n">nested_obj</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
            <span class="k">return</span> <span class="kc">None</span>
        <span class="n">many</span> <span class="o">=</span> <span class="n">schema</span><span class="o">.</span><span class="n">many</span> <span class="ow">or</span> <span class="bp">self</span><span class="o">.</span><span class="n">many</span>
        <span class="k">return</span> <span class="n">schema</span><span class="o">.</span><span class="n">dump</span><span class="p">(</span><span class="n">nested_obj</span><span class="p">,</span> <span class="n">many</span><span class="o">=</span><span class="n">many</span><span class="p">)</span>

    <span class="k">def</span> <span class="nf">_test_collection</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">value</span><span class="p">):</span>
        <span class="n">many</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">schema</span><span class="o">.</span><span class="n">many</span> <span class="ow">or</span> <span class="bp">self</span><span class="o">.</span><span class="n">many</span>
        <span class="k">if</span> <span class="n">many</span> <span class="ow">and</span> <span class="ow">not</span> <span class="n">utils</span><span class="o">.</span><span class="n">is_collection</span><span class="p">(</span><span class="n">value</span><span class="p">):</span>
            <span class="k">raise</span> <span class="bp">self</span><span class="o">.</span><span class="n">make_error</span><span class="p">(</span><span class="s2">&quot;type&quot;</span><span class="p">,</span> <span class="nb">input</span><span class="o">=</span><span class="n">value</span><span class="p">,</span> <span class="nb">type</span><span class="o">=</span><span class="n">value</span><span class="o">.</span><span class="vm">__class__</span><span class="o">.</span><span class="vm">__name__</span><span class="p">)</span>

    <span class="k">def</span> <span class="nf">_load</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">value</span><span class="p">,</span> <span class="n">data</span><span class="p">,</span> <span class="n">partial</span><span class="o">=</span><span class="kc">None</span><span class="p">):</span>
        <span class="k">try</span><span class="p">:</span>
            <span class="n">valid_data</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">schema</span><span class="o">.</span><span class="n">load</span><span class="p">(</span><span class="n">value</span><span class="p">,</span> <span class="n">unknown</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">unknown</span><span class="p">,</span> <span class="n">partial</span><span class="o">=</span><span class="n">partial</span><span class="p">)</span>
        <span class="k">except</span> <span class="n">ValidationError</span> <span class="k">as</span> <span class="n">error</span><span class="p">:</span>
            <span class="k">raise</span> <span class="n">ValidationError</span><span class="p">(</span>
                <span class="n">error</span><span class="o">.</span><span class="n">messages</span><span class="p">,</span> <span class="n">valid_data</span><span class="o">=</span><span class="n">error</span><span class="o">.</span><span class="n">valid_data</span>
            <span class="p">)</span> <span class="kn">from</span> <span class="nn">error</span>
        <span class="k">return</span> <span class="n">valid_data</span>

    <span class="k">def</span> <span class="nf">_deserialize</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">value</span><span class="p">,</span> <span class="n">attr</span><span class="p">,</span> <span class="n">data</span><span class="p">,</span> <span class="n">partial</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span> <span class="o">**</span><span class="n">kwargs</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;Same as :meth:`Field._deserialize` with additional ``partial`` argument.</span>

<span class="sd">        :param bool|tuple partial: For nested schemas, the ``partial``</span>
<span class="sd">            parameter passed to `Schema.load`.</span>

<span class="sd">        .. versionchanged:: 3.0.0</span>
<span class="sd">            Add ``partial`` parameter.</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_test_collection</span><span class="p">(</span><span class="n">value</span><span class="p">)</span>
        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">_load</span><span class="p">(</span><span class="n">value</span><span class="p">,</span> <span class="n">data</span><span class="p">,</span> <span class="n">partial</span><span class="o">=</span><span class="n">partial</span><span class="p">)</span>


<span class="k">class</span> <span class="nc">Pluck</span><span class="p">(</span><span class="n">Nested</span><span class="p">):</span>
    <span class="sd">&quot;&quot;&quot;Allows you to replace nested data with one of the data&#39;s fields.</span>

<span class="sd">    Example: ::</span>

<span class="sd">        from marshmallow import Schema, fields</span>

<span class="sd">        class ArtistSchema(Schema):</span>
<span class="sd">            id = fields.Int()</span>
<span class="sd">            name = fields.Str()</span>

<span class="sd">        class AlbumSchema(Schema):</span>
<span class="sd">            artist = fields.Pluck(ArtistSchema, &#39;id&#39;)</span>


<span class="sd">        in_data = {&#39;artist&#39;: 42}</span>
<span class="sd">        loaded = AlbumSchema().load(in_data) # =&gt; {&#39;artist&#39;: {&#39;id&#39;: 42}}</span>
<span class="sd">        dumped = AlbumSchema().dump(loaded)  # =&gt; {&#39;artist&#39;: 42}</span>

<span class="sd">    :param Schema nested: The Schema class or class name (string)</span>
<span class="sd">        to nest, or ``&quot;self&quot;`` to nest the :class:`Schema` within itself.</span>
<span class="sd">    :param str field_name: The key to pluck a value from.</span>
<span class="sd">    :param kwargs: The same keyword arguments that :class:`Nested` receives.</span>
<span class="sd">    &quot;&quot;&quot;</span>

    <span class="k">def</span> <span class="fm">__init__</span><span class="p">(</span>
        <span class="bp">self</span><span class="p">,</span>
        <span class="n">nested</span><span class="p">:</span> <span class="n">typing</span><span class="o">.</span><span class="n">Union</span><span class="p">[</span><span class="n">SchemaABC</span><span class="p">,</span> <span class="nb">type</span><span class="p">,</span> <span class="nb">str</span><span class="p">,</span> <span class="n">typing</span><span class="o">.</span><span class="n">Callable</span><span class="p">[[],</span> <span class="n">SchemaABC</span><span class="p">]],</span>
        <span class="n">field_name</span><span class="p">:</span> <span class="nb">str</span><span class="p">,</span>
        <span class="o">**</span><span class="n">kwargs</span><span class="p">,</span>
    <span class="p">):</span>
        <span class="nb">super</span><span class="p">()</span><span class="o">.</span><span class="fm">__init__</span><span class="p">(</span><span class="n">nested</span><span class="p">,</span> <span class="n">only</span><span class="o">=</span><span class="p">(</span><span class="n">field_name</span><span class="p">,),</span> <span class="o">**</span><span class="n">kwargs</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">field_name</span> <span class="o">=</span> <span class="n">field_name</span>

    <span class="nd">@property</span>
    <span class="k">def</span> <span class="nf">_field_data_key</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="n">only_field</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">schema</span><span class="o">.</span><span class="n">fields</span><span class="p">[</span><span class="bp">self</span><span class="o">.</span><span class="n">field_name</span><span class="p">]</span>
        <span class="k">return</span> <span class="n">only_field</span><span class="o">.</span><span class="n">data_key</span> <span class="ow">or</span> <span class="bp">self</span><span class="o">.</span><span class="n">field_name</span>

    <span class="k">def</span> <span class="nf">_serialize</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">nested_obj</span><span class="p">,</span> <span class="n">attr</span><span class="p">,</span> <span class="n">obj</span><span class="p">,</span> <span class="o">**</span><span class="n">kwargs</span><span class="p">):</span>
        <span class="n">ret</span> <span class="o">=</span> <span class="nb">super</span><span class="p">()</span><span class="o">.</span><span class="n">_serialize</span><span class="p">(</span><span class="n">nested_obj</span><span class="p">,</span> <span class="n">attr</span><span class="p">,</span> <span class="n">obj</span><span class="p">,</span> <span class="o">**</span><span class="n">kwargs</span><span class="p">)</span>
        <span class="k">if</span> <span class="n">ret</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
            <span class="k">return</span> <span class="kc">None</span>
        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">many</span><span class="p">:</span>
            <span class="k">return</span> <span class="n">utils</span><span class="o">.</span><span class="n">pluck</span><span class="p">(</span><span class="n">ret</span><span class="p">,</span> <span class="n">key</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">_field_data_key</span><span class="p">)</span>
        <span class="k">return</span> <span class="n">ret</span><span class="p">[</span><span class="bp">self</span><span class="o">.</span><span class="n">_field_data_key</span><span class="p">]</span>

    <span class="k">def</span> <span class="nf">_deserialize</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">value</span><span class="p">,</span> <span class="n">attr</span><span class="p">,</span> <span class="n">data</span><span class="p">,</span> <span class="n">partial</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span> <span class="o">**</span><span class="n">kwargs</span><span class="p">):</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_test_collection</span><span class="p">(</span><span class="n">value</span><span class="p">)</span>
        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">many</span><span class="p">:</span>
            <span class="n">value</span> <span class="o">=</span> <span class="p">[{</span><span class="bp">self</span><span class="o">.</span><span class="n">_field_data_key</span><span class="p">:</span> <span class="n">v</span><span class="p">}</span> <span class="k">for</span> <span class="n">v</span> <span class="ow">in</span> <span class="n">value</span><span class="p">]</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="n">value</span> <span class="o">=</span> <span class="p">{</span><span class="bp">self</span><span class="o">.</span><span class="n">_field_data_key</span><span class="p">:</span> <span class="n">value</span><span class="p">}</span>
        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">_load</span><span class="p">(</span><span class="n">value</span><span class="p">,</span> <span class="n">data</span><span class="p">,</span> <span class="n">partial</span><span class="o">=</span><span class="n">partial</span><span class="p">)</span>


<span class="k">class</span> <span class="nc">List</span><span class="p">(</span><span class="n">Field</span><span class="p">):</span>
    <span class="sd">&quot;&quot;&quot;A list field, composed with another `Field` class or</span>
<span class="sd">    instance.</span>

<span class="sd">    Example: ::</span>

<span class="sd">        numbers = fields.List(fields.Float())</span>

<span class="sd">    :param cls_or_instance: A field class or instance.</span>
<span class="sd">    :param kwargs: The same keyword arguments that :class:`Field` receives.</span>

<span class="sd">    .. versionchanged:: 2.0.0</span>
<span class="sd">        The ``allow_none`` parameter now applies to deserialization and</span>
<span class="sd">        has the same semantics as the other fields.</span>

<span class="sd">    .. versionchanged:: 3.0.0rc9</span>
<span class="sd">        Does not serialize scalar values to single-item lists.</span>
<span class="sd">    &quot;&quot;&quot;</span>

    <span class="c1">#: Default error messages.</span>
    <span class="n">default_error_messages</span> <span class="o">=</span> <span class="p">{</span><span class="s2">&quot;invalid&quot;</span><span class="p">:</span> <span class="s2">&quot;Not a valid list.&quot;</span><span class="p">}</span>

    <span class="k">def</span> <span class="fm">__init__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">cls_or_instance</span><span class="p">:</span> <span class="n">typing</span><span class="o">.</span><span class="n">Union</span><span class="p">[</span><span class="n">Field</span><span class="p">,</span> <span class="nb">type</span><span class="p">],</span> <span class="o">**</span><span class="n">kwargs</span><span class="p">):</span>
        <span class="nb">super</span><span class="p">()</span><span class="o">.</span><span class="fm">__init__</span><span class="p">(</span><span class="o">**</span><span class="n">kwargs</span><span class="p">)</span>
        <span class="k">try</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">inner</span> <span class="o">=</span> <span class="n">resolve_field_instance</span><span class="p">(</span><span class="n">cls_or_instance</span><span class="p">)</span>
        <span class="k">except</span> <span class="n">FieldInstanceResolutionError</span> <span class="k">as</span> <span class="n">error</span><span class="p">:</span>
            <span class="k">raise</span> <span class="ne">ValueError</span><span class="p">(</span>
                <span class="s2">&quot;The list elements must be a subclass or instance of &quot;</span>
                <span class="s2">&quot;marshmallow.base.FieldABC.&quot;</span>
            <span class="p">)</span> <span class="kn">from</span> <span class="nn">error</span>
        <span class="k">if</span> <span class="nb">isinstance</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">inner</span><span class="p">,</span> <span class="n">Nested</span><span class="p">):</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">only</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">inner</span><span class="o">.</span><span class="n">only</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">exclude</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">inner</span><span class="o">.</span><span class="n">exclude</span>

    <span class="k">def</span> <span class="nf">_bind_to_schema</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">field_name</span><span class="p">,</span> <span class="n">schema</span><span class="p">):</span>
        <span class="nb">super</span><span class="p">()</span><span class="o">.</span><span class="n">_bind_to_schema</span><span class="p">(</span><span class="n">field_name</span><span class="p">,</span> <span class="n">schema</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">inner</span> <span class="o">=</span> <span class="n">copy</span><span class="o">.</span><span class="n">deepcopy</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">inner</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">inner</span><span class="o">.</span><span class="n">_bind_to_schema</span><span class="p">(</span><span class="n">field_name</span><span class="p">,</span> <span class="bp">self</span><span class="p">)</span>
        <span class="k">if</span> <span class="nb">isinstance</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">inner</span><span class="p">,</span> <span class="n">Nested</span><span class="p">):</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">inner</span><span class="o">.</span><span class="n">only</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">only</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">inner</span><span class="o">.</span><span class="n">exclude</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">exclude</span>

    <span class="k">def</span> <span class="nf">_serialize</span><span class="p">(</span>
        <span class="bp">self</span><span class="p">,</span> <span class="n">value</span><span class="p">,</span> <span class="n">attr</span><span class="p">,</span> <span class="n">obj</span><span class="p">,</span> <span class="o">**</span><span class="n">kwargs</span>
    <span class="p">)</span> <span class="o">-&gt;</span> <span class="n">typing</span><span class="o">.</span><span class="n">Optional</span><span class="p">[</span><span class="n">typing</span><span class="o">.</span><span class="n">List</span><span class="p">[</span><span class="n">typing</span><span class="o">.</span><span class="n">Any</span><span class="p">]]:</span>
        <span class="k">if</span> <span class="n">value</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
            <span class="k">return</span> <span class="kc">None</span>
        <span class="k">return</span> <span class="p">[</span><span class="bp">self</span><span class="o">.</span><span class="n">inner</span><span class="o">.</span><span class="n">_serialize</span><span class="p">(</span><span class="n">each</span><span class="p">,</span> <span class="n">attr</span><span class="p">,</span> <span class="n">obj</span><span class="p">,</span> <span class="o">**</span><span class="n">kwargs</span><span class="p">)</span> <span class="k">for</span> <span class="n">each</span> <span class="ow">in</span> <span class="n">value</span><span class="p">]</span>

    <span class="k">def</span> <span class="nf">_deserialize</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">value</span><span class="p">,</span> <span class="n">attr</span><span class="p">,</span> <span class="n">data</span><span class="p">,</span> <span class="o">**</span><span class="n">kwargs</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="n">typing</span><span class="o">.</span><span class="n">List</span><span class="p">[</span><span class="n">typing</span><span class="o">.</span><span class="n">Any</span><span class="p">]:</span>
        <span class="k">if</span> <span class="ow">not</span> <span class="n">utils</span><span class="o">.</span><span class="n">is_collection</span><span class="p">(</span><span class="n">value</span><span class="p">):</span>
            <span class="k">raise</span> <span class="bp">self</span><span class="o">.</span><span class="n">make_error</span><span class="p">(</span><span class="s2">&quot;invalid&quot;</span><span class="p">)</span>

        <span class="n">result</span> <span class="o">=</span> <span class="p">[]</span>
        <span class="n">errors</span> <span class="o">=</span> <span class="p">{}</span>
        <span class="k">for</span> <span class="n">idx</span><span class="p">,</span> <span class="n">each</span> <span class="ow">in</span> <span class="nb">enumerate</span><span class="p">(</span><span class="n">value</span><span class="p">):</span>
            <span class="k">try</span><span class="p">:</span>
                <span class="n">result</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">inner</span><span class="o">.</span><span class="n">deserialize</span><span class="p">(</span><span class="n">each</span><span class="p">,</span> <span class="o">**</span><span class="n">kwargs</span><span class="p">))</span>
            <span class="k">except</span> <span class="n">ValidationError</span> <span class="k">as</span> <span class="n">error</span><span class="p">:</span>
                <span class="k">if</span> <span class="n">error</span><span class="o">.</span><span class="n">valid_data</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">:</span>
                    <span class="n">result</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">error</span><span class="o">.</span><span class="n">valid_data</span><span class="p">)</span>
                <span class="n">errors</span><span class="o">.</span><span class="n">update</span><span class="p">({</span><span class="n">idx</span><span class="p">:</span> <span class="n">error</span><span class="o">.</span><span class="n">messages</span><span class="p">})</span>
        <span class="k">if</span> <span class="n">errors</span><span class="p">:</span>
            <span class="k">raise</span> <span class="n">ValidationError</span><span class="p">(</span><span class="n">errors</span><span class="p">,</span> <span class="n">valid_data</span><span class="o">=</span><span class="n">result</span><span class="p">)</span>
        <span class="k">return</span> <span class="n">result</span>


<span class="k">class</span> <span class="nc">Tuple</span><span class="p">(</span><span class="n">Field</span><span class="p">):</span>
    <span class="sd">&quot;&quot;&quot;A tuple field, composed of a fixed number of other `Field` classes or</span>
<span class="sd">    instances</span>

<span class="sd">    Example: ::</span>

<span class="sd">        row = Tuple((fields.String(), fields.Integer(), fields.Float()))</span>

<span class="sd">    .. note::</span>
<span class="sd">        Because of the structured nature of `collections.namedtuple` and</span>
<span class="sd">        `typing.NamedTuple`, using a Schema within a Nested field for them is</span>
<span class="sd">        more appropriate than using a `Tuple` field.</span>

<span class="sd">    :param Iterable[Field] tuple_fields: An iterable of field classes or</span>
<span class="sd">        instances.</span>
<span class="sd">    :param kwargs: The same keyword arguments that :class:`Field` receives.</span>

<span class="sd">    .. versionadded:: 3.0.0rc4</span>
<span class="sd">    &quot;&quot;&quot;</span>

    <span class="c1">#: Default error messages.</span>
    <span class="n">default_error_messages</span> <span class="o">=</span> <span class="p">{</span><span class="s2">&quot;invalid&quot;</span><span class="p">:</span> <span class="s2">&quot;Not a valid tuple.&quot;</span><span class="p">}</span>

    <span class="k">def</span> <span class="fm">__init__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">tuple_fields</span><span class="p">,</span> <span class="o">*</span><span class="n">args</span><span class="p">,</span> <span class="o">**</span><span class="n">kwargs</span><span class="p">):</span>
        <span class="nb">super</span><span class="p">()</span><span class="o">.</span><span class="fm">__init__</span><span class="p">(</span><span class="o">*</span><span class="n">args</span><span class="p">,</span> <span class="o">**</span><span class="n">kwargs</span><span class="p">)</span>
        <span class="k">if</span> <span class="ow">not</span> <span class="n">utils</span><span class="o">.</span><span class="n">is_collection</span><span class="p">(</span><span class="n">tuple_fields</span><span class="p">):</span>
            <span class="k">raise</span> <span class="ne">ValueError</span><span class="p">(</span>
                <span class="s2">&quot;tuple_fields must be an iterable of Field classes or &quot;</span> <span class="s2">&quot;instances.&quot;</span>
            <span class="p">)</span>

        <span class="k">try</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">tuple_fields</span> <span class="o">=</span> <span class="p">[</span>
                <span class="n">resolve_field_instance</span><span class="p">(</span><span class="n">cls_or_instance</span><span class="p">)</span>
                <span class="k">for</span> <span class="n">cls_or_instance</span> <span class="ow">in</span> <span class="n">tuple_fields</span>
            <span class="p">]</span>
        <span class="k">except</span> <span class="n">FieldInstanceResolutionError</span> <span class="k">as</span> <span class="n">error</span><span class="p">:</span>
            <span class="k">raise</span> <span class="ne">ValueError</span><span class="p">(</span>
                <span class="s1">&#39;Elements of &quot;tuple_fields&quot; must be subclasses or &#39;</span>
                <span class="s2">&quot;instances of marshmallow.base.FieldABC.&quot;</span>
            <span class="p">)</span> <span class="kn">from</span> <span class="nn">error</span>

        <span class="bp">self</span><span class="o">.</span><span class="n">validate_length</span> <span class="o">=</span> <span class="n">Length</span><span class="p">(</span><span class="n">equal</span><span class="o">=</span><span class="nb">len</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">tuple_fields</span><span class="p">))</span>

    <span class="k">def</span> <span class="nf">_bind_to_schema</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">field_name</span><span class="p">,</span> <span class="n">schema</span><span class="p">):</span>
        <span class="nb">super</span><span class="p">()</span><span class="o">.</span><span class="n">_bind_to_schema</span><span class="p">(</span><span class="n">field_name</span><span class="p">,</span> <span class="n">schema</span><span class="p">)</span>
        <span class="n">new_tuple_fields</span> <span class="o">=</span> <span class="p">[]</span>
        <span class="k">for</span> <span class="n">field</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">tuple_fields</span><span class="p">:</span>
            <span class="n">field</span> <span class="o">=</span> <span class="n">copy</span><span class="o">.</span><span class="n">deepcopy</span><span class="p">(</span><span class="n">field</span><span class="p">)</span>
            <span class="n">field</span><span class="o">.</span><span class="n">_bind_to_schema</span><span class="p">(</span><span class="n">field_name</span><span class="p">,</span> <span class="bp">self</span><span class="p">)</span>
            <span class="n">new_tuple_fields</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">field</span><span class="p">)</span>

        <span class="bp">self</span><span class="o">.</span><span class="n">tuple_fields</span> <span class="o">=</span> <span class="n">new_tuple_fields</span>

    <span class="k">def</span> <span class="nf">_serialize</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">value</span><span class="p">,</span> <span class="n">attr</span><span class="p">,</span> <span class="n">obj</span><span class="p">,</span> <span class="o">**</span><span class="n">kwargs</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="n">typing</span><span class="o">.</span><span class="n">Optional</span><span class="p">[</span><span class="n">typing</span><span class="o">.</span><span class="n">Tuple</span><span class="p">]:</span>
        <span class="k">if</span> <span class="n">value</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
            <span class="k">return</span> <span class="kc">None</span>

        <span class="k">return</span> <span class="nb">tuple</span><span class="p">(</span>
            <span class="n">field</span><span class="o">.</span><span class="n">_serialize</span><span class="p">(</span><span class="n">each</span><span class="p">,</span> <span class="n">attr</span><span class="p">,</span> <span class="n">obj</span><span class="p">,</span> <span class="o">**</span><span class="n">kwargs</span><span class="p">)</span>
            <span class="k">for</span> <span class="n">field</span><span class="p">,</span> <span class="n">each</span> <span class="ow">in</span> <span class="nb">zip</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">tuple_fields</span><span class="p">,</span> <span class="n">value</span><span class="p">)</span>
        <span class="p">)</span>

    <span class="k">def</span> <span class="nf">_deserialize</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">value</span><span class="p">,</span> <span class="n">attr</span><span class="p">,</span> <span class="n">data</span><span class="p">,</span> <span class="o">**</span><span class="n">kwargs</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="n">typing</span><span class="o">.</span><span class="n">Tuple</span><span class="p">:</span>
        <span class="k">if</span> <span class="ow">not</span> <span class="n">utils</span><span class="o">.</span><span class="n">is_collection</span><span class="p">(</span><span class="n">value</span><span class="p">):</span>
            <span class="k">raise</span> <span class="bp">self</span><span class="o">.</span><span class="n">make_error</span><span class="p">(</span><span class="s2">&quot;invalid&quot;</span><span class="p">)</span>

        <span class="bp">self</span><span class="o">.</span><span class="n">validate_length</span><span class="p">(</span><span class="n">value</span><span class="p">)</span>

        <span class="n">result</span> <span class="o">=</span> <span class="p">[]</span>
        <span class="n">errors</span> <span class="o">=</span> <span class="p">{}</span>

        <span class="k">for</span> <span class="n">idx</span><span class="p">,</span> <span class="p">(</span><span class="n">field</span><span class="p">,</span> <span class="n">each</span><span class="p">)</span> <span class="ow">in</span> <span class="nb">enumerate</span><span class="p">(</span><span class="nb">zip</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">tuple_fields</span><span class="p">,</span> <span class="n">value</span><span class="p">)):</span>
            <span class="k">try</span><span class="p">:</span>
                <span class="n">result</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">field</span><span class="o">.</span><span class="n">deserialize</span><span class="p">(</span><span class="n">each</span><span class="p">,</span> <span class="o">**</span><span class="n">kwargs</span><span class="p">))</span>
            <span class="k">except</span> <span class="n">ValidationError</span> <span class="k">as</span> <span class="n">error</span><span class="p">:</span>
                <span class="k">if</span> <span class="n">error</span><span class="o">.</span><span class="n">valid_data</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">:</span>
                    <span class="n">result</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">error</span><span class="o">.</span><span class="n">valid_data</span><span class="p">)</span>
                <span class="n">errors</span><span class="o">.</span><span class="n">update</span><span class="p">({</span><span class="n">idx</span><span class="p">:</span> <span class="n">error</span><span class="o">.</span><span class="n">messages</span><span class="p">})</span>
        <span class="k">if</span> <span class="n">errors</span><span class="p">:</span>
            <span class="k">raise</span> <span class="n">ValidationError</span><span class="p">(</span><span class="n">errors</span><span class="p">,</span> <span class="n">valid_data</span><span class="o">=</span><span class="n">result</span><span class="p">)</span>

        <span class="k">return</span> <span class="nb">tuple</span><span class="p">(</span><span class="n">result</span><span class="p">)</span>


<span class="k">class</span> <span class="nc">String</span><span class="p">(</span><span class="n">Field</span><span class="p">):</span>
    <span class="sd">&quot;&quot;&quot;A string field.</span>

<span class="sd">    :param kwargs: The same keyword arguments that :class:`Field` receives.</span>
<span class="sd">    &quot;&quot;&quot;</span>

    <span class="c1">#: Default error messages.</span>
    <span class="n">default_error_messages</span> <span class="o">=</span> <span class="p">{</span>
        <span class="s2">&quot;invalid&quot;</span><span class="p">:</span> <span class="s2">&quot;Not a valid string.&quot;</span><span class="p">,</span>
        <span class="s2">&quot;invalid_utf8&quot;</span><span class="p">:</span> <span class="s2">&quot;Not a valid utf-8 string.&quot;</span><span class="p">,</span>
    <span class="p">}</span>

    <span class="k">def</span> <span class="nf">_serialize</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">value</span><span class="p">,</span> <span class="n">attr</span><span class="p">,</span> <span class="n">obj</span><span class="p">,</span> <span class="o">**</span><span class="n">kwargs</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="n">typing</span><span class="o">.</span><span class="n">Optional</span><span class="p">[</span><span class="nb">str</span><span class="p">]:</span>
        <span class="k">if</span> <span class="n">value</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
            <span class="k">return</span> <span class="kc">None</span>
        <span class="k">return</span> <span class="n">utils</span><span class="o">.</span><span class="n">ensure_text_type</span><span class="p">(</span><span class="n">value</span><span class="p">)</span>

    <span class="k">def</span> <span class="nf">_deserialize</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">value</span><span class="p">,</span> <span class="n">attr</span><span class="p">,</span> <span class="n">data</span><span class="p">,</span> <span class="o">**</span><span class="n">kwargs</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="n">typing</span><span class="o">.</span><span class="n">Any</span><span class="p">:</span>
        <span class="k">if</span> <span class="ow">not</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">value</span><span class="p">,</span> <span class="p">(</span><span class="nb">str</span><span class="p">,</span> <span class="nb">bytes</span><span class="p">)):</span>
            <span class="k">raise</span> <span class="bp">self</span><span class="o">.</span><span class="n">make_error</span><span class="p">(</span><span class="s2">&quot;invalid&quot;</span><span class="p">)</span>
        <span class="k">try</span><span class="p">:</span>
            <span class="k">return</span> <span class="n">utils</span><span class="o">.</span><span class="n">ensure_text_type</span><span class="p">(</span><span class="n">value</span><span class="p">)</span>
        <span class="k">except</span> <span class="ne">UnicodeDecodeError</span> <span class="k">as</span> <span class="n">error</span><span class="p">:</span>
            <span class="k">raise</span> <span class="bp">self</span><span class="o">.</span><span class="n">make_error</span><span class="p">(</span><span class="s2">&quot;invalid_utf8&quot;</span><span class="p">)</span> <span class="kn">from</span> <span class="nn">error</span>


<span class="k">class</span> <span class="nc">UUID</span><span class="p">(</span><span class="n">String</span><span class="p">):</span>
    <span class="sd">&quot;&quot;&quot;A UUID field.&quot;&quot;&quot;</span>

    <span class="c1">#: Default error messages.</span>
    <span class="n">default_error_messages</span> <span class="o">=</span> <span class="p">{</span><span class="s2">&quot;invalid_uuid&quot;</span><span class="p">:</span> <span class="s2">&quot;Not a valid UUID.&quot;</span><span class="p">}</span>

    <span class="k">def</span> <span class="nf">_validated</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">value</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="n">typing</span><span class="o">.</span><span class="n">Optional</span><span class="p">[</span><span class="n">uuid</span><span class="o">.</span><span class="n">UUID</span><span class="p">]:</span>
        <span class="sd">&quot;&quot;&quot;Format the value or raise a :exc:`ValidationError` if an error occurs.&quot;&quot;&quot;</span>
        <span class="k">if</span> <span class="n">value</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
            <span class="k">return</span> <span class="kc">None</span>
        <span class="k">if</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">value</span><span class="p">,</span> <span class="n">uuid</span><span class="o">.</span><span class="n">UUID</span><span class="p">):</span>
            <span class="k">return</span> <span class="n">value</span>
        <span class="k">try</span><span class="p">:</span>
            <span class="k">if</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">value</span><span class="p">,</span> <span class="nb">bytes</span><span class="p">)</span> <span class="ow">and</span> <span class="nb">len</span><span class="p">(</span><span class="n">value</span><span class="p">)</span> <span class="o">==</span> <span class="mi">16</span><span class="p">:</span>
                <span class="k">return</span> <span class="n">uuid</span><span class="o">.</span><span class="n">UUID</span><span class="p">(</span><span class="nb">bytes</span><span class="o">=</span><span class="n">value</span><span class="p">)</span>
            <span class="k">else</span><span class="p">:</span>
                <span class="k">return</span> <span class="n">uuid</span><span class="o">.</span><span class="n">UUID</span><span class="p">(</span><span class="n">value</span><span class="p">)</span>
        <span class="k">except</span> <span class="p">(</span><span class="ne">ValueError</span><span class="p">,</span> <span class="ne">AttributeError</span><span class="p">,</span> <span class="ne">TypeError</span><span class="p">)</span> <span class="k">as</span> <span class="n">error</span><span class="p">:</span>
            <span class="k">raise</span> <span class="bp">self</span><span class="o">.</span><span class="n">make_error</span><span class="p">(</span><span class="s2">&quot;invalid_uuid&quot;</span><span class="p">)</span> <span class="kn">from</span> <span class="nn">error</span>

    <span class="k">def</span> <span class="nf">_deserialize</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">value</span><span class="p">,</span> <span class="n">attr</span><span class="p">,</span> <span class="n">data</span><span class="p">,</span> <span class="o">**</span><span class="n">kwargs</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="n">typing</span><span class="o">.</span><span class="n">Optional</span><span class="p">[</span><span class="n">uuid</span><span class="o">.</span><span class="n">UUID</span><span class="p">]:</span>
        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">_validated</span><span class="p">(</span><span class="n">value</span><span class="p">)</span>


<span class="k">class</span> <span class="nc">Number</span><span class="p">(</span><span class="n">Field</span><span class="p">):</span>
    <span class="sd">&quot;&quot;&quot;Base class for number fields.</span>

<span class="sd">    :param bool as_string: If `True`, format the serialized value as a string.</span>
<span class="sd">    :param kwargs: The same keyword arguments that :class:`Field` receives.</span>
<span class="sd">    &quot;&quot;&quot;</span>

    <span class="n">num_type</span> <span class="o">=</span> <span class="nb">float</span>  <span class="c1"># type: typing.Type</span>

    <span class="c1">#: Default error messages.</span>
    <span class="n">default_error_messages</span> <span class="o">=</span> <span class="p">{</span>
        <span class="s2">&quot;invalid&quot;</span><span class="p">:</span> <span class="s2">&quot;Not a valid number.&quot;</span><span class="p">,</span>
        <span class="s2">&quot;too_large&quot;</span><span class="p">:</span> <span class="s2">&quot;Number too large.&quot;</span><span class="p">,</span>
    <span class="p">}</span>

    <span class="k">def</span> <span class="fm">__init__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="o">*</span><span class="p">,</span> <span class="n">as_string</span><span class="p">:</span> <span class="nb">bool</span> <span class="o">=</span> <span class="kc">False</span><span class="p">,</span> <span class="o">**</span><span class="n">kwargs</span><span class="p">):</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">as_string</span> <span class="o">=</span> <span class="n">as_string</span>
        <span class="nb">super</span><span class="p">()</span><span class="o">.</span><span class="fm">__init__</span><span class="p">(</span><span class="o">**</span><span class="n">kwargs</span><span class="p">)</span>

    <span class="k">def</span> <span class="nf">_format_num</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">value</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="n">typing</span><span class="o">.</span><span class="n">Any</span><span class="p">:</span>
        <span class="sd">&quot;&quot;&quot;Return the number value for value, given this field&#39;s `num_type`.&quot;&quot;&quot;</span>
        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">num_type</span><span class="p">(</span><span class="n">value</span><span class="p">)</span>

    <span class="k">def</span> <span class="nf">_validated</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">value</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="n">typing</span><span class="o">.</span><span class="n">Optional</span><span class="p">[</span><span class="n">_T</span><span class="p">]:</span>
        <span class="sd">&quot;&quot;&quot;Format the value or raise a :exc:`ValidationError` if an error occurs.&quot;&quot;&quot;</span>
        <span class="k">if</span> <span class="n">value</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
            <span class="k">return</span> <span class="kc">None</span>
        <span class="c1"># (value is True or value is False) is ~5x faster than isinstance(value, bool)</span>
        <span class="k">if</span> <span class="n">value</span> <span class="ow">is</span> <span class="kc">True</span> <span class="ow">or</span> <span class="n">value</span> <span class="ow">is</span> <span class="kc">False</span><span class="p">:</span>
            <span class="k">raise</span> <span class="bp">self</span><span class="o">.</span><span class="n">make_error</span><span class="p">(</span><span class="s2">&quot;invalid&quot;</span><span class="p">,</span> <span class="nb">input</span><span class="o">=</span><span class="n">value</span><span class="p">)</span>
        <span class="k">try</span><span class="p">:</span>
            <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">_format_num</span><span class="p">(</span><span class="n">value</span><span class="p">)</span>
        <span class="k">except</span> <span class="p">(</span><span class="ne">TypeError</span><span class="p">,</span> <span class="ne">ValueError</span><span class="p">)</span> <span class="k">as</span> <span class="n">error</span><span class="p">:</span>
            <span class="k">raise</span> <span class="bp">self</span><span class="o">.</span><span class="n">make_error</span><span class="p">(</span><span class="s2">&quot;invalid&quot;</span><span class="p">,</span> <span class="nb">input</span><span class="o">=</span><span class="n">value</span><span class="p">)</span> <span class="kn">from</span> <span class="nn">error</span>
        <span class="k">except</span> <span class="ne">OverflowError</span> <span class="k">as</span> <span class="n">error</span><span class="p">:</span>
            <span class="k">raise</span> <span class="bp">self</span><span class="o">.</span><span class="n">make_error</span><span class="p">(</span><span class="s2">&quot;too_large&quot;</span><span class="p">,</span> <span class="nb">input</span><span class="o">=</span><span class="n">value</span><span class="p">)</span> <span class="kn">from</span> <span class="nn">error</span>

    <span class="k">def</span> <span class="nf">_to_string</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">value</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="nb">str</span><span class="p">:</span>
        <span class="k">return</span> <span class="nb">str</span><span class="p">(</span><span class="n">value</span><span class="p">)</span>

    <span class="k">def</span> <span class="nf">_serialize</span><span class="p">(</span>
        <span class="bp">self</span><span class="p">,</span> <span class="n">value</span><span class="p">,</span> <span class="n">attr</span><span class="p">,</span> <span class="n">obj</span><span class="p">,</span> <span class="o">**</span><span class="n">kwargs</span>
    <span class="p">)</span> <span class="o">-&gt;</span> <span class="n">typing</span><span class="o">.</span><span class="n">Optional</span><span class="p">[</span><span class="n">typing</span><span class="o">.</span><span class="n">Union</span><span class="p">[</span><span class="nb">str</span><span class="p">,</span> <span class="n">_T</span><span class="p">]]:</span>
        <span class="sd">&quot;&quot;&quot;Return a string if `self.as_string=True`, otherwise return this field&#39;s `num_type`.&quot;&quot;&quot;</span>
        <span class="k">if</span> <span class="n">value</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
            <span class="k">return</span> <span class="kc">None</span>
        <span class="n">ret</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_format_num</span><span class="p">(</span><span class="n">value</span><span class="p">)</span>  <span class="c1"># type: _T</span>
        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">_to_string</span><span class="p">(</span><span class="n">ret</span><span class="p">)</span> <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">as_string</span> <span class="k">else</span> <span class="n">ret</span>

    <span class="k">def</span> <span class="nf">_deserialize</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">value</span><span class="p">,</span> <span class="n">attr</span><span class="p">,</span> <span class="n">data</span><span class="p">,</span> <span class="o">**</span><span class="n">kwargs</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="n">typing</span><span class="o">.</span><span class="n">Optional</span><span class="p">[</span><span class="n">_T</span><span class="p">]:</span>
        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">_validated</span><span class="p">(</span><span class="n">value</span><span class="p">)</span>


<span class="k">class</span> <span class="nc">Integer</span><span class="p">(</span><span class="n">Number</span><span class="p">):</span>
    <span class="sd">&quot;&quot;&quot;An integer field.</span>

<span class="sd">    :param strict: If `True`, only integer types are valid.</span>
<span class="sd">        Otherwise, any value castable to `int` is valid.</span>
<span class="sd">    :param kwargs: The same keyword arguments that :class:`Number` receives.</span>
<span class="sd">    &quot;&quot;&quot;</span>

    <span class="n">num_type</span> <span class="o">=</span> <span class="nb">int</span>

    <span class="c1">#: Default error messages.</span>
    <span class="n">default_error_messages</span> <span class="o">=</span> <span class="p">{</span><span class="s2">&quot;invalid&quot;</span><span class="p">:</span> <span class="s2">&quot;Not a valid integer.&quot;</span><span class="p">}</span>

    <span class="k">def</span> <span class="fm">__init__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="o">*</span><span class="p">,</span> <span class="n">strict</span><span class="p">:</span> <span class="nb">bool</span> <span class="o">=</span> <span class="kc">False</span><span class="p">,</span> <span class="o">**</span><span class="n">kwargs</span><span class="p">):</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">strict</span> <span class="o">=</span> <span class="n">strict</span>
        <span class="nb">super</span><span class="p">()</span><span class="o">.</span><span class="fm">__init__</span><span class="p">(</span><span class="o">**</span><span class="n">kwargs</span><span class="p">)</span>

    <span class="c1"># override Number</span>
    <span class="k">def</span> <span class="nf">_validated</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">value</span><span class="p">):</span>
        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">strict</span><span class="p">:</span>
            <span class="k">if</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">value</span><span class="p">,</span> <span class="n">numbers</span><span class="o">.</span><span class="n">Number</span><span class="p">)</span> <span class="ow">and</span> <span class="nb">isinstance</span><span class="p">(</span>
                <span class="n">value</span><span class="p">,</span> <span class="n">numbers</span><span class="o">.</span><span class="n">Integral</span>
            <span class="p">):</span>
                <span class="k">return</span> <span class="nb">super</span><span class="p">()</span><span class="o">.</span><span class="n">_validated</span><span class="p">(</span><span class="n">value</span><span class="p">)</span>
            <span class="k">raise</span> <span class="bp">self</span><span class="o">.</span><span class="n">make_error</span><span class="p">(</span><span class="s2">&quot;invalid&quot;</span><span class="p">,</span> <span class="nb">input</span><span class="o">=</span><span class="n">value</span><span class="p">)</span>
        <span class="k">return</span> <span class="nb">super</span><span class="p">()</span><span class="o">.</span><span class="n">_validated</span><span class="p">(</span><span class="n">value</span><span class="p">)</span>


<span class="k">class</span> <span class="nc">Float</span><span class="p">(</span><span class="n">Number</span><span class="p">):</span>
    <span class="sd">&quot;&quot;&quot;A double as an IEEE-754 double precision string.</span>

<span class="sd">    :param bool allow_nan: If `True`, `NaN`, `Infinity` and `-Infinity` are allowed,</span>
<span class="sd">        even though they are illegal according to the JSON specification.</span>
<span class="sd">    :param bool as_string: If `True`, format the value as a string.</span>
<span class="sd">    :param kwargs: The same keyword arguments that :class:`Number` receives.</span>
<span class="sd">    &quot;&quot;&quot;</span>

    <span class="n">num_type</span> <span class="o">=</span> <span class="nb">float</span>

    <span class="c1">#: Default error messages.</span>
    <span class="n">default_error_messages</span> <span class="o">=</span> <span class="p">{</span>
        <span class="s2">&quot;special&quot;</span><span class="p">:</span> <span class="s2">&quot;Special numeric values (nan or infinity) are not permitted.&quot;</span>
    <span class="p">}</span>

    <span class="k">def</span> <span class="fm">__init__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="o">*</span><span class="p">,</span> <span class="n">allow_nan</span><span class="p">:</span> <span class="nb">bool</span> <span class="o">=</span> <span class="kc">False</span><span class="p">,</span> <span class="n">as_string</span><span class="p">:</span> <span class="nb">bool</span> <span class="o">=</span> <span class="kc">False</span><span class="p">,</span> <span class="o">**</span><span class="n">kwargs</span><span class="p">):</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">allow_nan</span> <span class="o">=</span> <span class="n">allow_nan</span>
        <span class="nb">super</span><span class="p">()</span><span class="o">.</span><span class="fm">__init__</span><span class="p">(</span><span class="n">as_string</span><span class="o">=</span><span class="n">as_string</span><span class="p">,</span> <span class="o">**</span><span class="n">kwargs</span><span class="p">)</span>

    <span class="k">def</span> <span class="nf">_validated</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">value</span><span class="p">):</span>
        <span class="n">num</span> <span class="o">=</span> <span class="nb">super</span><span class="p">()</span><span class="o">.</span><span class="n">_validated</span><span class="p">(</span><span class="n">value</span><span class="p">)</span>
        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">allow_nan</span> <span class="ow">is</span> <span class="kc">False</span><span class="p">:</span>
            <span class="k">if</span> <span class="n">math</span><span class="o">.</span><span class="n">isnan</span><span class="p">(</span><span class="n">num</span><span class="p">)</span> <span class="ow">or</span> <span class="n">num</span> <span class="o">==</span> <span class="nb">float</span><span class="p">(</span><span class="s2">&quot;inf&quot;</span><span class="p">)</span> <span class="ow">or</span> <span class="n">num</span> <span class="o">==</span> <span class="nb">float</span><span class="p">(</span><span class="s2">&quot;-inf&quot;</span><span class="p">):</span>
                <span class="k">raise</span> <span class="bp">self</span><span class="o">.</span><span class="n">make_error</span><span class="p">(</span><span class="s2">&quot;special&quot;</span><span class="p">)</span>
        <span class="k">return</span> <span class="n">num</span>


<span class="k">class</span> <span class="nc">Decimal</span><span class="p">(</span><span class="n">Number</span><span class="p">):</span>
    <span class="sd">&quot;&quot;&quot;A field that (de)serializes to the Python ``decimal.Decimal`` type.</span>
<span class="sd">    It&#39;s safe to use when dealing with money values, percentages, ratios</span>
<span class="sd">    or other numbers where precision is critical.</span>

<span class="sd">    .. warning::</span>

<span class="sd">        This field serializes to a `decimal.Decimal` object by default. If you need</span>
<span class="sd">        to render your data as JSON, keep in mind that the `json` module from the</span>
<span class="sd">        standard library does not encode `decimal.Decimal`. Therefore, you must use</span>
<span class="sd">        a JSON library that can handle decimals, such as `simplejson`, or serialize</span>
<span class="sd">        to a string by passing ``as_string=True``.</span>

<span class="sd">    .. warning::</span>

<span class="sd">        If a JSON `float` value is passed to this field for deserialization it will</span>
<span class="sd">        first be cast to its corresponding `string` value before being deserialized</span>
<span class="sd">        to a `decimal.Decimal` object. The default `__str__` implementation of the</span>
<span class="sd">        built-in Python `float` type may apply a destructive transformation upon</span>
<span class="sd">        its input data and therefore cannot be relied upon to preserve precision.</span>
<span class="sd">        To avoid this, you can instead pass a JSON `string` to be deserialized</span>
<span class="sd">        directly.</span>

<span class="sd">    :param places: How many decimal places to quantize the value. If `None`, does</span>
<span class="sd">        not quantize the value.</span>
<span class="sd">    :param rounding: How to round the value during quantize, for example</span>
<span class="sd">        `decimal.ROUND_UP`. If `None`, uses the rounding value from</span>
<span class="sd">        the current thread&#39;s context.</span>
<span class="sd">    :param allow_nan: If `True`, `NaN`, `Infinity` and `-Infinity` are allowed,</span>
<span class="sd">        even though they are illegal according to the JSON specification.</span>
<span class="sd">    :param as_string: If `True`, serialize to a string instead of a Python</span>
<span class="sd">        `decimal.Decimal` type.</span>
<span class="sd">    :param kwargs: The same keyword arguments that :class:`Number` receives.</span>

<span class="sd">    .. versionadded:: 1.2.0</span>
<span class="sd">    &quot;&quot;&quot;</span>

    <span class="n">num_type</span> <span class="o">=</span> <span class="n">decimal</span><span class="o">.</span><span class="n">Decimal</span>

    <span class="c1">#: Default error messages.</span>
    <span class="n">default_error_messages</span> <span class="o">=</span> <span class="p">{</span>
        <span class="s2">&quot;special&quot;</span><span class="p">:</span> <span class="s2">&quot;Special numeric values (nan or infinity) are not permitted.&quot;</span>
    <span class="p">}</span>

    <span class="k">def</span> <span class="fm">__init__</span><span class="p">(</span>
        <span class="bp">self</span><span class="p">,</span>
        <span class="n">places</span><span class="p">:</span> <span class="n">typing</span><span class="o">.</span><span class="n">Optional</span><span class="p">[</span><span class="nb">int</span><span class="p">]</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span>
        <span class="n">rounding</span><span class="p">:</span> <span class="n">typing</span><span class="o">.</span><span class="n">Optional</span><span class="p">[</span><span class="nb">str</span><span class="p">]</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span>
        <span class="o">*</span><span class="p">,</span>
        <span class="n">allow_nan</span><span class="p">:</span> <span class="nb">bool</span> <span class="o">=</span> <span class="kc">False</span><span class="p">,</span>
        <span class="n">as_string</span><span class="p">:</span> <span class="nb">bool</span> <span class="o">=</span> <span class="kc">False</span><span class="p">,</span>
        <span class="o">**</span><span class="n">kwargs</span><span class="p">,</span>
    <span class="p">):</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">places</span> <span class="o">=</span> <span class="p">(</span>
            <span class="n">decimal</span><span class="o">.</span><span class="n">Decimal</span><span class="p">((</span><span class="mi">0</span><span class="p">,</span> <span class="p">(</span><span class="mi">1</span><span class="p">,),</span> <span class="o">-</span><span class="n">places</span><span class="p">))</span> <span class="k">if</span> <span class="n">places</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span> <span class="k">else</span> <span class="kc">None</span>
        <span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">rounding</span> <span class="o">=</span> <span class="n">rounding</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">allow_nan</span> <span class="o">=</span> <span class="n">allow_nan</span>
        <span class="nb">super</span><span class="p">()</span><span class="o">.</span><span class="fm">__init__</span><span class="p">(</span><span class="n">as_string</span><span class="o">=</span><span class="n">as_string</span><span class="p">,</span> <span class="o">**</span><span class="n">kwargs</span><span class="p">)</span>

    <span class="c1"># override Number</span>
    <span class="k">def</span> <span class="nf">_format_num</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">value</span><span class="p">):</span>
        <span class="n">num</span> <span class="o">=</span> <span class="n">decimal</span><span class="o">.</span><span class="n">Decimal</span><span class="p">(</span><span class="nb">str</span><span class="p">(</span><span class="n">value</span><span class="p">))</span>
        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">allow_nan</span><span class="p">:</span>
            <span class="k">if</span> <span class="n">num</span><span class="o">.</span><span class="n">is_nan</span><span class="p">():</span>
                <span class="k">return</span> <span class="n">decimal</span><span class="o">.</span><span class="n">Decimal</span><span class="p">(</span><span class="s2">&quot;NaN&quot;</span><span class="p">)</span>  <span class="c1"># avoid sNaN, -sNaN and -NaN</span>
        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">places</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span> <span class="ow">and</span> <span class="n">num</span><span class="o">.</span><span class="n">is_finite</span><span class="p">():</span>
            <span class="n">num</span> <span class="o">=</span> <span class="n">num</span><span class="o">.</span><span class="n">quantize</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">places</span><span class="p">,</span> <span class="n">rounding</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">rounding</span><span class="p">)</span>
        <span class="k">return</span> <span class="n">num</span>

    <span class="c1"># override Number</span>
    <span class="k">def</span> <span class="nf">_validated</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">value</span><span class="p">):</span>
        <span class="k">try</span><span class="p">:</span>
            <span class="n">num</span> <span class="o">=</span> <span class="nb">super</span><span class="p">()</span><span class="o">.</span><span class="n">_validated</span><span class="p">(</span><span class="n">value</span><span class="p">)</span>
        <span class="k">except</span> <span class="n">decimal</span><span class="o">.</span><span class="n">InvalidOperation</span> <span class="k">as</span> <span class="n">error</span><span class="p">:</span>
            <span class="k">raise</span> <span class="bp">self</span><span class="o">.</span><span class="n">make_error</span><span class="p">(</span><span class="s2">&quot;invalid&quot;</span><span class="p">)</span> <span class="kn">from</span> <span class="nn">error</span>
        <span class="k">if</span> <span class="ow">not</span> <span class="bp">self</span><span class="o">.</span><span class="n">allow_nan</span> <span class="ow">and</span> <span class="p">(</span><span class="n">num</span><span class="o">.</span><span class="n">is_nan</span><span class="p">()</span> <span class="ow">or</span> <span class="n">num</span><span class="o">.</span><span class="n">is_infinite</span><span class="p">()):</span>
            <span class="k">raise</span> <span class="bp">self</span><span class="o">.</span><span class="n">make_error</span><span class="p">(</span><span class="s2">&quot;special&quot;</span><span class="p">)</span>
        <span class="k">return</span> <span class="n">num</span>

    <span class="c1"># override Number</span>
    <span class="k">def</span> <span class="nf">_to_string</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">value</span><span class="p">):</span>
        <span class="k">return</span> <span class="nb">format</span><span class="p">(</span><span class="n">value</span><span class="p">,</span> <span class="s2">&quot;f&quot;</span><span class="p">)</span>


<span class="k">class</span> <span class="nc">Boolean</span><span class="p">(</span><span class="n">Field</span><span class="p">):</span>
    <span class="sd">&quot;&quot;&quot;A boolean field.</span>

<span class="sd">    :param truthy: Values that will (de)serialize to `True`. If an empty</span>
<span class="sd">        set, any non-falsy value will deserialize to `True`. If `None`,</span>
<span class="sd">        `marshmallow.fields.Boolean.truthy` will be used.</span>
<span class="sd">    :param falsy: Values that will (de)serialize to `False`. If `None`,</span>
<span class="sd">        `marshmallow.fields.Boolean.falsy` will be used.</span>
<span class="sd">    :param kwargs: The same keyword arguments that :class:`Field` receives.</span>
<span class="sd">    &quot;&quot;&quot;</span>

    <span class="c1">#: Default truthy values.</span>
    <span class="n">truthy</span> <span class="o">=</span> <span class="p">{</span>
        <span class="s2">&quot;t&quot;</span><span class="p">,</span>
        <span class="s2">&quot;T&quot;</span><span class="p">,</span>
        <span class="s2">&quot;true&quot;</span><span class="p">,</span>
        <span class="s2">&quot;True&quot;</span><span class="p">,</span>
        <span class="s2">&quot;TRUE&quot;</span><span class="p">,</span>
        <span class="s2">&quot;on&quot;</span><span class="p">,</span>
        <span class="s2">&quot;On&quot;</span><span class="p">,</span>
        <span class="s2">&quot;ON&quot;</span><span class="p">,</span>
        <span class="s2">&quot;y&quot;</span><span class="p">,</span>
        <span class="s2">&quot;Y&quot;</span><span class="p">,</span>
        <span class="s2">&quot;yes&quot;</span><span class="p">,</span>
        <span class="s2">&quot;Yes&quot;</span><span class="p">,</span>
        <span class="s2">&quot;YES&quot;</span><span class="p">,</span>
        <span class="s2">&quot;1&quot;</span><span class="p">,</span>
        <span class="mi">1</span><span class="p">,</span>
        <span class="kc">True</span><span class="p">,</span>
    <span class="p">}</span>
    <span class="c1">#: Default falsy values.</span>
    <span class="n">falsy</span> <span class="o">=</span> <span class="p">{</span>
        <span class="s2">&quot;f&quot;</span><span class="p">,</span>
        <span class="s2">&quot;F&quot;</span><span class="p">,</span>
        <span class="s2">&quot;false&quot;</span><span class="p">,</span>
        <span class="s2">&quot;False&quot;</span><span class="p">,</span>
        <span class="s2">&quot;FALSE&quot;</span><span class="p">,</span>
        <span class="s2">&quot;off&quot;</span><span class="p">,</span>
        <span class="s2">&quot;Off&quot;</span><span class="p">,</span>
        <span class="s2">&quot;OFF&quot;</span><span class="p">,</span>
        <span class="s2">&quot;n&quot;</span><span class="p">,</span>
        <span class="s2">&quot;N&quot;</span><span class="p">,</span>
        <span class="s2">&quot;no&quot;</span><span class="p">,</span>
        <span class="s2">&quot;No&quot;</span><span class="p">,</span>
        <span class="s2">&quot;NO&quot;</span><span class="p">,</span>
        <span class="s2">&quot;0&quot;</span><span class="p">,</span>
        <span class="mi">0</span><span class="p">,</span>
        <span class="mf">0.0</span><span class="p">,</span>
        <span class="kc">False</span><span class="p">,</span>
    <span class="p">}</span>

    <span class="c1">#: Default error messages.</span>
    <span class="n">default_error_messages</span> <span class="o">=</span> <span class="p">{</span><span class="s2">&quot;invalid&quot;</span><span class="p">:</span> <span class="s2">&quot;Not a valid boolean.&quot;</span><span class="p">}</span>

    <span class="k">def</span> <span class="fm">__init__</span><span class="p">(</span>
        <span class="bp">self</span><span class="p">,</span>
        <span class="o">*</span><span class="p">,</span>
        <span class="n">truthy</span><span class="p">:</span> <span class="n">typing</span><span class="o">.</span><span class="n">Optional</span><span class="p">[</span><span class="n">typing</span><span class="o">.</span><span class="n">Set</span><span class="p">]</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span>
        <span class="n">falsy</span><span class="p">:</span> <span class="n">typing</span><span class="o">.</span><span class="n">Optional</span><span class="p">[</span><span class="n">typing</span><span class="o">.</span><span class="n">Set</span><span class="p">]</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span>
        <span class="o">**</span><span class="n">kwargs</span><span class="p">,</span>
    <span class="p">):</span>
        <span class="nb">super</span><span class="p">()</span><span class="o">.</span><span class="fm">__init__</span><span class="p">(</span><span class="o">**</span><span class="n">kwargs</span><span class="p">)</span>

        <span class="k">if</span> <span class="n">truthy</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">truthy</span> <span class="o">=</span> <span class="nb">set</span><span class="p">(</span><span class="n">truthy</span><span class="p">)</span>
        <span class="k">if</span> <span class="n">falsy</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">falsy</span> <span class="o">=</span> <span class="nb">set</span><span class="p">(</span><span class="n">falsy</span><span class="p">)</span>

    <span class="k">def</span> <span class="nf">_serialize</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">value</span><span class="p">,</span> <span class="n">attr</span><span class="p">,</span> <span class="n">obj</span><span class="p">,</span> <span class="o">**</span><span class="n">kwargs</span><span class="p">):</span>
        <span class="k">if</span> <span class="n">value</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
            <span class="k">return</span> <span class="kc">None</span>

        <span class="k">try</span><span class="p">:</span>
            <span class="k">if</span> <span class="n">value</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">truthy</span><span class="p">:</span>
                <span class="k">return</span> <span class="kc">True</span>
            <span class="k">elif</span> <span class="n">value</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">falsy</span><span class="p">:</span>
                <span class="k">return</span> <span class="kc">False</span>
        <span class="k">except</span> <span class="ne">TypeError</span><span class="p">:</span>
            <span class="k">pass</span>

        <span class="k">return</span> <span class="nb">bool</span><span class="p">(</span><span class="n">value</span><span class="p">)</span>

    <span class="k">def</span> <span class="nf">_deserialize</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">value</span><span class="p">,</span> <span class="n">attr</span><span class="p">,</span> <span class="n">data</span><span class="p">,</span> <span class="o">**</span><span class="n">kwargs</span><span class="p">):</span>
        <span class="k">if</span> <span class="ow">not</span> <span class="bp">self</span><span class="o">.</span><span class="n">truthy</span><span class="p">:</span>
            <span class="k">return</span> <span class="nb">bool</span><span class="p">(</span><span class="n">value</span><span class="p">)</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="k">try</span><span class="p">:</span>
                <span class="k">if</span> <span class="n">value</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">truthy</span><span class="p">:</span>
                    <span class="k">return</span> <span class="kc">True</span>
                <span class="k">elif</span> <span class="n">value</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">falsy</span><span class="p">:</span>
                    <span class="k">return</span> <span class="kc">False</span>
            <span class="k">except</span> <span class="ne">TypeError</span> <span class="k">as</span> <span class="n">error</span><span class="p">:</span>
                <span class="k">raise</span> <span class="bp">self</span><span class="o">.</span><span class="n">make_error</span><span class="p">(</span><span class="s2">&quot;invalid&quot;</span><span class="p">,</span> <span class="nb">input</span><span class="o">=</span><span class="n">value</span><span class="p">)</span> <span class="kn">from</span> <span class="nn">error</span>
        <span class="k">raise</span> <span class="bp">self</span><span class="o">.</span><span class="n">make_error</span><span class="p">(</span><span class="s2">&quot;invalid&quot;</span><span class="p">,</span> <span class="nb">input</span><span class="o">=</span><span class="n">value</span><span class="p">)</span>


<span class="k">class</span> <span class="nc">DateTime</span><span class="p">(</span><span class="n">Field</span><span class="p">):</span>
    <span class="sd">&quot;&quot;&quot;A formatted datetime string.</span>

<span class="sd">    Example: ``&#39;2014-12-22T03:12:58.019077+00:00&#39;``</span>

<span class="sd">    :param format: Either ``&quot;rfc&quot;`` (for RFC822), ``&quot;iso&quot;`` (for ISO8601),</span>
<span class="sd">        or a date format string. If `None`, defaults to &quot;iso&quot;.</span>
<span class="sd">    :param kwargs: The same keyword arguments that :class:`Field` receives.</span>

<span class="sd">    .. versionchanged:: 3.0.0rc9</span>
<span class="sd">        Does not modify timezone information on (de)serialization.</span>
<span class="sd">    &quot;&quot;&quot;</span>

    <span class="n">SERIALIZATION_FUNCS</span> <span class="o">=</span> <span class="p">{</span>
        <span class="s2">&quot;iso&quot;</span><span class="p">:</span> <span class="n">utils</span><span class="o">.</span><span class="n">isoformat</span><span class="p">,</span>
        <span class="s2">&quot;iso8601&quot;</span><span class="p">:</span> <span class="n">utils</span><span class="o">.</span><span class="n">isoformat</span><span class="p">,</span>
        <span class="s2">&quot;rfc&quot;</span><span class="p">:</span> <span class="n">utils</span><span class="o">.</span><span class="n">rfcformat</span><span class="p">,</span>
        <span class="s2">&quot;rfc822&quot;</span><span class="p">:</span> <span class="n">utils</span><span class="o">.</span><span class="n">rfcformat</span><span class="p">,</span>
    <span class="p">}</span>  <span class="c1"># type: typing.Dict[str, typing.Callable[[typing.Any], str]]</span>

    <span class="n">DESERIALIZATION_FUNCS</span> <span class="o">=</span> <span class="p">{</span>
        <span class="s2">&quot;iso&quot;</span><span class="p">:</span> <span class="n">utils</span><span class="o">.</span><span class="n">from_iso_datetime</span><span class="p">,</span>
        <span class="s2">&quot;iso8601&quot;</span><span class="p">:</span> <span class="n">utils</span><span class="o">.</span><span class="n">from_iso_datetime</span><span class="p">,</span>
        <span class="s2">&quot;rfc&quot;</span><span class="p">:</span> <span class="n">utils</span><span class="o">.</span><span class="n">from_rfc</span><span class="p">,</span>
        <span class="s2">&quot;rfc822&quot;</span><span class="p">:</span> <span class="n">utils</span><span class="o">.</span><span class="n">from_rfc</span><span class="p">,</span>
    <span class="p">}</span>  <span class="c1"># type: typing.Dict[str, typing.Callable[[str], typing.Any]]</span>

    <span class="n">DEFAULT_FORMAT</span> <span class="o">=</span> <span class="s2">&quot;iso&quot;</span>

    <span class="n">OBJ_TYPE</span> <span class="o">=</span> <span class="s2">&quot;datetime&quot;</span>

    <span class="n">SCHEMA_OPTS_VAR_NAME</span> <span class="o">=</span> <span class="s2">&quot;datetimeformat&quot;</span>

    <span class="c1">#: Default error messages.</span>
    <span class="n">default_error_messages</span> <span class="o">=</span> <span class="p">{</span>
        <span class="s2">&quot;invalid&quot;</span><span class="p">:</span> <span class="s2">&quot;Not a valid </span><span class="si">{obj_type}</span><span class="s2">.&quot;</span><span class="p">,</span>
        <span class="s2">&quot;invalid_awareness&quot;</span><span class="p">:</span> <span class="s2">&quot;Not a valid </span><span class="si">{awareness}</span><span class="s2"> </span><span class="si">{obj_type}</span><span class="s2">.&quot;</span><span class="p">,</span>
        <span class="s2">&quot;format&quot;</span><span class="p">:</span> <span class="s1">&#39;&quot;</span><span class="si">{input}</span><span class="s1">&quot; cannot be formatted as a </span><span class="si">{obj_type}</span><span class="s1">.&#39;</span><span class="p">,</span>
    <span class="p">}</span>

    <span class="k">def</span> <span class="fm">__init__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="nb">format</span><span class="p">:</span> <span class="n">typing</span><span class="o">.</span><span class="n">Optional</span><span class="p">[</span><span class="nb">str</span><span class="p">]</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span> <span class="o">**</span><span class="n">kwargs</span><span class="p">):</span>
        <span class="nb">super</span><span class="p">()</span><span class="o">.</span><span class="fm">__init__</span><span class="p">(</span><span class="o">**</span><span class="n">kwargs</span><span class="p">)</span>
        <span class="c1"># Allow this to be None. It may be set later in the ``_serialize``</span>
        <span class="c1"># or ``_deserialize`` methods. This allows a Schema to dynamically set the</span>
        <span class="c1"># format, e.g. from a Meta option</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">format</span> <span class="o">=</span> <span class="nb">format</span>

    <span class="k">def</span> <span class="nf">_bind_to_schema</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">field_name</span><span class="p">,</span> <span class="n">schema</span><span class="p">):</span>
        <span class="nb">super</span><span class="p">()</span><span class="o">.</span><span class="n">_bind_to_schema</span><span class="p">(</span><span class="n">field_name</span><span class="p">,</span> <span class="n">schema</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">format</span> <span class="o">=</span> <span class="p">(</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">format</span>
            <span class="ow">or</span> <span class="nb">getattr</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">root</span><span class="o">.</span><span class="n">opts</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">SCHEMA_OPTS_VAR_NAME</span><span class="p">)</span>
            <span class="ow">or</span> <span class="bp">self</span><span class="o">.</span><span class="n">DEFAULT_FORMAT</span>
        <span class="p">)</span>

    <span class="k">def</span> <span class="nf">_serialize</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">value</span><span class="p">,</span> <span class="n">attr</span><span class="p">,</span> <span class="n">obj</span><span class="p">,</span> <span class="o">**</span><span class="n">kwargs</span><span class="p">):</span>
        <span class="k">if</span> <span class="n">value</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
            <span class="k">return</span> <span class="kc">None</span>
        <span class="n">data_format</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">format</span> <span class="ow">or</span> <span class="bp">self</span><span class="o">.</span><span class="n">DEFAULT_FORMAT</span>
        <span class="n">format_func</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">SERIALIZATION_FUNCS</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="n">data_format</span><span class="p">)</span>
        <span class="k">if</span> <span class="n">format_func</span><span class="p">:</span>
            <span class="k">return</span> <span class="n">format_func</span><span class="p">(</span><span class="n">value</span><span class="p">)</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="k">return</span> <span class="n">value</span><span class="o">.</span><span class="n">strftime</span><span class="p">(</span><span class="n">data_format</span><span class="p">)</span>

    <span class="k">def</span> <span class="nf">_deserialize</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">value</span><span class="p">,</span> <span class="n">attr</span><span class="p">,</span> <span class="n">data</span><span class="p">,</span> <span class="o">**</span><span class="n">kwargs</span><span class="p">):</span>
        <span class="k">if</span> <span class="ow">not</span> <span class="n">value</span><span class="p">:</span>  <span class="c1"># Falsy values, e.g. &#39;&#39;, None, [] are not valid</span>
            <span class="k">raise</span> <span class="bp">self</span><span class="o">.</span><span class="n">make_error</span><span class="p">(</span><span class="s2">&quot;invalid&quot;</span><span class="p">,</span> <span class="nb">input</span><span class="o">=</span><span class="n">value</span><span class="p">,</span> <span class="n">obj_type</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">OBJ_TYPE</span><span class="p">)</span>
        <span class="n">data_format</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">format</span> <span class="ow">or</span> <span class="bp">self</span><span class="o">.</span><span class="n">DEFAULT_FORMAT</span>
        <span class="n">func</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">DESERIALIZATION_FUNCS</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="n">data_format</span><span class="p">)</span>
        <span class="k">if</span> <span class="n">func</span><span class="p">:</span>
            <span class="k">try</span><span class="p">:</span>
                <span class="k">return</span> <span class="n">func</span><span class="p">(</span><span class="n">value</span><span class="p">)</span>
            <span class="k">except</span> <span class="p">(</span><span class="ne">TypeError</span><span class="p">,</span> <span class="ne">AttributeError</span><span class="p">,</span> <span class="ne">ValueError</span><span class="p">)</span> <span class="k">as</span> <span class="n">error</span><span class="p">:</span>
                <span class="k">raise</span> <span class="bp">self</span><span class="o">.</span><span class="n">make_error</span><span class="p">(</span>
                    <span class="s2">&quot;invalid&quot;</span><span class="p">,</span> <span class="nb">input</span><span class="o">=</span><span class="n">value</span><span class="p">,</span> <span class="n">obj_type</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">OBJ_TYPE</span>
                <span class="p">)</span> <span class="kn">from</span> <span class="nn">error</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="k">try</span><span class="p">:</span>
                <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">_make_object_from_format</span><span class="p">(</span><span class="n">value</span><span class="p">,</span> <span class="n">data_format</span><span class="p">)</span>
            <span class="k">except</span> <span class="p">(</span><span class="ne">TypeError</span><span class="p">,</span> <span class="ne">AttributeError</span><span class="p">,</span> <span class="ne">ValueError</span><span class="p">)</span> <span class="k">as</span> <span class="n">error</span><span class="p">:</span>
                <span class="k">raise</span> <span class="bp">self</span><span class="o">.</span><span class="n">make_error</span><span class="p">(</span>
                    <span class="s2">&quot;invalid&quot;</span><span class="p">,</span> <span class="nb">input</span><span class="o">=</span><span class="n">value</span><span class="p">,</span> <span class="n">obj_type</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">OBJ_TYPE</span>
                <span class="p">)</span> <span class="kn">from</span> <span class="nn">error</span>

    <span class="nd">@staticmethod</span>
    <span class="k">def</span> <span class="nf">_make_object_from_format</span><span class="p">(</span><span class="n">value</span><span class="p">,</span> <span class="n">data_format</span><span class="p">):</span>
        <span class="k">return</span> <span class="n">dt</span><span class="o">.</span><span class="n">datetime</span><span class="o">.</span><span class="n">strptime</span><span class="p">(</span><span class="n">value</span><span class="p">,</span> <span class="n">data_format</span><span class="p">)</span>


<span class="k">class</span> <span class="nc">NaiveDateTime</span><span class="p">(</span><span class="n">DateTime</span><span class="p">):</span>
    <span class="sd">&quot;&quot;&quot;A formatted naive datetime string.</span>

<span class="sd">    :param format: See :class:`DateTime`.</span>
<span class="sd">    :param timezone: Used on deserialization. If `None`,</span>
<span class="sd">        aware datetimes are rejected. If not `None`, aware datetimes are</span>
<span class="sd">        converted to this timezone before their timezone information is</span>
<span class="sd">        removed.</span>
<span class="sd">    :param kwargs: The same keyword arguments that :class:`Field` receives.</span>

<span class="sd">    .. versionadded:: 3.0.0rc9</span>
<span class="sd">    &quot;&quot;&quot;</span>

    <span class="n">AWARENESS</span> <span class="o">=</span> <span class="s2">&quot;naive&quot;</span>

    <span class="k">def</span> <span class="fm">__init__</span><span class="p">(</span>
        <span class="bp">self</span><span class="p">,</span>
        <span class="nb">format</span><span class="p">:</span> <span class="n">typing</span><span class="o">.</span><span class="n">Optional</span><span class="p">[</span><span class="nb">str</span><span class="p">]</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span>
        <span class="o">*</span><span class="p">,</span>
        <span class="n">timezone</span><span class="p">:</span> <span class="n">typing</span><span class="o">.</span><span class="n">Optional</span><span class="p">[</span><span class="n">dt</span><span class="o">.</span><span class="n">timezone</span><span class="p">]</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span>
        <span class="o">**</span><span class="n">kwargs</span><span class="p">,</span>
    <span class="p">):</span>
        <span class="nb">super</span><span class="p">()</span><span class="o">.</span><span class="fm">__init__</span><span class="p">(</span><span class="nb">format</span><span class="o">=</span><span class="nb">format</span><span class="p">,</span> <span class="o">**</span><span class="n">kwargs</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">timezone</span> <span class="o">=</span> <span class="n">timezone</span>

    <span class="k">def</span> <span class="nf">_deserialize</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">value</span><span class="p">,</span> <span class="n">attr</span><span class="p">,</span> <span class="n">data</span><span class="p">,</span> <span class="o">**</span><span class="n">kwargs</span><span class="p">):</span>
        <span class="n">ret</span> <span class="o">=</span> <span class="nb">super</span><span class="p">()</span><span class="o">.</span><span class="n">_deserialize</span><span class="p">(</span><span class="n">value</span><span class="p">,</span> <span class="n">attr</span><span class="p">,</span> <span class="n">data</span><span class="p">,</span> <span class="o">**</span><span class="n">kwargs</span><span class="p">)</span>
        <span class="k">if</span> <span class="n">is_aware</span><span class="p">(</span><span class="n">ret</span><span class="p">):</span>
            <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">timezone</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
                <span class="k">raise</span> <span class="bp">self</span><span class="o">.</span><span class="n">make_error</span><span class="p">(</span>
                    <span class="s2">&quot;invalid_awareness&quot;</span><span class="p">,</span>
                    <span class="n">awareness</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">AWARENESS</span><span class="p">,</span>
                    <span class="n">obj_type</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">OBJ_TYPE</span><span class="p">,</span>
                <span class="p">)</span>
            <span class="n">ret</span> <span class="o">=</span> <span class="n">ret</span><span class="o">.</span><span class="n">astimezone</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">timezone</span><span class="p">)</span><span class="o">.</span><span class="n">replace</span><span class="p">(</span><span class="n">tzinfo</span><span class="o">=</span><span class="kc">None</span><span class="p">)</span>
        <span class="k">return</span> <span class="n">ret</span>


<span class="k">class</span> <span class="nc">AwareDateTime</span><span class="p">(</span><span class="n">DateTime</span><span class="p">):</span>
    <span class="sd">&quot;&quot;&quot;A formatted aware datetime string.</span>

<span class="sd">    :param format: See :class:`DateTime`.</span>
<span class="sd">    :param default_timezone: Used on deserialization. If `None`, naive</span>
<span class="sd">        datetimes are rejected. If not `None`, naive datetimes are set this</span>
<span class="sd">        timezone.</span>
<span class="sd">    :param kwargs: The same keyword arguments that :class:`Field` receives.</span>

<span class="sd">    .. versionadded:: 3.0.0rc9</span>
<span class="sd">    &quot;&quot;&quot;</span>

    <span class="n">AWARENESS</span> <span class="o">=</span> <span class="s2">&quot;aware&quot;</span>

    <span class="k">def</span> <span class="fm">__init__</span><span class="p">(</span>
        <span class="bp">self</span><span class="p">,</span>
        <span class="nb">format</span><span class="p">:</span> <span class="n">typing</span><span class="o">.</span><span class="n">Optional</span><span class="p">[</span><span class="nb">str</span><span class="p">]</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span>
        <span class="o">*</span><span class="p">,</span>
        <span class="n">default_timezone</span><span class="p">:</span> <span class="n">typing</span><span class="o">.</span><span class="n">Optional</span><span class="p">[</span><span class="n">dt</span><span class="o">.</span><span class="n">tzinfo</span><span class="p">]</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span>
        <span class="o">**</span><span class="n">kwargs</span><span class="p">,</span>
    <span class="p">):</span>
        <span class="nb">super</span><span class="p">()</span><span class="o">.</span><span class="fm">__init__</span><span class="p">(</span><span class="nb">format</span><span class="o">=</span><span class="nb">format</span><span class="p">,</span> <span class="o">**</span><span class="n">kwargs</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">default_timezone</span> <span class="o">=</span> <span class="n">default_timezone</span>

    <span class="k">def</span> <span class="nf">_deserialize</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">value</span><span class="p">,</span> <span class="n">attr</span><span class="p">,</span> <span class="n">data</span><span class="p">,</span> <span class="o">**</span><span class="n">kwargs</span><span class="p">):</span>
        <span class="n">ret</span> <span class="o">=</span> <span class="nb">super</span><span class="p">()</span><span class="o">.</span><span class="n">_deserialize</span><span class="p">(</span><span class="n">value</span><span class="p">,</span> <span class="n">attr</span><span class="p">,</span> <span class="n">data</span><span class="p">,</span> <span class="o">**</span><span class="n">kwargs</span><span class="p">)</span>
        <span class="k">if</span> <span class="ow">not</span> <span class="n">is_aware</span><span class="p">(</span><span class="n">ret</span><span class="p">):</span>
            <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">default_timezone</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
                <span class="k">raise</span> <span class="bp">self</span><span class="o">.</span><span class="n">make_error</span><span class="p">(</span>
                    <span class="s2">&quot;invalid_awareness&quot;</span><span class="p">,</span>
                    <span class="n">awareness</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">AWARENESS</span><span class="p">,</span>
                    <span class="n">obj_type</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">OBJ_TYPE</span><span class="p">,</span>
                <span class="p">)</span>
            <span class="n">ret</span> <span class="o">=</span> <span class="n">ret</span><span class="o">.</span><span class="n">replace</span><span class="p">(</span><span class="n">tzinfo</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">default_timezone</span><span class="p">)</span>
        <span class="k">return</span> <span class="n">ret</span>


<span class="k">class</span> <span class="nc">Time</span><span class="p">(</span><span class="n">DateTime</span><span class="p">):</span>
    <span class="sd">&quot;&quot;&quot;A formatted time string.</span>

<span class="sd">    Example: ``&#39;03:12:58.019077&#39;``</span>

<span class="sd">    :param format: Either ``&quot;iso&quot;`` (for ISO8601) or a date format string.</span>
<span class="sd">        If `None`, defaults to &quot;iso&quot;.</span>
<span class="sd">    :param kwargs: The same keyword arguments that :class:`Field` receives.</span>
<span class="sd">    &quot;&quot;&quot;</span>

    <span class="n">SERIALIZATION_FUNCS</span> <span class="o">=</span> <span class="p">{</span><span class="s2">&quot;iso&quot;</span><span class="p">:</span> <span class="n">utils</span><span class="o">.</span><span class="n">to_iso_time</span><span class="p">,</span> <span class="s2">&quot;iso8601&quot;</span><span class="p">:</span> <span class="n">utils</span><span class="o">.</span><span class="n">to_iso_time</span><span class="p">}</span>

    <span class="n">DESERIALIZATION_FUNCS</span> <span class="o">=</span> <span class="p">{</span><span class="s2">&quot;iso&quot;</span><span class="p">:</span> <span class="n">utils</span><span class="o">.</span><span class="n">from_iso_time</span><span class="p">,</span> <span class="s2">&quot;iso8601&quot;</span><span class="p">:</span> <span class="n">utils</span><span class="o">.</span><span class="n">from_iso_time</span><span class="p">}</span>

    <span class="n">DEFAULT_FORMAT</span> <span class="o">=</span> <span class="s2">&quot;iso&quot;</span>

    <span class="n">OBJ_TYPE</span> <span class="o">=</span> <span class="s2">&quot;time&quot;</span>

    <span class="n">SCHEMA_OPTS_VAR_NAME</span> <span class="o">=</span> <span class="s2">&quot;timeformat&quot;</span>

    <span class="nd">@staticmethod</span>
    <span class="k">def</span> <span class="nf">_make_object_from_format</span><span class="p">(</span><span class="n">value</span><span class="p">,</span> <span class="n">data_format</span><span class="p">):</span>
        <span class="k">return</span> <span class="n">dt</span><span class="o">.</span><span class="n">datetime</span><span class="o">.</span><span class="n">strptime</span><span class="p">(</span><span class="n">value</span><span class="p">,</span> <span class="n">data_format</span><span class="p">)</span><span class="o">.</span><span class="n">time</span><span class="p">()</span>


<span class="k">class</span> <span class="nc">Date</span><span class="p">(</span><span class="n">DateTime</span><span class="p">):</span>
    <span class="sd">&quot;&quot;&quot;ISO8601-formatted date string.</span>

<span class="sd">    :param format: Either ``&quot;iso&quot;`` (for ISO8601) or a date format string.</span>
<span class="sd">        If `None`, defaults to &quot;iso&quot;.</span>
<span class="sd">    :param kwargs: The same keyword arguments that :class:`Field` receives.</span>
<span class="sd">    &quot;&quot;&quot;</span>

    <span class="c1">#: Default error messages.</span>
    <span class="n">default_error_messages</span> <span class="o">=</span> <span class="p">{</span>
        <span class="s2">&quot;invalid&quot;</span><span class="p">:</span> <span class="s2">&quot;Not a valid date.&quot;</span><span class="p">,</span>
        <span class="s2">&quot;format&quot;</span><span class="p">:</span> <span class="s1">&#39;&quot;</span><span class="si">{input}</span><span class="s1">&quot; cannot be formatted as a date.&#39;</span><span class="p">,</span>
    <span class="p">}</span>

    <span class="n">SERIALIZATION_FUNCS</span> <span class="o">=</span> <span class="p">{</span><span class="s2">&quot;iso&quot;</span><span class="p">:</span> <span class="n">utils</span><span class="o">.</span><span class="n">to_iso_date</span><span class="p">,</span> <span class="s2">&quot;iso8601&quot;</span><span class="p">:</span> <span class="n">utils</span><span class="o">.</span><span class="n">to_iso_date</span><span class="p">}</span>

    <span class="n">DESERIALIZATION_FUNCS</span> <span class="o">=</span> <span class="p">{</span><span class="s2">&quot;iso&quot;</span><span class="p">:</span> <span class="n">utils</span><span class="o">.</span><span class="n">from_iso_date</span><span class="p">,</span> <span class="s2">&quot;iso8601&quot;</span><span class="p">:</span> <span class="n">utils</span><span class="o">.</span><span class="n">from_iso_date</span><span class="p">}</span>

    <span class="n">DEFAULT_FORMAT</span> <span class="o">=</span> <span class="s2">&quot;iso&quot;</span>

    <span class="n">OBJ_TYPE</span> <span class="o">=</span> <span class="s2">&quot;date&quot;</span>

    <span class="n">SCHEMA_OPTS_VAR_NAME</span> <span class="o">=</span> <span class="s2">&quot;dateformat&quot;</span>

    <span class="nd">@staticmethod</span>
    <span class="k">def</span> <span class="nf">_make_object_from_format</span><span class="p">(</span><span class="n">value</span><span class="p">,</span> <span class="n">data_format</span><span class="p">):</span>
        <span class="k">return</span> <span class="n">dt</span><span class="o">.</span><span class="n">datetime</span><span class="o">.</span><span class="n">strptime</span><span class="p">(</span><span class="n">value</span><span class="p">,</span> <span class="n">data_format</span><span class="p">)</span><span class="o">.</span><span class="n">date</span><span class="p">()</span>


<span class="k">class</span> <span class="nc">TimeDelta</span><span class="p">(</span><span class="n">Field</span><span class="p">):</span>
    <span class="sd">&quot;&quot;&quot;A field that (de)serializes a :class:`datetime.timedelta` object to an</span>
<span class="sd">    integer and vice versa. The integer can represent the number of days,</span>
<span class="sd">    seconds or microseconds.</span>

<span class="sd">    :param precision: Influences how the integer is interpreted during</span>
<span class="sd">        (de)serialization. Must be &#39;days&#39;, &#39;seconds&#39;, &#39;microseconds&#39;,</span>
<span class="sd">        &#39;milliseconds&#39;, &#39;minutes&#39;, &#39;hours&#39; or &#39;weeks&#39;.</span>
<span class="sd">    :param kwargs: The same keyword arguments that :class:`Field` receives.</span>

<span class="sd">    .. versionchanged:: 2.0.0</span>
<span class="sd">        Always serializes to an integer value to avoid rounding errors.</span>
<span class="sd">        Add `precision` parameter.</span>
<span class="sd">    &quot;&quot;&quot;</span>

    <span class="n">DAYS</span> <span class="o">=</span> <span class="s2">&quot;days&quot;</span>
    <span class="n">SECONDS</span> <span class="o">=</span> <span class="s2">&quot;seconds&quot;</span>
    <span class="n">MICROSECONDS</span> <span class="o">=</span> <span class="s2">&quot;microseconds&quot;</span>
    <span class="n">MILLISECONDS</span> <span class="o">=</span> <span class="s2">&quot;milliseconds&quot;</span>
    <span class="n">MINUTES</span> <span class="o">=</span> <span class="s2">&quot;minutes&quot;</span>
    <span class="n">HOURS</span> <span class="o">=</span> <span class="s2">&quot;hours&quot;</span>
    <span class="n">WEEKS</span> <span class="o">=</span> <span class="s2">&quot;weeks&quot;</span>

    <span class="c1">#: Default error messages.</span>
    <span class="n">default_error_messages</span> <span class="o">=</span> <span class="p">{</span>
        <span class="s2">&quot;invalid&quot;</span><span class="p">:</span> <span class="s2">&quot;Not a valid period of time.&quot;</span><span class="p">,</span>
        <span class="s2">&quot;format&quot;</span><span class="p">:</span> <span class="s2">&quot;</span><span class="si">{input!r}</span><span class="s2"> cannot be formatted as a timedelta.&quot;</span><span class="p">,</span>
    <span class="p">}</span>

    <span class="k">def</span> <span class="fm">__init__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">precision</span><span class="p">:</span> <span class="nb">str</span> <span class="o">=</span> <span class="n">SECONDS</span><span class="p">,</span> <span class="o">**</span><span class="n">kwargs</span><span class="p">):</span>
        <span class="n">precision</span> <span class="o">=</span> <span class="n">precision</span><span class="o">.</span><span class="n">lower</span><span class="p">()</span>
        <span class="n">units</span> <span class="o">=</span> <span class="p">(</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">DAYS</span><span class="p">,</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">SECONDS</span><span class="p">,</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">MICROSECONDS</span><span class="p">,</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">MILLISECONDS</span><span class="p">,</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">MINUTES</span><span class="p">,</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">HOURS</span><span class="p">,</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">WEEKS</span><span class="p">,</span>
        <span class="p">)</span>

        <span class="k">if</span> <span class="n">precision</span> <span class="ow">not</span> <span class="ow">in</span> <span class="n">units</span><span class="p">:</span>
            <span class="n">msg</span> <span class="o">=</span> <span class="s1">&#39;The precision must be </span><span class="si">{}</span><span class="s1"> or &quot;</span><span class="si">{}</span><span class="s1">&quot;.&#39;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span>
                <span class="s2">&quot;, &quot;</span><span class="o">.</span><span class="n">join</span><span class="p">([</span><span class="sa">f</span><span class="s1">&#39;&quot;</span><span class="si">{each}</span><span class="s1">&quot;&#39;</span> <span class="k">for</span> <span class="n">each</span> <span class="ow">in</span> <span class="n">units</span><span class="p">[:</span><span class="o">-</span><span class="mi">1</span><span class="p">]]),</span> <span class="n">units</span><span class="p">[</span><span class="o">-</span><span class="mi">1</span><span class="p">]</span>
            <span class="p">)</span>
            <span class="k">raise</span> <span class="ne">ValueError</span><span class="p">(</span><span class="n">msg</span><span class="p">)</span>

        <span class="bp">self</span><span class="o">.</span><span class="n">precision</span> <span class="o">=</span> <span class="n">precision</span>
        <span class="nb">super</span><span class="p">()</span><span class="o">.</span><span class="fm">__init__</span><span class="p">(</span><span class="o">**</span><span class="n">kwargs</span><span class="p">)</span>

    <span class="k">def</span> <span class="nf">_serialize</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">value</span><span class="p">,</span> <span class="n">attr</span><span class="p">,</span> <span class="n">obj</span><span class="p">,</span> <span class="o">**</span><span class="n">kwargs</span><span class="p">):</span>
        <span class="k">if</span> <span class="n">value</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
            <span class="k">return</span> <span class="kc">None</span>
        <span class="n">base_unit</span> <span class="o">=</span> <span class="n">dt</span><span class="o">.</span><span class="n">timedelta</span><span class="p">(</span><span class="o">**</span><span class="p">{</span><span class="bp">self</span><span class="o">.</span><span class="n">precision</span><span class="p">:</span> <span class="mi">1</span><span class="p">})</span>
        <span class="n">delta</span> <span class="o">=</span> <span class="n">utils</span><span class="o">.</span><span class="n">timedelta_to_microseconds</span><span class="p">(</span><span class="n">value</span><span class="p">)</span>
        <span class="n">unit</span> <span class="o">=</span> <span class="n">utils</span><span class="o">.</span><span class="n">timedelta_to_microseconds</span><span class="p">(</span><span class="n">base_unit</span><span class="p">)</span>
        <span class="k">return</span> <span class="n">delta</span> <span class="o">//</span> <span class="n">unit</span>

    <span class="k">def</span> <span class="nf">_deserialize</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">value</span><span class="p">,</span> <span class="n">attr</span><span class="p">,</span> <span class="n">data</span><span class="p">,</span> <span class="o">**</span><span class="n">kwargs</span><span class="p">):</span>
        <span class="k">try</span><span class="p">:</span>
            <span class="n">value</span> <span class="o">=</span> <span class="nb">int</span><span class="p">(</span><span class="n">value</span><span class="p">)</span>
        <span class="k">except</span> <span class="p">(</span><span class="ne">TypeError</span><span class="p">,</span> <span class="ne">ValueError</span><span class="p">)</span> <span class="k">as</span> <span class="n">error</span><span class="p">:</span>
            <span class="k">raise</span> <span class="bp">self</span><span class="o">.</span><span class="n">make_error</span><span class="p">(</span><span class="s2">&quot;invalid&quot;</span><span class="p">)</span> <span class="kn">from</span> <span class="nn">error</span>

        <span class="n">kwargs</span> <span class="o">=</span> <span class="p">{</span><span class="bp">self</span><span class="o">.</span><span class="n">precision</span><span class="p">:</span> <span class="n">value</span><span class="p">}</span>

        <span class="k">try</span><span class="p">:</span>
            <span class="k">return</span> <span class="n">dt</span><span class="o">.</span><span class="n">timedelta</span><span class="p">(</span><span class="o">**</span><span class="n">kwargs</span><span class="p">)</span>
        <span class="k">except</span> <span class="ne">OverflowError</span> <span class="k">as</span> <span class="n">error</span><span class="p">:</span>
            <span class="k">raise</span> <span class="bp">self</span><span class="o">.</span><span class="n">make_error</span><span class="p">(</span><span class="s2">&quot;invalid&quot;</span><span class="p">)</span> <span class="kn">from</span> <span class="nn">error</span>


<span class="k">class</span> <span class="nc">Mapping</span><span class="p">(</span><span class="n">Field</span><span class="p">):</span>
    <span class="sd">&quot;&quot;&quot;An abstract class for objects with key-value pairs.</span>

<span class="sd">    :param keys: A field class or instance for dict keys.</span>
<span class="sd">    :param values: A field class or instance for dict values.</span>
<span class="sd">    :param kwargs: The same keyword arguments that :class:`Field` receives.</span>

<span class="sd">    .. note::</span>
<span class="sd">        When the structure of nested data is not known, you may omit the</span>
<span class="sd">        `keys` and `values` arguments to prevent content validation.</span>

<span class="sd">    .. versionadded:: 3.0.0rc4</span>
<span class="sd">    &quot;&quot;&quot;</span>

    <span class="n">mapping_type</span> <span class="o">=</span> <span class="nb">dict</span>

    <span class="c1">#: Default error messages.</span>
    <span class="n">default_error_messages</span> <span class="o">=</span> <span class="p">{</span><span class="s2">&quot;invalid&quot;</span><span class="p">:</span> <span class="s2">&quot;Not a valid mapping type.&quot;</span><span class="p">}</span>

    <span class="k">def</span> <span class="fm">__init__</span><span class="p">(</span>
        <span class="bp">self</span><span class="p">,</span>
        <span class="n">keys</span><span class="p">:</span> <span class="n">typing</span><span class="o">.</span><span class="n">Optional</span><span class="p">[</span><span class="n">typing</span><span class="o">.</span><span class="n">Union</span><span class="p">[</span><span class="n">Field</span><span class="p">,</span> <span class="nb">type</span><span class="p">]]</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span>
        <span class="n">values</span><span class="p">:</span> <span class="n">typing</span><span class="o">.</span><span class="n">Optional</span><span class="p">[</span><span class="n">typing</span><span class="o">.</span><span class="n">Union</span><span class="p">[</span><span class="n">Field</span><span class="p">,</span> <span class="nb">type</span><span class="p">]]</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span>
        <span class="o">**</span><span class="n">kwargs</span><span class="p">,</span>
    <span class="p">):</span>
        <span class="nb">super</span><span class="p">()</span><span class="o">.</span><span class="fm">__init__</span><span class="p">(</span><span class="o">**</span><span class="n">kwargs</span><span class="p">)</span>
        <span class="k">if</span> <span class="n">keys</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">key_field</span> <span class="o">=</span> <span class="kc">None</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="k">try</span><span class="p">:</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">key_field</span> <span class="o">=</span> <span class="n">resolve_field_instance</span><span class="p">(</span><span class="n">keys</span><span class="p">)</span>
            <span class="k">except</span> <span class="n">FieldInstanceResolutionError</span> <span class="k">as</span> <span class="n">error</span><span class="p">:</span>
                <span class="k">raise</span> <span class="ne">ValueError</span><span class="p">(</span>
                    <span class="s1">&#39;&quot;keys&quot; must be a subclass or instance of &#39;</span>
                    <span class="s2">&quot;marshmallow.base.FieldABC.&quot;</span>
                <span class="p">)</span> <span class="kn">from</span> <span class="nn">error</span>

        <span class="k">if</span> <span class="n">values</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">value_field</span> <span class="o">=</span> <span class="kc">None</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="k">try</span><span class="p">:</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">value_field</span> <span class="o">=</span> <span class="n">resolve_field_instance</span><span class="p">(</span><span class="n">values</span><span class="p">)</span>
            <span class="k">except</span> <span class="n">FieldInstanceResolutionError</span> <span class="k">as</span> <span class="n">error</span><span class="p">:</span>
                <span class="k">raise</span> <span class="ne">ValueError</span><span class="p">(</span>
                    <span class="s1">&#39;&quot;values&quot; must be a subclass or instance of &#39;</span>
                    <span class="s2">&quot;marshmallow.base.FieldABC.&quot;</span>
                <span class="p">)</span> <span class="kn">from</span> <span class="nn">error</span>
            <span class="k">if</span> <span class="nb">isinstance</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">value_field</span><span class="p">,</span> <span class="n">Nested</span><span class="p">):</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">only</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">value_field</span><span class="o">.</span><span class="n">only</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">exclude</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">value_field</span><span class="o">.</span><span class="n">exclude</span>

    <span class="k">def</span> <span class="nf">_bind_to_schema</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">field_name</span><span class="p">,</span> <span class="n">schema</span><span class="p">):</span>
        <span class="nb">super</span><span class="p">()</span><span class="o">.</span><span class="n">_bind_to_schema</span><span class="p">(</span><span class="n">field_name</span><span class="p">,</span> <span class="n">schema</span><span class="p">)</span>
        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">value_field</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">value_field</span> <span class="o">=</span> <span class="n">copy</span><span class="o">.</span><span class="n">deepcopy</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">value_field</span><span class="p">)</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">value_field</span><span class="o">.</span><span class="n">_bind_to_schema</span><span class="p">(</span><span class="n">field_name</span><span class="p">,</span> <span class="bp">self</span><span class="p">)</span>
        <span class="k">if</span> <span class="nb">isinstance</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">value_field</span><span class="p">,</span> <span class="n">Nested</span><span class="p">):</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">value_field</span><span class="o">.</span><span class="n">only</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">only</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">value_field</span><span class="o">.</span><span class="n">exclude</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">exclude</span>
        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">key_field</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">key_field</span> <span class="o">=</span> <span class="n">copy</span><span class="o">.</span><span class="n">deepcopy</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">key_field</span><span class="p">)</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">key_field</span><span class="o">.</span><span class="n">_bind_to_schema</span><span class="p">(</span><span class="n">field_name</span><span class="p">,</span> <span class="bp">self</span><span class="p">)</span>

    <span class="k">def</span> <span class="nf">_serialize</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">value</span><span class="p">,</span> <span class="n">attr</span><span class="p">,</span> <span class="n">obj</span><span class="p">,</span> <span class="o">**</span><span class="n">kwargs</span><span class="p">):</span>
        <span class="k">if</span> <span class="n">value</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
            <span class="k">return</span> <span class="kc">None</span>
        <span class="k">if</span> <span class="ow">not</span> <span class="bp">self</span><span class="o">.</span><span class="n">value_field</span> <span class="ow">and</span> <span class="ow">not</span> <span class="bp">self</span><span class="o">.</span><span class="n">key_field</span><span class="p">:</span>
            <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">mapping_type</span><span class="p">(</span><span class="n">value</span><span class="p">)</span>

        <span class="c1">#  Serialize keys</span>
        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">key_field</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
            <span class="n">keys</span> <span class="o">=</span> <span class="p">{</span><span class="n">k</span><span class="p">:</span> <span class="n">k</span> <span class="k">for</span> <span class="n">k</span> <span class="ow">in</span> <span class="n">value</span><span class="o">.</span><span class="n">keys</span><span class="p">()}</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="n">keys</span> <span class="o">=</span> <span class="p">{</span>
                <span class="n">k</span><span class="p">:</span> <span class="bp">self</span><span class="o">.</span><span class="n">key_field</span><span class="o">.</span><span class="n">_serialize</span><span class="p">(</span><span class="n">k</span><span class="p">,</span> <span class="kc">None</span><span class="p">,</span> <span class="kc">None</span><span class="p">,</span> <span class="o">**</span><span class="n">kwargs</span><span class="p">)</span>
                <span class="k">for</span> <span class="n">k</span> <span class="ow">in</span> <span class="n">value</span><span class="o">.</span><span class="n">keys</span><span class="p">()</span>
            <span class="p">}</span>

        <span class="c1">#  Serialize values</span>
        <span class="n">result</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">mapping_type</span><span class="p">()</span>
        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">value_field</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
            <span class="k">for</span> <span class="n">k</span><span class="p">,</span> <span class="n">v</span> <span class="ow">in</span> <span class="n">value</span><span class="o">.</span><span class="n">items</span><span class="p">():</span>
                <span class="k">if</span> <span class="n">k</span> <span class="ow">in</span> <span class="n">keys</span><span class="p">:</span>
                    <span class="n">result</span><span class="p">[</span><span class="n">keys</span><span class="p">[</span><span class="n">k</span><span class="p">]]</span> <span class="o">=</span> <span class="n">v</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="k">for</span> <span class="n">k</span><span class="p">,</span> <span class="n">v</span> <span class="ow">in</span> <span class="n">value</span><span class="o">.</span><span class="n">items</span><span class="p">():</span>
                <span class="n">result</span><span class="p">[</span><span class="n">keys</span><span class="p">[</span><span class="n">k</span><span class="p">]]</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">value_field</span><span class="o">.</span><span class="n">_serialize</span><span class="p">(</span><span class="n">v</span><span class="p">,</span> <span class="kc">None</span><span class="p">,</span> <span class="kc">None</span><span class="p">,</span> <span class="o">**</span><span class="n">kwargs</span><span class="p">)</span>

        <span class="k">return</span> <span class="n">result</span>

    <span class="k">def</span> <span class="nf">_deserialize</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">value</span><span class="p">,</span> <span class="n">attr</span><span class="p">,</span> <span class="n">data</span><span class="p">,</span> <span class="o">**</span><span class="n">kwargs</span><span class="p">):</span>
        <span class="k">if</span> <span class="ow">not</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">value</span><span class="p">,</span> <span class="n">_Mapping</span><span class="p">):</span>
            <span class="k">raise</span> <span class="bp">self</span><span class="o">.</span><span class="n">make_error</span><span class="p">(</span><span class="s2">&quot;invalid&quot;</span><span class="p">)</span>
        <span class="k">if</span> <span class="ow">not</span> <span class="bp">self</span><span class="o">.</span><span class="n">value_field</span> <span class="ow">and</span> <span class="ow">not</span> <span class="bp">self</span><span class="o">.</span><span class="n">key_field</span><span class="p">:</span>
            <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">mapping_type</span><span class="p">(</span><span class="n">value</span><span class="p">)</span>

        <span class="n">errors</span> <span class="o">=</span> <span class="n">collections</span><span class="o">.</span><span class="n">defaultdict</span><span class="p">(</span><span class="nb">dict</span><span class="p">)</span>

        <span class="c1">#  Deserialize keys</span>
        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">key_field</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
            <span class="n">keys</span> <span class="o">=</span> <span class="p">{</span><span class="n">k</span><span class="p">:</span> <span class="n">k</span> <span class="k">for</span> <span class="n">k</span> <span class="ow">in</span> <span class="n">value</span><span class="o">.</span><span class="n">keys</span><span class="p">()}</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="n">keys</span> <span class="o">=</span> <span class="p">{}</span>
            <span class="k">for</span> <span class="n">key</span> <span class="ow">in</span> <span class="n">value</span><span class="o">.</span><span class="n">keys</span><span class="p">():</span>
                <span class="k">try</span><span class="p">:</span>
                    <span class="n">keys</span><span class="p">[</span><span class="n">key</span><span class="p">]</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">key_field</span><span class="o">.</span><span class="n">deserialize</span><span class="p">(</span><span class="n">key</span><span class="p">,</span> <span class="o">**</span><span class="n">kwargs</span><span class="p">)</span>
                <span class="k">except</span> <span class="n">ValidationError</span> <span class="k">as</span> <span class="n">error</span><span class="p">:</span>
                    <span class="n">errors</span><span class="p">[</span><span class="n">key</span><span class="p">][</span><span class="s2">&quot;key&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="n">error</span><span class="o">.</span><span class="n">messages</span>

        <span class="c1">#  Deserialize values</span>
        <span class="n">result</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">mapping_type</span><span class="p">()</span>
        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">value_field</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
            <span class="k">for</span> <span class="n">k</span><span class="p">,</span> <span class="n">v</span> <span class="ow">in</span> <span class="n">value</span><span class="o">.</span><span class="n">items</span><span class="p">():</span>
                <span class="k">if</span> <span class="n">k</span> <span class="ow">in</span> <span class="n">keys</span><span class="p">:</span>
                    <span class="n">result</span><span class="p">[</span><span class="n">keys</span><span class="p">[</span><span class="n">k</span><span class="p">]]</span> <span class="o">=</span> <span class="n">v</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="k">for</span> <span class="n">key</span><span class="p">,</span> <span class="n">val</span> <span class="ow">in</span> <span class="n">value</span><span class="o">.</span><span class="n">items</span><span class="p">():</span>
                <span class="k">try</span><span class="p">:</span>
                    <span class="n">deser_val</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">value_field</span><span class="o">.</span><span class="n">deserialize</span><span class="p">(</span><span class="n">val</span><span class="p">,</span> <span class="o">**</span><span class="n">kwargs</span><span class="p">)</span>
                <span class="k">except</span> <span class="n">ValidationError</span> <span class="k">as</span> <span class="n">error</span><span class="p">:</span>
                    <span class="n">errors</span><span class="p">[</span><span class="n">key</span><span class="p">][</span><span class="s2">&quot;value&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="n">error</span><span class="o">.</span><span class="n">messages</span>
                    <span class="k">if</span> <span class="n">error</span><span class="o">.</span><span class="n">valid_data</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span> <span class="ow">and</span> <span class="n">key</span> <span class="ow">in</span> <span class="n">keys</span><span class="p">:</span>
                        <span class="n">result</span><span class="p">[</span><span class="n">keys</span><span class="p">[</span><span class="n">key</span><span class="p">]]</span> <span class="o">=</span> <span class="n">error</span><span class="o">.</span><span class="n">valid_data</span>
                <span class="k">else</span><span class="p">:</span>
                    <span class="k">if</span> <span class="n">key</span> <span class="ow">in</span> <span class="n">keys</span><span class="p">:</span>
                        <span class="n">result</span><span class="p">[</span><span class="n">keys</span><span class="p">[</span><span class="n">key</span><span class="p">]]</span> <span class="o">=</span> <span class="n">deser_val</span>

        <span class="k">if</span> <span class="n">errors</span><span class="p">:</span>
            <span class="k">raise</span> <span class="n">ValidationError</span><span class="p">(</span><span class="n">errors</span><span class="p">,</span> <span class="n">valid_data</span><span class="o">=</span><span class="n">result</span><span class="p">)</span>

        <span class="k">return</span> <span class="n">result</span>


<span class="k">class</span> <span class="nc">Dict</span><span class="p">(</span><span class="n">Mapping</span><span class="p">):</span>
    <span class="sd">&quot;&quot;&quot;A dict field. Supports dicts and dict-like objects. Extends</span>
<span class="sd">    Mapping with dict as the mapping_type.</span>

<span class="sd">    Example: ::</span>

<span class="sd">        numbers = fields.Dict(keys=fields.Str(), values=fields.Float())</span>

<span class="sd">    :param kwargs: The same keyword arguments that :class:`Mapping` receives.</span>

<span class="sd">    .. versionadded:: 2.1.0</span>
<span class="sd">    &quot;&quot;&quot;</span>

    <span class="n">mapping_type</span> <span class="o">=</span> <span class="nb">dict</span>


<span class="k">class</span> <span class="nc">Url</span><span class="p">(</span><span class="n">String</span><span class="p">):</span>
    <span class="sd">&quot;&quot;&quot;An URL field.</span>

<span class="sd">    :param default: Default value for the field if the attribute is not set.</span>
<span class="sd">    :param relative: Whether to allow relative URLs.</span>
<span class="sd">    :param require_tld: Whether to reject non-FQDN hostnames.</span>
<span class="sd">    :param schemes: Valid schemes. By default, ``http``, ``https``,</span>
<span class="sd">        ``ftp``, and ``ftps`` are allowed.</span>
<span class="sd">    :param kwargs: The same keyword arguments that :class:`String` receives.</span>
<span class="sd">    &quot;&quot;&quot;</span>

    <span class="c1">#: Default error messages.</span>
    <span class="n">default_error_messages</span> <span class="o">=</span> <span class="p">{</span><span class="s2">&quot;invalid&quot;</span><span class="p">:</span> <span class="s2">&quot;Not a valid URL.&quot;</span><span class="p">}</span>

    <span class="k">def</span> <span class="fm">__init__</span><span class="p">(</span>
        <span class="bp">self</span><span class="p">,</span>
        <span class="o">*</span><span class="p">,</span>
        <span class="n">relative</span><span class="p">:</span> <span class="nb">bool</span> <span class="o">=</span> <span class="kc">False</span><span class="p">,</span>
        <span class="n">schemes</span><span class="p">:</span> <span class="n">typing</span><span class="o">.</span><span class="n">Optional</span><span class="p">[</span><span class="n">types</span><span class="o">.</span><span class="n">StrSequenceOrSet</span><span class="p">]</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span>
        <span class="n">require_tld</span><span class="p">:</span> <span class="nb">bool</span> <span class="o">=</span> <span class="kc">True</span><span class="p">,</span>
        <span class="o">**</span><span class="n">kwargs</span><span class="p">,</span>
    <span class="p">):</span>
        <span class="nb">super</span><span class="p">()</span><span class="o">.</span><span class="fm">__init__</span><span class="p">(</span><span class="o">**</span><span class="n">kwargs</span><span class="p">)</span>

        <span class="bp">self</span><span class="o">.</span><span class="n">relative</span> <span class="o">=</span> <span class="n">relative</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">require_tld</span> <span class="o">=</span> <span class="n">require_tld</span>
        <span class="c1"># Insert validation into self.validators so that multiple errors can be stored.</span>
        <span class="n">validator</span> <span class="o">=</span> <span class="n">validate</span><span class="o">.</span><span class="n">URL</span><span class="p">(</span>
            <span class="n">relative</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">relative</span><span class="p">,</span>
            <span class="n">schemes</span><span class="o">=</span><span class="n">schemes</span><span class="p">,</span>
            <span class="n">require_tld</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">require_tld</span><span class="p">,</span>
            <span class="n">error</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">error_messages</span><span class="p">[</span><span class="s2">&quot;invalid&quot;</span><span class="p">],</span>
        <span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">validators</span><span class="o">.</span><span class="n">insert</span><span class="p">(</span><span class="mi">0</span><span class="p">,</span> <span class="n">validator</span><span class="p">)</span>


<span class="k">class</span> <span class="nc">Email</span><span class="p">(</span><span class="n">String</span><span class="p">):</span>
    <span class="sd">&quot;&quot;&quot;An email field.</span>

<span class="sd">    :param args: The same positional arguments that :class:`String` receives.</span>
<span class="sd">    :param kwargs: The same keyword arguments that :class:`String` receives.</span>
<span class="sd">    &quot;&quot;&quot;</span>

    <span class="c1">#: Default error messages.</span>
    <span class="n">default_error_messages</span> <span class="o">=</span> <span class="p">{</span><span class="s2">&quot;invalid&quot;</span><span class="p">:</span> <span class="s2">&quot;Not a valid email address.&quot;</span><span class="p">}</span>

    <span class="k">def</span> <span class="fm">__init__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="o">*</span><span class="n">args</span><span class="p">,</span> <span class="o">**</span><span class="n">kwargs</span><span class="p">):</span>
        <span class="nb">super</span><span class="p">()</span><span class="o">.</span><span class="fm">__init__</span><span class="p">(</span><span class="o">*</span><span class="n">args</span><span class="p">,</span> <span class="o">**</span><span class="n">kwargs</span><span class="p">)</span>
        <span class="c1"># Insert validation into self.validators so that multiple errors can be stored.</span>
        <span class="n">validator</span> <span class="o">=</span> <span class="n">validate</span><span class="o">.</span><span class="n">Email</span><span class="p">(</span><span class="n">error</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">error_messages</span><span class="p">[</span><span class="s2">&quot;invalid&quot;</span><span class="p">])</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">validators</span><span class="o">.</span><span class="n">insert</span><span class="p">(</span><span class="mi">0</span><span class="p">,</span> <span class="n">validator</span><span class="p">)</span>


<span class="k">class</span> <span class="nc">IP</span><span class="p">(</span><span class="n">Field</span><span class="p">):</span>
    <span class="sd">&quot;&quot;&quot;A IP address field.</span>

<span class="sd">    :param bool exploded: If `True`, serialize ipv6 address in long form, ie. with groups</span>
<span class="sd">        consisting entirely of zeros included.</span>

<span class="sd">    .. versionadded:: 3.8.0</span>
<span class="sd">    &quot;&quot;&quot;</span>

    <span class="n">default_error_messages</span> <span class="o">=</span> <span class="p">{</span><span class="s2">&quot;invalid_ip&quot;</span><span class="p">:</span> <span class="s2">&quot;Not a valid IP address.&quot;</span><span class="p">}</span>

    <span class="n">DESERIALIZATION_CLASS</span> <span class="o">=</span> <span class="kc">None</span>  <span class="c1"># type: typing.Optional[typing.Type]</span>

    <span class="k">def</span> <span class="fm">__init__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="o">*</span><span class="n">args</span><span class="p">,</span> <span class="n">exploded</span><span class="o">=</span><span class="kc">False</span><span class="p">,</span> <span class="o">**</span><span class="n">kwargs</span><span class="p">):</span>
        <span class="nb">super</span><span class="p">()</span><span class="o">.</span><span class="fm">__init__</span><span class="p">(</span><span class="o">*</span><span class="n">args</span><span class="p">,</span> <span class="o">**</span><span class="n">kwargs</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">exploded</span> <span class="o">=</span> <span class="n">exploded</span>

    <span class="k">def</span> <span class="nf">_serialize</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">value</span><span class="p">,</span> <span class="n">attr</span><span class="p">,</span> <span class="n">obj</span><span class="p">,</span> <span class="o">**</span><span class="n">kwargs</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="n">typing</span><span class="o">.</span><span class="n">Optional</span><span class="p">[</span><span class="nb">str</span><span class="p">]:</span>
        <span class="k">if</span> <span class="n">value</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
            <span class="k">return</span> <span class="kc">None</span>
        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">exploded</span><span class="p">:</span>
            <span class="k">return</span> <span class="n">value</span><span class="o">.</span><span class="n">exploded</span>
        <span class="k">return</span> <span class="n">value</span><span class="o">.</span><span class="n">compressed</span>

    <span class="k">def</span> <span class="nf">_deserialize</span><span class="p">(</span>
        <span class="bp">self</span><span class="p">,</span> <span class="n">value</span><span class="p">,</span> <span class="n">attr</span><span class="p">,</span> <span class="n">data</span><span class="p">,</span> <span class="o">**</span><span class="n">kwargs</span>
    <span class="p">)</span> <span class="o">-&gt;</span> <span class="n">typing</span><span class="o">.</span><span class="n">Optional</span><span class="p">[</span><span class="n">typing</span><span class="o">.</span><span class="n">Union</span><span class="p">[</span><span class="n">ipaddress</span><span class="o">.</span><span class="n">IPv4Address</span><span class="p">,</span> <span class="n">ipaddress</span><span class="o">.</span><span class="n">IPv6Address</span><span class="p">]]:</span>
        <span class="k">if</span> <span class="n">value</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
            <span class="k">return</span> <span class="kc">None</span>
        <span class="k">try</span><span class="p">:</span>
            <span class="k">return</span> <span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">DESERIALIZATION_CLASS</span> <span class="ow">or</span> <span class="n">ipaddress</span><span class="o">.</span><span class="n">ip_address</span><span class="p">)(</span>
                <span class="n">utils</span><span class="o">.</span><span class="n">ensure_text_type</span><span class="p">(</span><span class="n">value</span><span class="p">)</span>
            <span class="p">)</span>
        <span class="k">except</span> <span class="p">(</span><span class="ne">ValueError</span><span class="p">,</span> <span class="ne">TypeError</span><span class="p">)</span> <span class="k">as</span> <span class="n">error</span><span class="p">:</span>
            <span class="k">raise</span> <span class="bp">self</span><span class="o">.</span><span class="n">make_error</span><span class="p">(</span><span class="s2">&quot;invalid_ip&quot;</span><span class="p">)</span> <span class="kn">from</span> <span class="nn">error</span>


<span class="k">class</span> <span class="nc">IPv4</span><span class="p">(</span><span class="n">IP</span><span class="p">):</span>
    <span class="sd">&quot;&quot;&quot;A IPv4 address field.</span>

<span class="sd">    .. versionadded:: 3.8.0</span>
<span class="sd">    &quot;&quot;&quot;</span>

    <span class="n">default_error_messages</span> <span class="o">=</span> <span class="p">{</span><span class="s2">&quot;invalid_ip&quot;</span><span class="p">:</span> <span class="s2">&quot;Not a valid IPv4 address.&quot;</span><span class="p">}</span>

    <span class="n">DESERIALIZATION_CLASS</span> <span class="o">=</span> <span class="n">ipaddress</span><span class="o">.</span><span class="n">IPv4Address</span>


<span class="k">class</span> <span class="nc">IPv6</span><span class="p">(</span><span class="n">IP</span><span class="p">):</span>
    <span class="sd">&quot;&quot;&quot;A IPv6 address field.</span>

<span class="sd">    .. versionadded:: 3.8.0</span>
<span class="sd">    &quot;&quot;&quot;</span>

    <span class="n">default_error_messages</span> <span class="o">=</span> <span class="p">{</span><span class="s2">&quot;invalid_ip&quot;</span><span class="p">:</span> <span class="s2">&quot;Not a valid IPv6 address.&quot;</span><span class="p">}</span>

    <span class="n">DESERIALIZATION_CLASS</span> <span class="o">=</span> <span class="n">ipaddress</span><span class="o">.</span><span class="n">IPv6Address</span>


<span class="k">class</span> <span class="nc">IPInterface</span><span class="p">(</span><span class="n">Field</span><span class="p">):</span>
    <span class="sd">&quot;&quot;&quot;A IPInterface field.</span>

<span class="sd">    IP interface is the non-stict form of the IPNetwork type where arbitrary host</span>
<span class="sd">    addresses are always accepted.</span>

<span class="sd">    IPAddress and mask e.g. &#39;192.168.0.2/24&#39; or &#39;192.168.0.2/255.255.255.0&#39;</span>

<span class="sd">    see https://python.readthedocs.io/en/latest/library/ipaddress.html#interface-objects</span>

<span class="sd">    :param bool exploded: If `True`, serialize ipv6 interface in long form, ie. with groups</span>
<span class="sd">        consisting entirely of zeros included.</span>
<span class="sd">    &quot;&quot;&quot;</span>

    <span class="n">default_error_messages</span> <span class="o">=</span> <span class="p">{</span><span class="s2">&quot;invalid_ip_interface&quot;</span><span class="p">:</span> <span class="s2">&quot;Not a valid IP interface.&quot;</span><span class="p">}</span>

    <span class="n">DESERIALIZATION_CLASS</span> <span class="o">=</span> <span class="kc">None</span>  <span class="c1"># type: typing.Optional[typing.Type]</span>

    <span class="k">def</span> <span class="fm">__init__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="o">*</span><span class="n">args</span><span class="p">,</span> <span class="n">exploded</span><span class="o">=</span><span class="kc">False</span><span class="p">,</span> <span class="o">**</span><span class="n">kwargs</span><span class="p">):</span>
        <span class="nb">super</span><span class="p">()</span><span class="o">.</span><span class="fm">__init__</span><span class="p">(</span><span class="o">*</span><span class="n">args</span><span class="p">,</span> <span class="o">**</span><span class="n">kwargs</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">exploded</span> <span class="o">=</span> <span class="n">exploded</span>

    <span class="k">def</span> <span class="nf">_serialize</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">value</span><span class="p">,</span> <span class="n">attr</span><span class="p">,</span> <span class="n">obj</span><span class="p">,</span> <span class="o">**</span><span class="n">kwargs</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="n">typing</span><span class="o">.</span><span class="n">Optional</span><span class="p">[</span><span class="nb">str</span><span class="p">]:</span>
        <span class="k">if</span> <span class="n">value</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
            <span class="k">return</span> <span class="kc">None</span>
        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">exploded</span><span class="p">:</span>
            <span class="k">return</span> <span class="n">value</span><span class="o">.</span><span class="n">exploded</span>
        <span class="k">return</span> <span class="n">value</span><span class="o">.</span><span class="n">compressed</span>

    <span class="k">def</span> <span class="nf">_deserialize</span><span class="p">(</span>
        <span class="bp">self</span><span class="p">,</span> <span class="n">value</span><span class="p">,</span> <span class="n">attr</span><span class="p">,</span> <span class="n">data</span><span class="p">,</span> <span class="o">**</span><span class="n">kwargs</span>
    <span class="p">)</span> <span class="o">-&gt;</span> <span class="n">typing</span><span class="o">.</span><span class="n">Optional</span><span class="p">[</span>
        <span class="n">typing</span><span class="o">.</span><span class="n">Union</span><span class="p">[</span><span class="n">ipaddress</span><span class="o">.</span><span class="n">IPv4Interface</span><span class="p">,</span> <span class="n">ipaddress</span><span class="o">.</span><span class="n">IPv6Interface</span><span class="p">]</span>
    <span class="p">]:</span>
        <span class="k">if</span> <span class="n">value</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
            <span class="k">return</span> <span class="kc">None</span>
        <span class="k">try</span><span class="p">:</span>
            <span class="k">return</span> <span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">DESERIALIZATION_CLASS</span> <span class="ow">or</span> <span class="n">ipaddress</span><span class="o">.</span><span class="n">ip_interface</span><span class="p">)(</span>
                <span class="n">utils</span><span class="o">.</span><span class="n">ensure_text_type</span><span class="p">(</span><span class="n">value</span><span class="p">)</span>
            <span class="p">)</span>
        <span class="k">except</span> <span class="p">(</span><span class="ne">ValueError</span><span class="p">,</span> <span class="ne">TypeError</span><span class="p">)</span> <span class="k">as</span> <span class="n">error</span><span class="p">:</span>
            <span class="k">raise</span> <span class="bp">self</span><span class="o">.</span><span class="n">make_error</span><span class="p">(</span><span class="s2">&quot;invalid_ip_interface&quot;</span><span class="p">)</span> <span class="kn">from</span> <span class="nn">error</span>


<span class="k">class</span> <span class="nc">IPv4Interface</span><span class="p">(</span><span class="n">IPInterface</span><span class="p">):</span>
    <span class="sd">&quot;&quot;&quot;A IPv4 Network Interface field.&quot;&quot;&quot;</span>

    <span class="n">default_error_messages</span> <span class="o">=</span> <span class="p">{</span><span class="s2">&quot;invalid_ip_interface&quot;</span><span class="p">:</span> <span class="s2">&quot;Not a valid IPv4 interface.&quot;</span><span class="p">}</span>

    <span class="n">DESERIALIZATION_CLASS</span> <span class="o">=</span> <span class="n">ipaddress</span><span class="o">.</span><span class="n">IPv4Interface</span>


<span class="k">class</span> <span class="nc">IPv6Interface</span><span class="p">(</span><span class="n">IPInterface</span><span class="p">):</span>
    <span class="sd">&quot;&quot;&quot;A IPv6 Network Interface field.&quot;&quot;&quot;</span>

    <span class="n">default_error_messages</span> <span class="o">=</span> <span class="p">{</span><span class="s2">&quot;invalid_ip_interface&quot;</span><span class="p">:</span> <span class="s2">&quot;Not a valid IPv6 interface.&quot;</span><span class="p">}</span>

    <span class="n">DESERIALIZATION_CLASS</span> <span class="o">=</span> <span class="n">ipaddress</span><span class="o">.</span><span class="n">IPv6Interface</span>


<span class="k">class</span> <span class="nc">Method</span><span class="p">(</span><span class="n">Field</span><span class="p">):</span>
    <span class="sd">&quot;&quot;&quot;A field that takes the value returned by a `Schema` method.</span>

<span class="sd">    :param str serialize: The name of the Schema method from which</span>
<span class="sd">        to retrieve the value. The method must take an argument ``obj``</span>
<span class="sd">        (in addition to self) that is the object to be serialized.</span>
<span class="sd">    :param str deserialize: Optional name of the Schema method for deserializing</span>
<span class="sd">        a value The method must take a single argument ``value``, which is the</span>
<span class="sd">        value to deserialize.</span>

<span class="sd">    .. versionchanged:: 2.0.0</span>
<span class="sd">        Removed optional ``context`` parameter on methods. Use ``self.context`` instead.</span>

<span class="sd">    .. versionchanged:: 2.3.0</span>
<span class="sd">        Deprecated ``method_name`` parameter in favor of ``serialize`` and allow</span>
<span class="sd">        ``serialize`` to not be passed at all.</span>

<span class="sd">    .. versionchanged:: 3.0.0</span>
<span class="sd">        Removed ``method_name`` parameter.</span>
<span class="sd">    &quot;&quot;&quot;</span>

    <span class="n">_CHECK_ATTRIBUTE</span> <span class="o">=</span> <span class="kc">False</span>

    <span class="k">def</span> <span class="fm">__init__</span><span class="p">(</span>
        <span class="bp">self</span><span class="p">,</span>
        <span class="n">serialize</span><span class="p">:</span> <span class="n">typing</span><span class="o">.</span><span class="n">Optional</span><span class="p">[</span><span class="nb">str</span><span class="p">]</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span>
        <span class="n">deserialize</span><span class="p">:</span> <span class="n">typing</span><span class="o">.</span><span class="n">Optional</span><span class="p">[</span><span class="nb">str</span><span class="p">]</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span>
        <span class="o">**</span><span class="n">kwargs</span><span class="p">,</span>
    <span class="p">):</span>
        <span class="c1"># Set dump_only and load_only based on arguments</span>
        <span class="n">kwargs</span><span class="p">[</span><span class="s2">&quot;dump_only&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="nb">bool</span><span class="p">(</span><span class="n">serialize</span><span class="p">)</span> <span class="ow">and</span> <span class="ow">not</span> <span class="nb">bool</span><span class="p">(</span><span class="n">deserialize</span><span class="p">)</span>
        <span class="n">kwargs</span><span class="p">[</span><span class="s2">&quot;load_only&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="nb">bool</span><span class="p">(</span><span class="n">deserialize</span><span class="p">)</span> <span class="ow">and</span> <span class="ow">not</span> <span class="nb">bool</span><span class="p">(</span><span class="n">serialize</span><span class="p">)</span>
        <span class="nb">super</span><span class="p">()</span><span class="o">.</span><span class="fm">__init__</span><span class="p">(</span><span class="o">**</span><span class="n">kwargs</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">serialize_method_name</span> <span class="o">=</span> <span class="n">serialize</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">deserialize_method_name</span> <span class="o">=</span> <span class="n">deserialize</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_serialize_method</span> <span class="o">=</span> <span class="kc">None</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_deserialize_method</span> <span class="o">=</span> <span class="kc">None</span>

    <span class="k">def</span> <span class="nf">_bind_to_schema</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">field_name</span><span class="p">,</span> <span class="n">schema</span><span class="p">):</span>
        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">serialize_method_name</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">_serialize_method</span> <span class="o">=</span> <span class="n">utils</span><span class="o">.</span><span class="n">callable_or_raise</span><span class="p">(</span>
                <span class="nb">getattr</span><span class="p">(</span><span class="n">schema</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">serialize_method_name</span><span class="p">)</span>
            <span class="p">)</span>

        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">deserialize_method_name</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">_deserialize_method</span> <span class="o">=</span> <span class="n">utils</span><span class="o">.</span><span class="n">callable_or_raise</span><span class="p">(</span>
                <span class="nb">getattr</span><span class="p">(</span><span class="n">schema</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">deserialize_method_name</span><span class="p">)</span>
            <span class="p">)</span>

        <span class="nb">super</span><span class="p">()</span><span class="o">.</span><span class="n">_bind_to_schema</span><span class="p">(</span><span class="n">field_name</span><span class="p">,</span> <span class="n">schema</span><span class="p">)</span>

    <span class="k">def</span> <span class="nf">_serialize</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">value</span><span class="p">,</span> <span class="n">attr</span><span class="p">,</span> <span class="n">obj</span><span class="p">,</span> <span class="o">**</span><span class="n">kwargs</span><span class="p">):</span>
        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">_serialize_method</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">:</span>
            <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">_serialize_method</span><span class="p">(</span><span class="n">obj</span><span class="p">)</span>
        <span class="k">return</span> <span class="n">missing_</span>

    <span class="k">def</span> <span class="nf">_deserialize</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">value</span><span class="p">,</span> <span class="n">attr</span><span class="p">,</span> <span class="n">data</span><span class="p">,</span> <span class="o">**</span><span class="n">kwargs</span><span class="p">):</span>
        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">_deserialize_method</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">:</span>
            <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">_deserialize_method</span><span class="p">(</span><span class="n">value</span><span class="p">)</span>
        <span class="k">return</span> <span class="n">value</span>


<span class="k">class</span> <span class="nc">Function</span><span class="p">(</span><span class="n">Field</span><span class="p">):</span>
    <span class="sd">&quot;&quot;&quot;A field that takes the value returned by a function.</span>

<span class="sd">    :param serialize: A callable from which to retrieve the value.</span>
<span class="sd">        The function must take a single argument ``obj`` which is the object</span>
<span class="sd">        to be serialized. It can also optionally take a ``context`` argument,</span>
<span class="sd">        which is a dictionary of context variables passed to the serializer.</span>
<span class="sd">        If no callable is provided then the ```load_only``` flag will be set</span>
<span class="sd">        to True.</span>
<span class="sd">    :param deserialize: A callable from which to retrieve the value.</span>
<span class="sd">        The function must take a single argument ``value`` which is the value</span>
<span class="sd">        to be deserialized. It can also optionally take a ``context`` argument,</span>
<span class="sd">        which is a dictionary of context variables passed to the deserializer.</span>
<span class="sd">        If no callable is provided then ```value``` will be passed through</span>
<span class="sd">        unchanged.</span>

<span class="sd">    .. versionchanged:: 2.3.0</span>
<span class="sd">        Deprecated ``func`` parameter in favor of ``serialize``.</span>

<span class="sd">    .. versionchanged:: 3.0.0a1</span>
<span class="sd">        Removed ``func`` parameter.</span>
<span class="sd">    &quot;&quot;&quot;</span>

    <span class="n">_CHECK_ATTRIBUTE</span> <span class="o">=</span> <span class="kc">False</span>

    <span class="k">def</span> <span class="fm">__init__</span><span class="p">(</span>
        <span class="bp">self</span><span class="p">,</span>
        <span class="n">serialize</span><span class="p">:</span> <span class="n">typing</span><span class="o">.</span><span class="n">Optional</span><span class="p">[</span>
            <span class="n">typing</span><span class="o">.</span><span class="n">Union</span><span class="p">[</span>
                <span class="n">typing</span><span class="o">.</span><span class="n">Callable</span><span class="p">[[</span><span class="n">typing</span><span class="o">.</span><span class="n">Any</span><span class="p">],</span> <span class="n">typing</span><span class="o">.</span><span class="n">Any</span><span class="p">],</span>
                <span class="n">typing</span><span class="o">.</span><span class="n">Callable</span><span class="p">[[</span><span class="n">typing</span><span class="o">.</span><span class="n">Any</span><span class="p">,</span> <span class="n">typing</span><span class="o">.</span><span class="n">Dict</span><span class="p">],</span> <span class="n">typing</span><span class="o">.</span><span class="n">Any</span><span class="p">],</span>
            <span class="p">]</span>
        <span class="p">]</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span>
        <span class="n">deserialize</span><span class="p">:</span> <span class="n">typing</span><span class="o">.</span><span class="n">Optional</span><span class="p">[</span>
            <span class="n">typing</span><span class="o">.</span><span class="n">Union</span><span class="p">[</span>
                <span class="n">typing</span><span class="o">.</span><span class="n">Callable</span><span class="p">[[</span><span class="n">typing</span><span class="o">.</span><span class="n">Any</span><span class="p">],</span> <span class="n">typing</span><span class="o">.</span><span class="n">Any</span><span class="p">],</span>
                <span class="n">typing</span><span class="o">.</span><span class="n">Callable</span><span class="p">[[</span><span class="n">typing</span><span class="o">.</span><span class="n">Any</span><span class="p">,</span> <span class="n">typing</span><span class="o">.</span><span class="n">Dict</span><span class="p">],</span> <span class="n">typing</span><span class="o">.</span><span class="n">Any</span><span class="p">],</span>
            <span class="p">]</span>
        <span class="p">]</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span>
        <span class="o">**</span><span class="n">kwargs</span><span class="p">,</span>
    <span class="p">):</span>
        <span class="c1"># Set dump_only and load_only based on arguments</span>
        <span class="n">kwargs</span><span class="p">[</span><span class="s2">&quot;dump_only&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="nb">bool</span><span class="p">(</span><span class="n">serialize</span><span class="p">)</span> <span class="ow">and</span> <span class="ow">not</span> <span class="nb">bool</span><span class="p">(</span><span class="n">deserialize</span><span class="p">)</span>
        <span class="n">kwargs</span><span class="p">[</span><span class="s2">&quot;load_only&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="nb">bool</span><span class="p">(</span><span class="n">deserialize</span><span class="p">)</span> <span class="ow">and</span> <span class="ow">not</span> <span class="nb">bool</span><span class="p">(</span><span class="n">serialize</span><span class="p">)</span>
        <span class="nb">super</span><span class="p">()</span><span class="o">.</span><span class="fm">__init__</span><span class="p">(</span><span class="o">**</span><span class="n">kwargs</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">serialize_func</span> <span class="o">=</span> <span class="n">serialize</span> <span class="ow">and</span> <span class="n">utils</span><span class="o">.</span><span class="n">callable_or_raise</span><span class="p">(</span><span class="n">serialize</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">deserialize_func</span> <span class="o">=</span> <span class="n">deserialize</span> <span class="ow">and</span> <span class="n">utils</span><span class="o">.</span><span class="n">callable_or_raise</span><span class="p">(</span><span class="n">deserialize</span><span class="p">)</span>

    <span class="k">def</span> <span class="nf">_serialize</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">value</span><span class="p">,</span> <span class="n">attr</span><span class="p">,</span> <span class="n">obj</span><span class="p">,</span> <span class="o">**</span><span class="n">kwargs</span><span class="p">):</span>
        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">_call_or_raise</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">serialize_func</span><span class="p">,</span> <span class="n">obj</span><span class="p">,</span> <span class="n">attr</span><span class="p">)</span>

    <span class="k">def</span> <span class="nf">_deserialize</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">value</span><span class="p">,</span> <span class="n">attr</span><span class="p">,</span> <span class="n">data</span><span class="p">,</span> <span class="o">**</span><span class="n">kwargs</span><span class="p">):</span>
        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">deserialize_func</span><span class="p">:</span>
            <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">_call_or_raise</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">deserialize_func</span><span class="p">,</span> <span class="n">value</span><span class="p">,</span> <span class="n">attr</span><span class="p">)</span>
        <span class="k">return</span> <span class="n">value</span>

    <span class="k">def</span> <span class="nf">_call_or_raise</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">func</span><span class="p">,</span> <span class="n">value</span><span class="p">,</span> <span class="n">attr</span><span class="p">):</span>
        <span class="k">if</span> <span class="nb">len</span><span class="p">(</span><span class="n">utils</span><span class="o">.</span><span class="n">get_func_args</span><span class="p">(</span><span class="n">func</span><span class="p">))</span> <span class="o">&gt;</span> <span class="mi">1</span><span class="p">:</span>
            <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">parent</span><span class="o">.</span><span class="n">context</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
                <span class="n">msg</span> <span class="o">=</span> <span class="sa">f</span><span class="s2">&quot;No context available for Function field </span><span class="si">{attr!r}</span><span class="s2">&quot;</span>
                <span class="k">raise</span> <span class="n">ValidationError</span><span class="p">(</span><span class="n">msg</span><span class="p">)</span>
            <span class="k">return</span> <span class="n">func</span><span class="p">(</span><span class="n">value</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">parent</span><span class="o">.</span><span class="n">context</span><span class="p">)</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="k">return</span> <span class="n">func</span><span class="p">(</span><span class="n">value</span><span class="p">)</span>


<span class="k">class</span> <span class="nc">Constant</span><span class="p">(</span><span class="n">Field</span><span class="p">):</span>
    <span class="sd">&quot;&quot;&quot;A field that (de)serializes to a preset constant.  If you only want the</span>
<span class="sd">    constant added for serialization or deserialization, you should use</span>
<span class="sd">    ``dump_only=True`` or ``load_only=True`` respectively.</span>

<span class="sd">    :param constant: The constant to return for the field attribute.</span>

<span class="sd">    .. versionadded:: 2.0.0</span>
<span class="sd">    &quot;&quot;&quot;</span>

    <span class="n">_CHECK_ATTRIBUTE</span> <span class="o">=</span> <span class="kc">False</span>

    <span class="k">def</span> <span class="fm">__init__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">constant</span><span class="p">:</span> <span class="n">typing</span><span class="o">.</span><span class="n">Any</span><span class="p">,</span> <span class="o">**</span><span class="n">kwargs</span><span class="p">):</span>
        <span class="nb">super</span><span class="p">()</span><span class="o">.</span><span class="fm">__init__</span><span class="p">(</span><span class="o">**</span><span class="n">kwargs</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">constant</span> <span class="o">=</span> <span class="n">constant</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">load_default</span> <span class="o">=</span> <span class="n">constant</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">dump_default</span> <span class="o">=</span> <span class="n">constant</span>

    <span class="k">def</span> <span class="nf">_serialize</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">value</span><span class="p">,</span> <span class="o">*</span><span class="n">args</span><span class="p">,</span> <span class="o">**</span><span class="n">kwargs</span><span class="p">):</span>
        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">constant</span>

    <span class="k">def</span> <span class="nf">_deserialize</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">value</span><span class="p">,</span> <span class="o">*</span><span class="n">args</span><span class="p">,</span> <span class="o">**</span><span class="n">kwargs</span><span class="p">):</span>
        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">constant</span>


<span class="k">class</span> <span class="nc">Inferred</span><span class="p">(</span><span class="n">Field</span><span class="p">):</span>
    <span class="sd">&quot;&quot;&quot;A field that infers how to serialize, based on the value type.</span>

<span class="sd">    .. warning::</span>

<span class="sd">        This class is treated as private API.</span>
<span class="sd">        Users should not need to use this class directly.</span>
<span class="sd">    &quot;&quot;&quot;</span>

    <span class="k">def</span> <span class="fm">__init__</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="nb">super</span><span class="p">()</span><span class="o">.</span><span class="fm">__init__</span><span class="p">()</span>
        <span class="c1"># We memoize the fields to avoid creating and binding new fields</span>
        <span class="c1"># every time on serialization.</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_field_cache</span> <span class="o">=</span> <span class="p">{}</span>

    <span class="k">def</span> <span class="nf">_serialize</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">value</span><span class="p">,</span> <span class="n">attr</span><span class="p">,</span> <span class="n">obj</span><span class="p">,</span> <span class="o">**</span><span class="n">kwargs</span><span class="p">):</span>
        <span class="n">field_cls</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">root</span><span class="o">.</span><span class="n">TYPE_MAPPING</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="nb">type</span><span class="p">(</span><span class="n">value</span><span class="p">))</span>
        <span class="k">if</span> <span class="n">field_cls</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
            <span class="n">field</span> <span class="o">=</span> <span class="nb">super</span><span class="p">()</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="n">field</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_field_cache</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="n">field_cls</span><span class="p">)</span>
            <span class="k">if</span> <span class="n">field</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
                <span class="n">field</span> <span class="o">=</span> <span class="n">field_cls</span><span class="p">()</span>
                <span class="n">field</span><span class="o">.</span><span class="n">_bind_to_schema</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">name</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">parent</span><span class="p">)</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">_field_cache</span><span class="p">[</span><span class="n">field_cls</span><span class="p">]</span> <span class="o">=</span> <span class="n">field</span>
        <span class="k">return</span> <span class="n">field</span><span class="o">.</span><span class="n">_serialize</span><span class="p">(</span><span class="n">value</span><span class="p">,</span> <span class="n">attr</span><span class="p">,</span> <span class="n">obj</span><span class="p">,</span> <span class="o">**</span><span class="n">kwargs</span><span class="p">)</span>


<span class="c1"># Aliases</span>
<span class="n">URL</span> <span class="o">=</span> <span class="n">Url</span>
<span class="n">Str</span> <span class="o">=</span> <span class="n">String</span>
<span class="n">Bool</span> <span class="o">=</span> <span class="n">Boolean</span>
<span class="n">Int</span> <span class="o">=</span> <span class="n">Integer</span>
</pre></div>

              </div>
              
            
                <!-- Previous / next buttons -->
<div class='prev-next-area'>
</div>
            
        </div>
    </div>
    <footer class="footer">
  <p>
    
      By Patrick Vogel<br/>
    
        &copy; Copyright 2022, Patrick Vogel.<br/>
  </p>
</footer>
</main>


      </div>
    </div>
  
  <script src="../../_static/js/index.be7d3bbb2ef33a8344ce.js"></script>

  </body>
</html>